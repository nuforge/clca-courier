<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple PDF Thumbnail Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .thumbnail {
        width: 200px;
        height: 280px;
        border: 1px solid #ccc;
        margin: 10px 0;
        display: block;
      }
      .log {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .status {
        font-weight: bold;
        margin: 10px 0;
        padding: 5px;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìÑ Optimized PDF Thumbnail Test</h1>
      <p><strong>New Order:</strong> PDF.js (fast) ‚Üí WebViewer (quality) ‚Üí Fallback (reliable)</p>

      <button onclick="testThumbnail('/issues/7.2025.pdf')">Test July 2025 PDF</button>
      <button onclick="testThumbnail('/issues/Courier - 2025.06 - June.pdf')">
        Test June 2025 PDF
      </button>
      <button onclick="clearAllCaches()">Clear All Caches</button>
      <button onclick="clearLog()">Clear Log</button>

      <div class="test-section">
        <div id="status" class="status info">Ready to test...</div>
        <div id="result"></div>
      </div>

      <div id="log" class="log">Console output will appear here...\n</div>
    </div>

    <script type="module">
      // Import the optimized thumbnail function
      import { usePdfThumbnails } from '/src/composables/usePdfThumbnails.ts';

      const { getThumbnail, clearCache } = usePdfThumbnails();

      function log(message) {
        const logElement = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString();
        logElement.textContent += `[${timestamp}] ${message}\n`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      function setStatus(status, type = 'info') {
        const statusElement = document.getElementById('status');
        statusElement.textContent = status;
        statusElement.className = 'status ' + type;
      }

      window.testThumbnail = async function (url) {
        setStatus('Testing: ' + url, 'warning');
        log('üöÄ Starting thumbnail test for: ' + url);

        const startTime = Date.now();

        try {
          const thumbnail = await getThumbnail(url);
          const duration = Date.now() - startTime;

          if (thumbnail) {
            // Display the thumbnail
            const img = document.createElement('img');
            img.src = thumbnail;
            img.className = 'thumbnail';
            img.alt = 'Generated thumbnail';

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';
            resultDiv.appendChild(img);

            setStatus(`‚úÖ Success! (${duration}ms)`, 'success');
            log(`‚úÖ Thumbnail generated successfully in ${duration}ms`);
          } else {
            setStatus('‚ùå Failed', 'error');
            log('‚ùå Thumbnail generation failed');
          }
        } catch (error) {
          const duration = Date.now() - startTime;
          setStatus('üí• Error', 'error');
          log(`üí• Error after ${duration}ms: ${error.message}`);
        }
      };

      window.clearAllCaches = function () {
        clearCache();
        localStorage.clear();
        sessionStorage.clear();
        setStatus('üóëÔ∏è All caches cleared', 'warning');
        log('üóëÔ∏è All caches cleared (memory + localStorage + sessionStorage)');
      };

      window.clearLog = function () {
        document.getElementById('log').textContent = 'Console output will appear here...\n';
      };

      // Enhanced console capturing
      const originalLog = console.log;
      const originalWarn = console.warn;
      const originalError = console.error;

      console.log = function (...args) {
        originalLog.apply(console, args);
        log('LOG: ' + args.join(' '));
      };

      console.warn = function (...args) {
        originalWarn.apply(console, args);
        log('WARN: ' + args.join(' '));
      };

      console.error = function (...args) {
        originalError.apply(console, args);
        log('ERROR: ' + args.join(' '));
      };

      log('üîß Simple thumbnail test initialized');
      log('üìä Ready to test optimized three-tier system');
    </script>
  </body>
</html>
