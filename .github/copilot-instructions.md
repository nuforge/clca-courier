# CLCA Courier - AI Coding Instructions

## üö® CRITICAL DEVELOPMENT RULES (USER-ENFORCED)

### ABSOLUTE PROHIBITIONS

- **‚ùå Hash Mode Routing**: Always use history mode (`/archive` not `/#/archive`) - configured in `quasar.config.ts`
- **‚ùå Hardcoded Data Lists**: No static arrays, JSON files for content, or fake data - use dynamic discovery only
- **‚ùå Path Assumptions**: Always verify file/directory existence using tools like `list_dir`, `file_search`, `grep_search` before implementation

### MANDATORY PRACTICES

- **‚úÖ Dynamic Content Discovery**: Generate content from actual files using manifest system (`public/data/pdf-manifest.json`)
- **‚úÖ Path Verification**: Check existence before referencing any files or directories
- **‚úÖ Manifest-Based PDF Discovery**: Use `scripts/generate-pdf-manifest.js` for build-time PDF enumeration
- **‚úÖ Firebase-First Development**: Use Firebase services for all data, authentication, and storage operations

## üèóÔ∏è Architecture Overview

### Framework Stack

- **Frontend**: Vue 3 + Quasar Framework (Vite-based)
- **Backend**: Firebase (Authentication, Firestore, Storage, Functions)
- **State Management**: Pinia stores (`src/stores/`)
- **PDF Handling**: PDFTron WebViewer + PDF.js for dual viewer support
- **Storage Strategy**: Multi-tier architecture (Firebase + External providers)

### Key Components

- **`MainLayout.vue`**: Base layout with global PDF viewer and search
- **`GlobalPdfViewer.vue`**: Application-wide PDF viewer dialog component
- **`firebase-newsletter.service.ts`**: PDF management with multi-tier storage integration
- **`FirebaseNewsletterArchivePage.vue`**: Main archive with Firebase-first architecture

### Critical Services

- **Firebase Services**: Authentication, Firestore database, Storage (Tier 1), Functions
- **Multi-Tier Storage**: Cost-optimized storage with Firebase (fast) + External (cheap) tiers
- **Newsletter Service**: Firebase-first PDF management with storage optimization
- **PDF Optimization**: Web-optimized vs. high-quality versions for cost efficiency

## üîß Development Workflows

### Building & Running

```bash
# Development with hot reload
quasar dev

# Production build
quasar build
# High-memory production build (if needed)
npm run build:prod

# Generate PDF manifest (run before build)
node scripts/generate-pdf-manifest.js
```

### Project Structure Patterns

- **Pages**: Route components in `src/pages/` following `*Page.vue` naming
- **Components**: Reusable UI in `src/components/` with descriptive names
- **Services**: Business logic in `src/services/` with TypeScript interfaces
- **Stores**: Pinia state management in `src/stores/` with composition API

## üìù Code Patterns & Conventions

### Firebase-First PDF Management Pattern

```typescript
// ‚úÖ CORRECT: Firebase-based newsletter discovery with multi-tier storage
const newsletterService = new FirebaseNewsletterService();
await newsletterService.initialize();

// Access web-optimized version for viewing
const webVersion = newsletter.storage.webVersion.downloadUrl;

// Access high-quality version for downloading
const hqVersion = newsletter.storage.highQualityVersion.downloadUrl;

// ‚ùå WRONG: Hardcoded arrays or manifest-based discovery
const pdfs = ['2024.01-newsletter.pdf', '2024.02-newsletter.pdf'];
```

### Multi-Tier Storage Pattern (TENTATIVE)

```typescript
// ‚úÖ CORRECT: Cost-optimized storage strategy
interface NewsletterStorage {
  webVersion: {
    // Firebase Storage (fast delivery)
    downloadUrl: string; // CDN-delivered URL
    optimized: boolean; // Web-optimized flag
  };
  highQualityVersion: {
    // External storage (cost-effective)
    provider: 'b2' | 'r2'; // Backblaze B2 or Cloudflare R2
    downloadUrl: string; // Direct download URL
    archival: boolean; // Archive quality flag
  };
}

// ‚ùå WRONG: Single-tier expensive storage
const singleTierUrl = firebaseStorage.getDownloadUrl(highQualityPdf);
```

### Router Configuration

- **History mode only**: Configured in `quasar.config.ts` as `vueRouterMode: 'history'`
- **Route patterns**: `/archive/:id` for Firebase document IDs, `/archive/:id(\\d+)` for legacy routes
- **Lazy loading**: All routes use dynamic imports for code splitting

## üéØ Key Integration Points

### PDF Viewer Integration

- **Primary**: PDFTron WebViewer for advanced features
- **Fallback**: PDF.js for basic viewing
- **Global access**: Via `GlobalPdfViewer` component in main layout

### Firebase Integration

- **Authentication**: Multi-provider OAuth with role-based access control
- **Storage**: PDF and media file management with organized folder structure
- **Database**: Real-time newsletter metadata and user content management

### Build-Time Content Generation

- **PDF Manifest**: Generated by `scripts/generate-pdf-manifest.js` during build
- **Thumbnails**: Auto-generated and stored in `public/thumbnails/`
- **Metadata**: Extracted and cached for performance

## üõ†Ô∏è Common Development Tasks

### Adding New PDF Features

1. Verify PDF exists in `public/issues/` or Firebase Storage
2. Update manifest generation if needed
3. Use `newsletter-service.ts` for PDF operations
4. Test with both local and Firebase Storage PDFs

### Creating New Pages

1. Add component to `src/pages/` with `*Page.vue` naming
2. Register route in `src/router/routes.ts` with lazy loading
3. Use `MainLayout.vue` wrapper for consistent navigation

### Working with Firebase

1. Check Firebase configuration in `firebase.config.ts`
2. Use Firebase services for authentication, storage, and database operations
3. Follow security rules patterns for data access control

## üìö Essential Documentation

- `CRITICAL_DEVELOPMENT_RULES.md`: User-enforced development constraints
- `FIREBASE_IMPLEMENTATION_SUMMARY.md`: Firebase integration overview
- `DEVELOPMENT_MEMORY.md`: Progress tracking and failed attempts
- `PDF_VIEWER_DOCS.md`: PDF integration patterns and troubleshooting
