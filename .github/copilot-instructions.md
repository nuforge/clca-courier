# CLCA Courier - AI Coding Instructions

## üö® CRITICAL DEVELOPMENT RULES (USER-ENFORCED)

### ABSOLUTE PROHIBITIONS

- **‚ùå Hash Mode Routing**: Always use history mode (`/archive` not `/#/archive`) - configured in `quasar.config.ts`
- **‚ùå Hardcoded Data Lists**: No static arrays, JSON files for content, or fake data - use dynamic discovery only
- **‚ùå Path Assumptions**: Always verify file/directory existence using tools like `list_dir`, `file_search`, `grep_search` before implementation

### MANDATORY PRACTICES

- **‚úÖ Dynamic Content Discovery**: Generate content from actual files using manifest system (`public/data/pdf-manifest.json`)
- **‚úÖ Path Verification**: Check existence before referencing any files or directories
- **‚úÖ Manifest-Based PDF Discovery**: Use `scripts/generate-pdf-manifest.js` for build-time PDF enumeration

## üèóÔ∏è Architecture Overview

### Framework Stack

- **Frontend**: Vue 3 + Quasar Framework (Vite-based)
- **State Management**: Pinia stores (`src/stores/`)
- **PDF Handling**: PDFTron WebViewer + PDF.js for dual viewer support
- **Google Drive**: OAuth2 integration for external PDF storage

### Key Components

- **`MainLayout.vue`**: Base layout with global PDF viewer and search
- **`GlobalPdfViewer.vue`**: Application-wide PDF viewer dialog component
- **`newsletter-service.ts`**: Hybrid local/Google Drive PDF management
- **`AdvancedIssueArchivePage.vue`**: Main archive with manifest-based discovery

### Critical Services

- **Newsletter Service**: Hybrid hosting (local + Google Drive) with metadata extraction
- **PDF Metadata Service**: Automatic PDF analysis and thumbnails
- **Google Drive Service**: OAuth integration with CORS limitation awareness

## üîß Development Workflows

### Building & Running

```bash
# Development with hot reload
quasar dev

# Production build
quasar build
# High-memory production build (if needed)
npm run build:prod

# Generate PDF manifest (run before build)
node scripts/generate-pdf-manifest.js
```

### Project Structure Patterns

- **Pages**: Route components in `src/pages/` following `*Page.vue` naming
- **Components**: Reusable UI in `src/components/` with descriptive names
- **Services**: Business logic in `src/services/` with TypeScript interfaces
- **Stores**: Pinia state management in `src/stores/` with composition API

## üìù Code Patterns & Conventions

### PDF Discovery Pattern

```typescript
// ‚úÖ CORRECT: Manifest-based discovery
const manifest = await fetch('/data/pdf-manifest.json').then((r) => r.json());
const pdfs = manifest.files.map((file) => ({
  filename: file.filename,
  url: file.path,
}));

// ‚ùå WRONG: Hardcoded arrays
const pdfs = ['2024.01-newsletter.pdf', '2024.02-newsletter.pdf'];
```

### Router Configuration

- **History mode only**: Configured in `quasar.config.ts` as `vueRouterMode: 'history'`
- **Route patterns**: `/archive/:id(\\d+)` for parameterized routes
- **Lazy loading**: All routes use dynamic imports for code splitting

### Google Drive CORS Limitation

- **Cannot directly access Google Drive URLs** from client-side JavaScript
- **Use server-side proxy** or **download to local storage** for PDF processing
- **Authentication**: OAuth2 flow implemented in `google-drive-service.ts`

## üéØ Key Integration Points

### PDF Viewer Integration

- **Primary**: PDFTron WebViewer for advanced features
- **Fallback**: PDF.js for basic viewing
- **Global access**: Via `GlobalPdfViewer` component in main layout

### Google Drive API

- **Folder IDs**: Configured via environment variables (`VITE_GOOGLE_DRIVE_*`)
- **Authentication**: Client-side OAuth with proper scope management
- **File discovery**: Real-time folder scanning, not hardcoded lists

### Build-Time Content Generation

- **PDF Manifest**: Generated by `scripts/generate-pdf-manifest.js` during build
- **Thumbnails**: Auto-generated and stored in `public/thumbnails/`
- **Metadata**: Extracted and cached for performance

## üõ†Ô∏è Common Development Tasks

### Adding New PDF Features

1. Verify PDF exists in `public/issues/` or Google Drive
2. Update manifest generation if needed
3. Use `newsletter-service.ts` for PDF operations
4. Test with both local and Drive PDFs

### Creating New Pages

1. Add component to `src/pages/` with `*Page.vue` naming
2. Register route in `src/router/routes.ts` with lazy loading
3. Use `MainLayout.vue` wrapper for consistent navigation

### Working with Google Drive

1. Check CORS limitations in `GOOGLE_DRIVE_INTEGRATION.md`
2. Use server-side proxy for direct PDF access
3. Authenticate via `google-drive-service.ts` patterns

## üìö Essential Documentation

- `CRITICAL_DEVELOPMENT_RULES.md`: User-enforced development constraints
- `GOOGLE_DRIVE_INTEGRATION.md`: CORS limitations and solutions
- `DEVELOPMENT_MEMORY.md`: Progress tracking and failed attempts
- `PDF_VIEWER_DOCS.md`: PDF integration patterns and troubleshooting
