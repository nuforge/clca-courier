import{c as _,d as X,r as N,o as Y,w as Z,al as ee,I as B,M as i,a5 as t,f as s,a4 as d,aa as se,R as f,P as Q,a7 as x,a2 as c,a8 as O,N as $,a3 as h,K as g,a6 as y,ab as z,F as te,a9 as ae,am as le,J as r}from"./index-BmuMeY4A.js";import{u as ie,Q as oe,a as D,b as ne}from"./usePdfThumbnails-V3imTXIv.js";import{Q as j}from"./QChip-D6W_rGqX.js";import{Q as re}from"./QPage-IdDAhR7R.js";import{u as J}from"./site-store-simple-CoukZg9E.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./position-engine-Djrl-jLe.js";import"./selection-h4TAghRQ.js";import"./useUserSettings-C22snMFl.js";import"./use-quasar-CUzlIfm4.js";function de(){const u=J(),k=o=>u.archivedIssues.find(n=>n.id===o),b=_(()=>u.archivedIssues);return{getIssueById:k,allIssues:b,getNextIssue:o=>{const n=u.archivedIssues.findIndex(m=>m.id===o);if(n!==-1&&n<u.archivedIssues.length-1)return u.archivedIssues[n+1]},getPreviousIssue:o=>{const n=u.archivedIssues.findIndex(m=>m.id===o);if(n>0)return u.archivedIssues[n-1]},getRelatedIssues:(o,n=3)=>u.archivedIssues.filter(m=>m.id!==o.id).slice(0,n),formatIssueMetadata:o=>({size:`${o.pages} page${o.pages!==1?"s":""}`,filename:o.filename,date:o.date,downloadUrl:o.url}),issueExists:o=>u.archivedIssues.some(n=>n.id===o)}}const ce={class:"q-pa-md"},me={class:"row justify-center"},ve={class:"col-12 col-md-10 col-lg-8"},fe={key:0},he={class:"row q-col-gutter-md"},_e={class:"col-12 col-sm-4 col-md-3"},ge={class:"thumbnail-container"},be={key:0,class:"large-thumbnail-wrapper"},pe={key:1,class:"large-thumbnail-placeholder"},Ie={key:2,class:"large-thumbnail-placeholder"},xe={class:"col-12 col-sm-8 col-md-9"},ye={class:"text-h4 q-mb-sm"},ke={class:"q-mb-lg"},qe={class:"text-body1 q-mb-sm"},we={class:"text-body1 q-mb-sm"},Ce={class:"q-gutter-sm"},Te={class:"text-body1"},Qe={class:"q-mt-md"},De={class:"q-gutter-sm"},Pe={class:"row q-col-gutter-md"},Ne={key:0,class:"col-6"},Be={key:1,class:"col-6"},$e={class:"row q-col-gutter-md"},ze={class:"text-weight-medium text-caption"},Re={key:1,class:"text-center q-pa-xl"},Se=X({__name:"IssueDetailsPage",setup(u){const k=le(),b=ee(),q=J(),{getThumbnail:R,regenerateThumbnail:S}=ie(),{openDocument:V}=ne(),{getIssueById:M,getNextIssue:o,getPreviousIssue:n,getRelatedIssues:m}=de(),K=_(()=>Number(k.params.id)),a=N(null),p=N(""),I=N(!1),w=_(()=>a.value?o(a.value.id):void 0),C=_(()=>a.value?n(a.value.id):void 0),A=_(()=>a.value?m(a.value,3):[]),T=_(()=>q.isDarkMode?"bg-dark text-white q-dark":"bg-white text-dark"),F=_(()=>q.isDarkMode?"text-grey-4":"text-grey-7");Y(()=>{E()}),Z(()=>k.params.id,l=>{l&&E()});function E(){const l=M(K.value);l?(a.value=l,U()):b.push("/archive")}async function U(){if(a.value){I.value=!0;try{const l=await R(a.value.url);l&&(p.value=l)}catch(l){console.error("Failed to load thumbnail:",l)}finally{I.value=!1}}}async function G(){if(a.value){p.value="",I.value=!0;try{console.log("Regenerating thumbnail for:",a.value.title);const l=await S(a.value.url);l&&(p.value=l,console.log("Thumbnail regenerated successfully"))}catch(l){console.error("Error regenerating thumbnail:",l)}finally{I.value=!1}}}function L(){a.value&&V(a.value)}function H(){b.push("/archive")}function P(l){b.push(`/archive/${l.id}`)}function W(l){return`${l} page${l!==1?"s":""}`}return(l,e)=>(r(),B(re,{padding:""},{default:i(()=>[t("div",ce,[t("div",me,[t("div",ve,[s(f,{flat:"",icon:"mdi-arrow-left",label:"Back to Archive",onClick:H,class:"q-mb-md",color:se(q).isDarkMode?"white":"primary"},null,8,["color"]),a.value?(r(),d("div",fe,[s(y,{flat:"",class:g([T.value,"q-mb-md"])},{default:i(()=>[s(x,null,{default:i(()=>[t("div",he,[t("div",_e,[t("div",ge,[p.value?(r(),d("div",be,[s(oe,{src:p.value,alt:a.value.title,class:"large-thumbnail-image",fit:"contain"},null,8,["src","alt"]),s(f,{flat:"",dense:"",size:"sm",icon:"mdi-refresh",color:"primary",onClick:G,class:"thumbnail-refresh-btn",title:"Regenerate thumbnail"},{default:i(()=>[s(D,null,{default:i(()=>e[3]||(e[3]=[c("Regenerate thumbnail",-1)])),_:1,__:[3]})]),_:1})])):I.value?(r(),d("div",pe,[s(O,{color:"primary",size:"3em"}),e[4]||(e[4]=t("div",{class:"text-caption q-mt-sm"},"Generating thumbnail...",-1))])):(r(),d("div",Ie,[s($,{name:"mdi-file-pdf-box",size:"4em",color:"red-6"}),s(f,{flat:"",dense:"",size:"sm",icon:"mdi-refresh",color:"primary",onClick:G,class:"q-mt-xs",title:"Generate thumbnail"},{default:i(()=>[s(D,null,{default:i(()=>e[5]||(e[5]=[c("Generate thumbnail",-1)])),_:1,__:[5]})]),_:1})]))])]),t("div",xe,[t("div",ye,h(a.value.title),1),t("div",{class:g(["text-h6 q-mb-md",F.value])},h(a.value.date),3),t("div",ke,[t("div",qe,[s($,{name:"mdi-file-document",class:"q-mr-xs"}),c(" "+h(W(a.value.pages)),1)]),t("div",we,[s($,{name:"mdi-file",class:"q-mr-xs"}),c(" "+h(a.value.filename),1)])]),t("div",Ce,[s(f,{color:"primary",icon:"mdi-eye",label:"View PDF",onClick:L,unelevated:"",size:"lg"}),s(f,{color:"secondary",icon:"mdi-download",label:"Download",href:a.value.url,target:"_blank",outline:""},null,8,["href"])])])])]),_:1})]),_:1},8,["class"]),s(y,{flat:"",class:g([T.value,"q-mb-md"])},{default:i(()=>[s(x,null,{default:i(()=>[e[9]||(e[9]=t("div",{class:"text-h6 q-mb-md"},"About This Issue",-1)),s(z,{class:"q-mb-md"}),t("div",Te,[t("p",null,"This issue of The Courier contains "+h(a.value.pages)+" pages of community news, updates, and announcements.",1),t("div",Qe,[e[8]||(e[8]=t("div",{class:"text-weight-medium q-mb-sm"},"Quick Actions:",-1)),t("div",De,[s(j,{clickable:"",onClick:L,icon:"mdi-eye",color:"primary","text-color":"white"},{default:i(()=>e[6]||(e[6]=[c(" Open in Viewer ",-1)])),_:1,__:[6]}),s(j,{clickable:"",onClick:e[0]||(e[0]=v=>l.$router.push("/archive")),icon:"mdi-bookshelf",color:"secondary","text-color":"white"},{default:i(()=>e[7]||(e[7]=[c(" Browse Archive ",-1)])),_:1,__:[7]})])])])]),_:1,__:[9]})]),_:1},8,["class"]),w.value||C.value?(r(),B(y,{key:0,flat:"",class:g([T.value,"q-mb-md"])},{default:i(()=>[s(x,null,{default:i(()=>[e[12]||(e[12]=t("div",{class:"text-h6 q-mb-md"},"Navigation",-1)),s(z,{class:"q-mb-md"}),t("div",Pe,[C.value?(r(),d("div",Ne,[s(f,{flat:"",icon:"mdi-chevron-left",label:C.value.title,onClick:e[1]||(e[1]=v=>P(C.value)),class:"full-width",align:"left"},{default:i(()=>[s(D,null,{default:i(()=>e[10]||(e[10]=[c("Previous Issue",-1)])),_:1,__:[10]})]),_:1},8,["label"])])):Q("",!0),w.value?(r(),d("div",Be,[s(f,{flat:"","icon-right":"mdi-chevron-right",label:w.value.title,onClick:e[2]||(e[2]=v=>P(w.value)),class:"full-width",align:"right"},{default:i(()=>[s(D,null,{default:i(()=>e[11]||(e[11]=[c("Next Issue",-1)])),_:1,__:[11]})]),_:1},8,["label"])])):Q("",!0)])]),_:1,__:[12]})]),_:1},8,["class"])):Q("",!0),A.value.length>0?(r(),B(y,{key:1,flat:"",class:g(T.value)},{default:i(()=>[s(x,null,{default:i(()=>[e[13]||(e[13]=t("div",{class:"text-h6 q-mb-md"},"Other Issues",-1)),s(z,{class:"q-mb-md"}),t("div",$e,[(r(!0),d(te,null,ae(A.value,v=>(r(),d("div",{class:"col-12 col-sm-4",key:v.id},[s(y,{flat:"",bordered:"",class:"cursor-pointer hover-card",onClick:Ve=>P(v)},{default:i(()=>[s(x,{class:"text-center q-pa-sm"},{default:i(()=>[t("div",ze,h(v.title),1),t("div",{class:g(["text-caption",F.value])},h(v.date),3)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]),_:1,__:[13]})]),_:1},8,["class"])):Q("",!0)])):(r(),d("div",Re,[s(O,{color:"primary",size:"2em"}),e[14]||(e[14]=t("div",{class:"q-mt-md"},"Loading issue details...",-1))]))])])])]),_:1}))}}),Ue=ue(Se,[["__scopeId","data-v-31aff4da"]]);export{Ue as default};
