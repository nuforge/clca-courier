import{d as Q,al as R,c as h,I as z,J as n,a6 as w,K as f,M as o,f as s,a5 as i,a3 as T,a4 as c,N as _,R as I,a2 as x,a8 as $,a7 as C,r as P,o as M,w as N,P as V,ab as A,a9 as F,F as L}from"./index-B-zpEeKy.js";import{Q as G}from"./QPage-PYOp2Uis.js";import{u as B}from"./site-store-simple-Ct7nOrjs.js";import{Q as K,a as S,b as E,u as j}from"./usePdfThumbnails-CNbFlITD.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useUserSettings-D9pFEnht.js";import"./use-quasar-BAQVWikZ.js";import"./position-engine-Bf5Q5AWK.js";import"./selection-Q4s7CP1Z.js";const J={class:"text-weight-medium"},H={class:"thumbnail-container q-mb-sm"},O={key:0,class:"thumbnail-wrapper"},U={key:1,class:"thumbnail-placeholder"},W={key:2,class:"thumbnail-placeholder"},X=Q({__name:"IssueCard",props:{issue:{},thumbnail:{},isLoading:{type:Boolean}},emits:["regenerate-thumbnail"],setup(q,{emit:r}){const m=q,y=r,g=R(),v=B(),{openDocument:l}=E(),d=h(()=>v.isDarkMode?"bg-dark text-white q-dark":"bg-white text-dark"),u=h(()=>v.isDarkMode?"text-grey-4":"text-grey-7");function b(){g.push(`/archive/${m.issue.id}`)}function k(e){e.stopPropagation(),l(m.issue)}function a(e){e.stopPropagation(),y("regenerate-thumbnail",m.issue,e)}return(e,t)=>(n(),z(w,{class:f([d.value,"cursor-pointer hover-card"]),onClick:b},{default:o(()=>[s(C,{class:"text-center"},{default:o(()=>[i("div",J,T(e.issue.title),1),i("div",H,[e.thumbnail?(n(),c("div",O,[s(K,{src:e.thumbnail,alt:e.issue.title,class:"thumbnail-image",fit:"contain"},null,8,["src","alt"]),i("div",{class:"thumbnail-overlay",onClick:k},[s(_,{name:"mdi-eye",size:"2em",color:"white"}),t[0]||(t[0]=i("div",{class:"text-white text-weight-medium q-mt-xs"},"View PDF",-1))]),s(I,{flat:"",dense:"",size:"xs",icon:"mdi-refresh",color:"primary",onClick:a,class:"thumbnail-refresh-btn",title:"Regenerate thumbnail"},{default:o(()=>[s(S,null,{default:o(()=>t[1]||(t[1]=[x("Regenerate thumbnail",-1)])),_:1,__:[1]})]),_:1})])):e.isLoading?(n(),c("div",U,[s($,{color:"primary",size:"2em"}),t[2]||(t[2]=i("div",{class:"text-caption q-mt-sm"},"Generating thumbnail...",-1))])):(n(),c("div",W,[s(_,{name:"mdi-file-pdf-box",size:"3em",color:"red-6"}),s(I,{flat:"",dense:"",size:"sm",icon:"mdi-refresh",color:"primary",onClick:a,class:"q-mt-xs",title:"Generate thumbnail"},{default:o(()=>[s(S,null,{default:o(()=>t[3]||(t[3]=[x("Generate thumbnail",-1)])),_:1,__:[3]})]),_:1})]))]),i("div",{class:f(["text-caption",u.value])},T(e.issue.date),3)]),_:1})]),_:1},8,["class"]))}}),Y=D(X,[["__scopeId","data-v-7d7ec52c"]]),Z={class:"q-pa-md"},ee={class:"row justify-center"},te={class:"col-12 col-md-10 col-lg-8"},ae={class:"text-h4 q-mb-md"},se={class:"row q-col-gutter-md"},ie={key:0,class:"text-center q-mt-lg"},oe=Q({__name:"IssueArchivePage",setup(q){const r=B(),{getThumbnail:m,regenerateThumbnail:y}=j(),g=h(()=>r.isDarkMode?"bg-dark text-white q-dark":"bg-white text-dark"),v=h(()=>r.isDarkMode?"text-grey-4":"text-grey-7"),l=h(()=>r.archivedIssues),d=P({}),u=P(new Set);M(()=>{if(l.value.length>0&&!r.isLoading)for(const a of l.value)b(a)}),N(()=>[l.value.length,r.isLoading],async([a,e])=>{if(a>0&&!e){await new Promise(t=>setTimeout(t,100));for(const t of l.value)b(t)}},{immediate:!0});async function b(a){const e=String(a.id);if(!d.value[e]){u.value.add(a.id);try{const t=await m(a.url);t&&(d.value[e]=t)}catch(t){console.error("Failed to load thumbnail for",a.title,t)}finally{u.value.delete(a.id)}}}async function k(a,e){e&&e.stopPropagation();const t=String(a.id);delete d.value[t],u.value.add(a.id);try{console.log("Regenerating thumbnail for:",a.title);const p=await y(a.url);p?(d.value[t]=p,console.log("Thumbnail regenerated successfully for:",a.title)):console.warn("Failed to regenerate thumbnail for:",a.title)}catch(p){console.error("Error regenerating thumbnail for",a.title,p)}finally{u.value.delete(a.id)}}return(a,e)=>(n(),z(G,{padding:""},{default:o(()=>[i("div",Z,[i("div",ee,[i("div",te,[s(w,{flat:"",class:f([g.value,"q-mb-md"])},{default:o(()=>[s(C,null,{default:o(()=>[i("div",ae,[s(_,{name:"mdi-bookshelf",class:"q-mr-sm"}),e[0]||(e[0]=x(" Issue Archive ",-1))]),e[1]||(e[1]=i("p",{class:"text-body1"}," Browse through past issues of The Courier. Access previous newsletters, announcements, and community updates from our archive. ",-1))]),_:1,__:[1]})]),_:1},8,["class"]),s(w,{flat:"",class:f(g.value)},{default:o(()=>[s(C,null,{default:o(()=>[e[2]||(e[2]=i("div",{class:"text-h6 q-mb-md"},"Available Issues",-1)),s(A,{class:"q-mb-md"}),i("div",se,[(n(!0),c(L,null,F(l.value,t=>(n(),c("div",{class:"col-12 col-sm-4 col-md-3 col-lg-2",key:t.id},[s(Y,{issue:t,thumbnail:d.value[String(t.id)]||void 0,"is-loading":u.value.has(t.id),onRegenerateThumbnail:k},null,8,["issue","thumbnail","is-loading"])]))),128))]),l.value.length===0?(n(),c("div",ie,[s(_,{name:"mdi-bookshelf",size:"4em",color:"grey-5"}),i("div",{class:f([v.value,"q-mt-md"])},"No archived issues available yet",2)])):V("",!0)]),_:1,__:[2]})]),_:1},8,["class"])])])])]),_:1}))}}),ge=D(oe,[["__scopeId","data-v-6be063bf"]]);export{ge as default};
