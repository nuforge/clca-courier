import{f as w}from"./firebase-auth.service-03qodj7b.js";import{firestoreService as c}from"./firebase-firestore.service-DV1lPEDP.js";import{firebaseStorageService as y}from"./firebase-storage.service-DFtnWO6B.js";import{r as u,_ as P,q as m,f as F,w as S,l as s}from"./index-DsgKP-0L.js";function b(){const r=u({user:null,isAuthenticated:!1,isLoading:!0,error:null});let n=null;P(()=>{n=w.onAuthStateChange(g=>{r.value=g})}),m(()=>{n?.()});const a=F(()=>r.value.isAuthenticated),f=F(()=>r.value.isLoading),d=F(()=>r.value.user),h=F(()=>r.value.error),i=async g=>{try{await w.signInWithPopup(g),s.success(`Signed in with ${g}`)}catch(p){throw s.error("Sign in failed:",p),p}},l=async g=>{try{await w.signInWithRedirect(g),s.info(`Redirecting for ${g} sign in...`)}catch(p){throw s.error("Redirect sign in failed:",p),p}},e=async()=>{try{await w.signOut(),s.success("Signed out successfully")}catch(g){throw s.error("Sign out failed:",g),g}},t=async()=>w.hasPermission(),o=async()=>w.isEditor(),v=()=>{w.clearAvatarCache()};return{authState:r.value,isAuthenticated:a,isLoading:f,currentUser:d,error:h,signIn:i,signInWithRedirect:l,signOut:e,hasPermission:t,isEditor:o,clearAvatarCache:v}}function U(){const r=u([]),n=u(!1),a=u(null);let f=null;return P(()=>{f=c.subscribeToNewsletters(e=>{r.value=e})}),m(()=>{f?.()}),{newsletters:r,isLoading:n,error:a,loadNewsletters:async()=>{try{n.value=!0,a.value=null,r.value=await c.getAllNewsletterMetadata()}catch(e){a.value=e instanceof Error?e.message:"Failed to load newsletters",s.error("Failed to load newsletters:",e)}finally{n.value=!1}},searchNewsletters:async e=>{try{return n.value=!0,a.value=null,await c.searchNewsletters(e)}catch(t){return a.value=t instanceof Error?t.message:"Search failed",s.error("Newsletter search failed:",t),[]}finally{n.value=!1}},saveNewsletter:async e=>{try{const t=await c.saveNewsletterMetadata(e);return s.success("Newsletter saved:",t),t}catch(t){throw a.value=t instanceof Error?t.message:"Failed to save newsletter",s.error("Failed to save newsletter:",t),t}},updateNewsletter:async(e,t)=>{try{await c.updateNewsletterMetadata(e,t),s.success("Newsletter updated:",e)}catch(o){throw a.value=o instanceof Error?o.message:"Failed to update newsletter",s.error("Failed to update newsletter:",o),o}}}}function C(){const r=u(null),n=u(!1),a=u(null);return{uploadProgress:r,isUploading:n,error:a,uploadPdf:async(l,e)=>{try{n.value=!0,a.value=null,r.value=null;const t=e?await y.uploadNewsletterPdf(l,e,o=>{r.value=o}):await y.uploadPdf(l,{onProgress:o=>{r.value=o}});return s.success("PDF uploaded successfully:",t.storagePath),t}catch(t){throw a.value=t instanceof Error?t.message:"Upload failed",s.error("PDF upload failed:",t),t}finally{n.value=!1,r.value=null}},uploadFile:async(l,e)=>{try{n.value=!0,a.value=null,r.value=null;const t={onProgress:v=>{r.value=v}};e&&(t.folder=e);const o=await y.uploadFile(l,t);return s.success("File uploaded successfully:",o.storagePath),o}catch(t){throw a.value=t instanceof Error?t.message:"Upload failed",s.error("File upload failed:",t),t}finally{n.value=!1,r.value=null}},getStorageFiles:async l=>{try{return await y.listFiles(l)}catch(e){return a.value=e instanceof Error?e.message:"Failed to load files",s.error("Failed to load storage files:",e),[]}},deleteFile:async l=>{try{await y.deleteFile(l),s.success("File deleted:",l)}catch(e){throw a.value=e instanceof Error?e.message:"Failed to delete file",s.error("Failed to delete file:",e),e}}}}function N(){const r=u([]),n=u(!1),a=u(null),{isAuthenticated:f}=b();let d=null;return S(f,e=>{e?(s.info("User authenticated - setting up pending content subscription"),d=c.subscribeToPendingContent(t=>{r.value=t})):(s.info("User not authenticated - cleaning up pending content subscription"),d?.(),d=null,r.value=[])},{immediate:!0}),m(()=>{d?.()}),{pendingContent:r,isLoading:n,error:a,submitContent:async e=>{try{n.value=!0,a.value=null;const t=await c.submitUserContent(e);return s.success("Content submitted:",t),t}catch(t){throw a.value=t instanceof Error?t.message:"Failed to submit content",s.error("Failed to submit content:",t),t}finally{n.value=!1}},updateContentStatus:async(e,t,o)=>{try{await c.updateContentStatus(e,t,o),s.success("Content status updated:",e,t)}catch(v){throw a.value=v instanceof Error?v.message:"Failed to update status",s.error("Failed to update content status:",v),v}},loadPendingContent:async()=>{try{n.value=!0,a.value=null,r.value=await c.getPendingContent()}catch(e){a.value=e instanceof Error?e.message:"Failed to load pending content",s.error("Failed to load pending content:",e)}finally{n.value=!1}}}}function E(){const r=u(null),n=u(!1),a=u(null);return{userProfile:r,isLoading:n,error:a,loadUserProfile:async i=>{try{n.value=!0,a.value=null,r.value=await c.getUserProfile(i)}catch(l){a.value=l instanceof Error?l.message:"Failed to load profile",s.error("Failed to load user profile:",l)}finally{n.value=!1}},createUserProfile:async i=>{try{await c.createUserProfile(i),r.value={...i,createdAt:new Date().toISOString(),lastLoginAt:new Date().toISOString()},s.success("User profile created:",i.uid)}catch(l){throw a.value=l instanceof Error?l.message:"Failed to create profile",s.error("Failed to create user profile:",l),l}},updateUserProfile:async(i,l)=>{try{await c.updateUserProfile(i,l),r.value&&(r.value={...r.value,...l}),s.success("User profile updated:",i)}catch(e){throw a.value=e instanceof Error?e.message:"Failed to update profile",s.error("Failed to update user profile:",e),e}}}}function M(){const r=b(),n=U(),a=C(),f=N(),d=E();return{auth:r,newsletters:n,storage:a,userContent:f,userProfile:d}}export{M as u};
