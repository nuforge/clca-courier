import{ax as Ye,r as F,q as mt,l as V,f as k,v as be,E as W,G as o,C as e,a5 as ae,B as t,ac as X,H as T,y as w,w as _e,x as A,Q as ie,D as se,F as _,N as $,L as we,aa as Ke,M as O,ay as Pe,a8 as ye,z as He,a6 as ve,J as xe,K as Se,a7 as ft,g as Be,aN as gt,aP as Je,bb as vt,h as ue,c as Xe,bc as pt,ak as yt,bd as bt,be as ht,bf as wt,bg as xt,bh as Qe,bi as St,bj as $t,aM as Ct,bk as _t,bl as Tt,bm as kt,ab as ze,af as Ee,a3 as Ae,_ as Ze,aw as We,I as M}from"./index-Cz4yoHZ0.js";import{Q as Nt}from"./QPage-DMXTvWWM.js";import{u as Ft}from"./useRoleAuth-COaKcMUW.js";import{f as et}from"./firebase-newsletter.service-Dx2IsjEs.js";import{firestoreService as he}from"./firebase-firestore.service-B9vyCLeN.js";import{Q as Te}from"./QSelect-C8Md63BB.js";import{Q as K}from"./QTooltip-DFbDvHRv.js";import{Q as Ie,a as de,b as Le,c as ce}from"./QTabPanels-BhNW6kxj.js";import{Q as fe}from"./QChip-BQ4pZl7c.js";import{Q as Dt}from"./QSlideTransition-D-1Y6V6O.js";import{Q as Ue}from"./QSpace-BgG47InH.js";import{Q as Oe}from"./QBtnGroup-BAQeEVko.js";import{Q as Vt,a as me,b as Mt}from"./QTable-DqvluTuc.js";import{Q as Me}from"./QBadge-BYtMBeQj.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as zt,b as Et}from"./format-DeJNMzpE.js";import{Q as ge,a as ne,b as J}from"./QItem-CRPqqROe.js";import{Q as ke}from"./QList-Dm_7T7JJ.js";import{Q as Ut}from"./QLinearProgress-BXPHArSZ.js";import{C as Ne}from"./ClosePopup-CnTt8MxX.js";import{Q as Pt}from"./QSpinnerDots-CogZnuS_.js";import{Q as qt}from"./QBanner-BUUebsTS.js";import{Q as Bt}from"./QExpansionItem-DCIx1_Gu.js";import"./useFirebase-DFZ6mt9W.js";import"./firebase-auth.service-5QLp4-9X.js";import"./firebase-storage.service-TqCwbEUJ.js";import"./QMenu-DWv1BRzc.js";import"./QResizeObserver-DGgry7bG.js";import"./touch-BjYP5sR0.js";import"./use-render-cache-DLxPkVnQ.js";const At=Ye("newsletter-management",()=>{const d=F([]),z=F([]),b=F(null),s=F({searchText:"",filterYear:null,filterSeason:null,filterMonth:null}),c=F(!1),f=F(!1),C=F(!1),p=F(!1),m=F(!1),x=F(!1),h=F(!1),G=F(!1),L=F(!1),q=F(!1),N=F(null),v=()=>{V.info("Setting up reactive admin subscription for newsletter management..."),N.value=he.subscribeToNewslettersForAdmin(U=>{V.info(`Received ${U.length} newsletters via reactive subscription`),d.value=U})};mt(()=>{N.value&&(N.value(),V.info("Newsletter management store subscription cleaned up"))});const P=F(!1),Y=F(!1),i=F(!1),u=F(!1),g=F({}),I=F({}),B=F({}),Z=F({}),te=F({}),R=F(!1),H=F(!1),re=F(!1),S=F(""),D=F(localStorage.getItem("newsletter-management-toolbar-expanded")!=="false");V.debug(`Workflow toolbar initialized as: ${D.value?"expanded":"collapsed"}`);const l=k(()=>{let U=d.value;if(s.value.searchText){const ee=s.value.searchText.toLowerCase();U=U.filter(pe=>pe.filename.toLowerCase().includes(ee)||pe.title?.toLowerCase().includes(ee)||pe.description?.toLowerCase().includes(ee))}return s.value.filterYear&&(U=U.filter(ee=>ee.year===s.value.filterYear)),s.value.filterSeason&&(U=U.filter(ee=>ee.season===s.value.filterSeason)),s.value.filterMonth&&(U=U.filter(ee=>ee.month===s.value.filterMonth)),U}),E=k(()=>d.value.length),r=k(()=>d.value.filter(U=>U.searchableText).length),a=k(()=>d.value.filter(U=>U.thumbnailUrl).length),n=k(()=>{const U=d.value.reduce((ee,pe)=>ee+(pe.fileSize||0),0);return U<1024?`${U} B`:U<1024*1024?`${(U/1024).toFixed(1)} KB`:U<1024*1024*1024?`${(U/(1024*1024)).toFixed(1)} MB`:`${(U/(1024*1024*1024)).toFixed(1)} GB`}),y=k(()=>d.value.reduce((U,ee)=>U+(ee.fileSize||0),0)),j=k(()=>d.value.filter(U=>!U.id)),Q=k(()=>j.value.length>0),le=k(()=>[...new Set(d.value.map(ee=>ee.year).filter(Boolean))].sort((ee,pe)=>(pe||0)-(ee||0))),De=k(()=>[...new Set(d.value.map(U=>U.season).filter(Boolean))]),oe=k(()=>[{label:"January",value:1},{label:"February",value:2},{label:"March",value:3},{label:"April",value:4},{label:"May",value:5},{label:"June",value:6},{label:"July",value:7},{label:"August",value:8},{label:"September",value:9},{label:"October",value:10},{label:"November",value:11},{label:"December",value:12}]),$e=k(()=>({isLoading:c.value,isExtracting:f.value,isExtractingAllText:C.value,isGeneratingThumbs:q.value,isSaving:!1,isProcessingText:!1,isApplyingMetadata:!1,isSyncing:P.value,extractingText:g.value,generatingThumb:te.value}));async function Re(){c.value=!0;try{V.info("🔄 Loading ALL newsletters for admin (including unpublished)..."),v();const U=await et.loadAllNewslettersForAdmin();d.value=U,V.success(`✅ Loaded ${U.length} newsletters (admin view) + reactive subscription active`)}catch(U){throw V.error("❌ Failed to load newsletters:",U),U}finally{c.value=!1}}async function at(){await Re()}function nt(){z.value=[]}function st(U){z.value=U}function ot(){z.value=[...l.value]}function it(U){const ee=z.value.findIndex(pe=>pe.filename===U.filename);ee===-1?z.value.push(U):z.value.splice(ee,1)}function rt(U){b.value=U}function ut(U){s.value={...s.value,...U}}function dt(){s.value={searchText:"",filterYear:null,filterSeason:null,filterMonth:null}}function ct(){D.value=!D.value,localStorage.setItem("newsletter-management-toolbar-expanded",D.value.toString()),V.debug(`Toolbar expanded state saved: ${D.value}`)}return{newsletters:d,selectedNewsletters:z,currentNewsletter:b,filters:s,isLoading:c,isExtracting:f,isExtractingText:C,isExtractingPageCount:p,isExtractingFileSize:m,isExtractingDates:x,isGeneratingKeywords:h,isGeneratingDescriptions:G,isGeneratingTitles:L,isGeneratingThumbs:q,isSyncing:P,isUploading:Y,isToggling:i,isDeleting:u,extractingText:g,syncingIndividual:I,publishingStates:B,featuredStates:Z,thumbnailIndividualStates:te,showImportDialog:R,showEditDialog:H,showTextDialog:re,extractedText:S,workflowToolbarExpanded:D,filteredNewsletters:l,totalNewsletters:E,newslettersWithText:r,newslettersWithThumbnails:a,totalFileSize:n,totalFileSizeBytes:y,draftNewsletters:j,hasDrafts:Q,availableYears:le,availableSeasons:De,availableMonths:oe,processingStates:$e,loadNewsletters:Re,refreshNewsletters:at,clearSelection:nt,setSelectedNewsletters:st,selectAll:ot,selectNewsletter:it,setCurrentNewsletter:rt,updateFilters:ut,resetFilters:dt,toggleWorkflowToolbar:ct}}),It={class:"row q-mb-lg"},Lt={class:"col-12 col-sm-6 col-md-3 q-pa-sm"},Gt={class:"text-h6 text-orange"},Rt={class:"col-12 col-sm-6 col-md-3 q-pa-sm"},Qt={class:"text-h6 text-green"},Wt={class:"col-12 col-sm-6 col-md-3 q-pa-sm"},Ot={class:"text-h6 text-blue"},jt={class:"col-12 col-sm-6 col-md-3 q-pa-sm"},Yt={class:"text-h6 text-red"},Kt=be({__name:"StatisticsCards",props:{totalNewsletters:{},newslettersWithText:{},newslettersWithThumbnails:{},totalFileSize:{}},setup(d){return(z,b)=>(w(),W("div",It,[o("div",Lt,[e(ae,{class:"text-center"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Gt,T(z.totalNewsletters),1),b[0]||(b[0]=o("div",{class:"text-caption"},"Total Newsletters",-1))]),_:1,__:[0]})]),_:1})]),o("div",Rt,[e(ae,{class:"text-center"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Qt,T(z.newslettersWithText),1),b[1]||(b[1]=o("div",{class:"text-caption"},"With Extracted Text",-1))]),_:1,__:[1]})]),_:1})]),o("div",Wt,[e(ae,{class:"text-center"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Ot,T(z.newslettersWithThumbnails),1),b[2]||(b[2]=o("div",{class:"text-caption"},"With Thumbnails",-1))]),_:1,__:[2]})]),_:1})]),o("div",jt,[e(ae,{class:"text-center"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Yt,T(z.totalFileSize),1),b[3]||(b[3]=o("div",{class:"text-caption"},"Total Size",-1))]),_:1,__:[3]})]),_:1})])]))}}),Ht={class:"row"},Jt={class:"col-12 col-md-4"},Xt={class:"col-12 col-md-2"},Zt={class:"col-12 col-md-2"},el={class:"col-12 col-md-2"},tl={class:"col-12 col-md-2"},ll=be({__name:"NewsletterFilters",props:{filters:{},availableYears:{},availableSeasons:{},availableMonths:{}},emits:["update:filters","clear-filters"],setup(d,{emit:z}){const b=d,s=z,c=F({...b.filters});_e(()=>b.filters,m=>{c.value={...m}},{deep:!0});function f(){s("update:filters",{searchText:c.value.searchText})}function C(){s("update:filters",{filterYear:c.value.filterYear,filterSeason:c.value.filterSeason,filterMonth:c.value.filterMonth})}function p(){c.value={searchText:"",filterYear:null,filterSeason:null,filterMonth:null},s("clear-filters")}return(m,x)=>(w(),A(ae,{class:"q-mb-lg"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Ht,[o("div",Jt,[e(ie,{modelValue:c.value.searchText,"onUpdate:modelValue":[x[0]||(x[0]=h=>c.value.searchText=h),f],label:"Search newsletters...",outlined:"",dense:"",clearable:"",debounce:"300"},{prepend:t(()=>[e(se,{name:"mdi-magnify"})]),_:1},8,["modelValue"])]),o("div",Xt,[e(Te,{modelValue:c.value.filterYear,"onUpdate:modelValue":[x[1]||(x[1]=h=>c.value.filterYear=h),C],options:m.availableYears,label:"Filter by Year",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"])]),o("div",Zt,[e(Te,{modelValue:c.value.filterSeason,"onUpdate:modelValue":[x[2]||(x[2]=h=>c.value.filterSeason=h),C],options:m.availableSeasons,label:"Filter by Season",outlined:"",dense:"",clearable:""},null,8,["modelValue","options"])]),o("div",el,[e(Te,{modelValue:c.value.filterMonth,"onUpdate:modelValue":[x[3]||(x[3]=h=>c.value.filterMonth=h),C],options:m.availableMonths,"option-label":"label","option-value":"value",label:"Filter by Month",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",tl,[e(_,{color:"primary",icon:"mdi-filter-remove",label:"Clear Filters",outlined:"",onClick:p})])])]),_:1})]),_:1}))}}),al={class:"row items-center justify-between"},nl={class:"text-h6"},sl={class:"text-caption q-ml-sm"},ol={class:"q-mt-md"},il={class:"row"},rl={class:"row"},ul={class:"row"},dl={class:"row"},cl={class:"row"},ml={class:"row"},fl={class:"col-auto"},gl={class:"col-auto"},vl={class:"col-auto"},pl={class:"col-auto"},yl=be({__name:"WorkflowToolbar",props:{hasDrafts:{type:Boolean},draftCount:{},isLoading:{type:Boolean},isUploading:{type:Boolean},isSyncing:{type:Boolean},isExtractingText:{type:Boolean},isGeneratingThumbs:{type:Boolean},isExtractingPageCount:{type:Boolean},isExtractingFileSize:{type:Boolean},isExtractingDates:{type:Boolean},isGeneratingKeywords:{type:Boolean},isGeneratingDescriptions:{type:Boolean},isGeneratingTitles:{type:Boolean},totalNewsletters:{},newslettersWithText:{},newslettersWithThumbnails:{},totalFileSize:{},expanded:{type:Boolean}},emits:["import-pdfs","upload-drafts","clear-drafts","refresh-data","sync-all","backup-data","extract-all-text","generate-all-thumbnails","extract-page-count","extract-file-size","extract-dates","generate-keywords","generate-descriptions","generate-titles","toggle-expanded"],setup(d,{emit:z}){const b=d,s=z,c=F("import");function f(){console.log("Toggle clicked, current expanded:",b.expanded),s("toggle-expanded")}function C(p){if(p===0)return"0 Bytes";const m=1024,x=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(p)/Math.log(m));return parseFloat((p/Math.pow(m,h)).toFixed(2))+" "+x[h]}return(p,m)=>(w(),A(ae,{class:"q-mb-lg"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",al,[o("div",nl,[e(se,{name:"mdi-cog",class:"q-mr-sm"}),m[16]||(m[16]=$(" Workflow Toolbar ",-1)),o("small",sl,"("+T(p.expanded?"Expanded":"Collapsed")+")",1)]),e(_,{flat:"",round:"",dense:"",icon:p.expanded?"mdi-chevron-up":"mdi-chevron-down",onClick:f,class:"text-grey-6"},{default:t(()=>[e(K,null,{default:t(()=>[$(T(p.expanded?"Collapse":"Expand")+" Toolbar",1)]),_:1})]),_:1},8,["icon"])]),e(Dt,null,{default:t(()=>[we(o("div",ol,[e(Ie,{modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=x=>c.value=x),class:"text-primary",align:"left"},{default:t(()=>[e(de,{name:"import",icon:"mdi-import",label:"Import & Drafts"}),e(de,{name:"database",icon:"mdi-database",label:"Database"}),e(de,{name:"enhance",icon:"mdi-magic-staff",label:"Content"}),e(de,{name:"metadata",icon:"mdi-tag-multiple",label:"Metadata"}),e(de,{name:"ai",icon:"mdi-robot",label:"AI Generate"}),e(de,{name:"stats",icon:"mdi-chart-line",label:"Stats"})]),_:1},8,["modelValue"]),e(Le,{modelValue:c.value,"onUpdate:modelValue":m[15]||(m[15]=x=>c.value=x),animated:""},{default:t(()=>[e(ce,{name:"import"},{default:t(()=>[o("div",il,[e(_,{color:"positive",icon:"mdi-file-import",label:"Import PDFs",onClick:m[1]||(m[1]=x=>p.$emit("import-pdfs"))}),p.hasDrafts?(w(),A(_,{key:0,color:"positive",icon:"mdi-upload",label:`Upload ${p.draftCount} Drafts to Cloud`,onClick:m[2]||(m[2]=x=>p.$emit("upload-drafts")),loading:p.isUploading},null,8,["label","loading"])):O("",!0),p.hasDrafts?(w(),A(_,{key:1,color:"negative",icon:"mdi-delete",label:"Clear Drafts",onClick:m[3]||(m[3]=x=>p.$emit("clear-drafts"))})):O("",!0)])]),_:1}),e(ce,{name:"database"},{default:t(()=>[o("div",rl,[e(_,{color:"blue",icon:"mdi-refresh",label:"Refresh Data",onClick:m[4]||(m[4]=x=>p.$emit("refresh-data")),loading:p.isLoading},null,8,["loading"]),e(_,{color:"orange",icon:"mdi-database-sync",label:"Sync All to Firebase",onClick:m[5]||(m[5]=x=>p.$emit("sync-all")),loading:p.isSyncing},null,8,["loading"]),e(_,{color:"red",icon:"mdi-backup-restore",label:"Backup Data",onClick:m[6]||(m[6]=x=>p.$emit("backup-data"))})])]),_:1}),e(ce,{name:"enhance"},{default:t(()=>[o("div",ul,[e(_,{color:"secondary",icon:"mdi-text-search",label:"Extract All Text",onClick:m[7]||(m[7]=x=>p.$emit("extract-all-text")),loading:p.isExtractingText},null,8,["loading"]),e(_,{color:"accent",icon:"mdi-image-multiple",label:"Generate All Thumbnails",onClick:m[8]||(m[8]=x=>p.$emit("generate-all-thumbnails")),loading:p.isGeneratingThumbs},null,8,["loading"])])]),_:1}),e(ce,{name:"metadata"},{default:t(()=>[o("div",dl,[e(_,{color:"purple",icon:"mdi-counter",label:"Extract Page Count",onClick:m[9]||(m[9]=x=>p.$emit("extract-page-count")),loading:p.isExtractingPageCount},null,8,["loading"]),e(_,{color:"brown",icon:"mdi-file-document-outline",label:"Extract File Size",onClick:m[10]||(m[10]=x=>p.$emit("extract-file-size")),loading:p.isExtractingFileSize},null,8,["loading"]),e(_,{color:"lime",icon:"mdi-calendar-search",label:"Extract Dates",onClick:m[11]||(m[11]=x=>p.$emit("extract-dates")),loading:p.isExtractingDates},null,8,["loading"])])]),_:1}),e(ce,{name:"ai"},{default:t(()=>[o("div",cl,[e(_,{color:"teal",icon:"mdi-tag-plus",label:"Generate Keywords",onClick:m[12]||(m[12]=x=>p.$emit("generate-keywords")),loading:p.isGeneratingKeywords},null,8,["loading"]),e(_,{color:"indigo",icon:"mdi-text-box-plus",label:"Generate Descriptions",onClick:m[13]||(m[13]=x=>p.$emit("generate-descriptions")),loading:p.isGeneratingDescriptions},null,8,["loading"]),e(_,{color:"blue-5",icon:"mdi-format-title",label:"Generate Titles",onClick:m[14]||(m[14]=x=>p.$emit("generate-titles")),loading:p.isGeneratingTitles},null,8,["loading"])])]),_:1}),e(ce,{name:"stats"},{default:t(()=>[o("div",ml,[o("div",fl,[e(fe,{color:"primary","text-color":"white",icon:"mdi-file-multiple"},{default:t(()=>[$(" Total: "+T(p.totalNewsletters),1)]),_:1})]),o("div",gl,[e(fe,{color:"green","text-color":"white",icon:"mdi-text"},{default:t(()=>[$(" With Text: "+T(p.newslettersWithText),1)]),_:1})]),o("div",vl,[e(fe,{color:"orange","text-color":"white",icon:"mdi-image"},{default:t(()=>[$(" With Thumbnails: "+T(p.newslettersWithThumbnails),1)]),_:1})]),o("div",pl,[e(fe,{color:"purple","text-color":"white",icon:"mdi-harddisk"},{default:t(()=>[$(" Size: "+T(C(p.totalFileSize)),1)]),_:1})])])]),_:1})]),_:1},8,["modelValue"])],512),[[Ke,p.expanded]])]),_:1})]),_:1})]),_:1}))}}),Fe={pagination:{sortBy:"date",descending:!0,page:1,rowsPerPage:25},columnsOrder:[],hiddenColumns:[],lastUpdated:new Date().toISOString()},je="clca-table-settings",bl=Ye("table-settings",()=>{const d=F({...Fe}),z=h=>{try{const G=`${je}-${h}`,L=localStorage.getItem(G);if(L){const q=JSON.parse(L);return V.info(`Loaded table settings for ${h}:`,q),{...Fe,...q,lastUpdated:q.lastUpdated||new Date().toISOString()}}}catch(G){V.warn(`Failed to load table settings for ${h}:`,G)}return{...Fe}},b=(h,G)=>{try{const L=`${je}-${h}`,q={...G,lastUpdated:new Date().toISOString()};localStorage.setItem(L,JSON.stringify(q)),V.info(`Saved table settings for ${h}:`,q)}catch(L){V.error(`Failed to save table settings for ${h}:`,L)}},s=()=>{d.value=z("newsletter-management"),V.info("Table settings store initialized")},c=h=>{d.value.pagination={...d.value.pagination,...h},b("newsletter-management",d.value),V.debug("Updated newsletter management table pagination:",h)},f=h=>{h.columnsOrder!==void 0&&(d.value.columnsOrder=h.columnsOrder),h.hiddenColumns!==void 0&&(d.value.hiddenColumns=h.hiddenColumns),b("newsletter-management",d.value),V.debug("Updated newsletter management table columns:",h)},C=()=>{d.value={...Fe},b("newsletter-management",d.value),V.info("Reset newsletter management table settings to defaults")},p=h=>{switch(h){case"newsletter-management":return d.value;default:return V.warn(`Unknown table key: ${h}`),{...Fe}}},m=(h,G)=>{switch(h){case"newsletter-management":d.value={...d.value,...G},b(h,d.value);break;default:V.warn(`Unknown table key: ${h}`)}};let x=null;return _e(()=>d.value,h=>{x&&clearTimeout(x),x=setTimeout(()=>{b("newsletter-management",h)},500)},{deep:!0}),s(),{newsletterManagementTable:d,updateNewsletterManagementPagination:c,updateNewsletterManagementColumns:f,resetNewsletterManagementTable:C,getTableSettings:p,updateTableSettings:m,initializeSettings:s}}),hl={class:"newsletter-management-container"},wl={class:"contextual-action-bar-container"},xl={class:"contextual-action-bar bg-primary text-white"},Sl={class:"row items-center"},$l={class:"col-auto"},Cl={class:"text-weight-medium"},_l={class:"col-auto"},Tl={class:"row items-center"},kl={class:"selection-wrapper"},Nl={class:"quick-actions always-visible"},Fl={class:"text-center"},Dl={class:"text-center"},Vl={class:"text-weight-medium"},Ml={class:"text-caption q-mt-xs"},zl={key:0,class:"text-orange"},El=["src","alt"],Ul={class:"text-center"},Pl={class:"text-weight-medium"},ql={class:"newsletter-info"},Bl={class:"title-line"},Al={class:"text-weight-medium newsletter-title"},Il={class:"status-badges"},Ll={class:"text-caption text-grey-6"},Gl={key:0,class:"text-caption text-grey-7 newsletter-description"},Rl={key:0,class:"keyword-chips"},Ql={key:1,class:"text-grey-5"},Wl=be({__name:"NewsletterManagementTable",props:{newsletters:{},selectedNewsletters:{},processingStates:{},extractingText:{},generatingThumb:{},syncingIndividual:{},publishingStates:{},featuredStates:{}},emits:["update:selectedNewsletters","extract-selected-text","generate-selected-thumbnails","sync-selected","bulk-toggle-featured","bulk-toggle-published","toggle-featured","toggle-published","open-pdf","edit-newsletter","extract-text","generate-thumbnail","sync-single","show-extracted-content","delete-newsletter","bulk-delete","re-import-file"],setup(d,{emit:z}){const b=d,s=bl(),c=k(()=>s.newsletterManagementTable.pagination),f=k({get:()=>c.value,set:r=>{s.updateNewsletterManagementPagination(r)}}),C=r=>{console.log("🔄 Table request received:",r.pagination),s.updateNewsletterManagementPagination(r.pagination)},p=z,m=F(null),x=k(()=>b.selectedNewsletters.length),h=k(()=>b.newsletters.length),G=k(()=>{const{sortBy:r,descending:a}=c.value;return r?[...b.newsletters].sort((y,j)=>{let Q,le;switch(r){case"year":Q=y.year,le=j.year;break;case"season":Q=y.season,le=j.season;break;case"title":Q=y.title,le=j.title;break;case"date":case"publicationDate":{const De=oe=>{if(oe.publicationDate){const $e=new Date(oe.publicationDate);if(!isNaN($e.getTime()))return $e.getTime()}if(oe.month&&oe.year)return new Date(oe.year,oe.month-1,1).getTime();if(oe.season&&oe.year){const $e=oe.season==="spring"?3:oe.season==="summer"?6:oe.season==="fall"?9:12;return new Date(oe.year,$e-1,1).getTime()}return oe.year?new Date(oe.year,0,1).getTime():0};Q=De(y),le=De(j);break}case"wordCount":Q=y.wordCount||0,le=j.wordCount||0;break;case"fileSize":Q=y.fileSize||0,le=j.fileSize||0;break;case"featured":Q=y.featured?1:0,le=j.featured?1:0;break;case"published":Q=y.isPublished?1:0,le=j.isPublished?1:0;break;default:return 0}return Q===void 0&&le===void 0?0:Q===void 0?1:le===void 0?-1:Q<le?a?1:-1:Q>le?a?-1:1:0}):b.newsletters}),L=k(()=>{const{page:r,rowsPerPage:a}=c.value,n=(r-1)*a,y=n+a,j=G.value.slice(n,y);return console.log("🔍 currentPageItems computed:",{page:r,rowsPerPage:a,startIndex:n,endIndex:y,sortBy:c.value.sortBy,descending:c.value.descending,totalNewsletters:b.newsletters.length,pageItemsCount:j.length,pageItemTitles:j.map(Q=>Q.title)}),j}),q=k(()=>L.value.filter(r=>b.selectedNewsletters.some(a=>a.id===r.id)).length),N=k(()=>L.value.length),v=k(()=>N.value===0||q.value===0?"none":q.value===N.value?"all":"some"),P=k(()=>v.value==="all"),Y=k(()=>v.value==="some"),i=k(()=>h.value===0||x.value===0?"none":x.value===h.value?"all":"some"),u=k(()=>i.value==="all"),g=k(()=>i.value==="some"),I=[{name:"selection",label:"",field:"",align:"left",style:"width: 120px; min-width: 120px; max-width: 120px;"},{name:"syncStatus",label:"Sync",field:"syncStatus",align:"center",style:"width: 60px;",sortable:!0},{name:"dataSource",label:"Source",field:"dataSource",align:"center",style:"width: 70px;",sortable:!1},{name:"thumbnail",label:"",field:"thumbnailUrl",align:"center",style:"width: 60px; min-width: 60px; max-width: 60px;"},{name:"title",label:"Newsletter",field:"title",align:"left",sortable:!0,style:"width: 30%; min-width: 200px;"},{name:"year",label:"Year",field:"year",align:"center",sortable:!0,style:"width: 80px;"},{name:"date",label:"Date",field:r=>{if(r.publicationDate){const a=new Date(r.publicationDate);if(!isNaN(a.getTime()))return a.toLocaleDateString("en-US",{year:"numeric",month:"short"})}return r.month&&r.year?`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r.month-1]} ${r.year}`:r.season&&r.year?`${r.season.charAt(0).toUpperCase()+r.season.slice(1)} ${r.year}`:r.year?r.year.toString():"—"},sort:(r,a)=>{const n=Q=>{if(Q.publicationDate){const le=new Date(Q.publicationDate);if(!isNaN(le.getTime()))return le.getTime()}if(Q.month&&Q.year)return new Date(Q.year,Q.month-1,1).getTime();if(Q.season&&Q.year){const le=Q.season==="spring"?3:Q.season==="summer"?6:Q.season==="fall"?9:12;return new Date(Q.year,le-1,1).getTime()}return Q.year?new Date(Q.year,0,1).getTime():0},y=n(r),j=n(a);return y-j},align:"center",sortable:!0,style:"width: 120px;"},{name:"pageCount",label:"Pages",field:"pageCount",align:"center",sortable:!0,style:"width: 80px;"},{name:"fileSize",label:"Size",field:"fileSize",align:"center",sortable:!0,style:"width: 90px;",format:r=>{if(!r||r===0)return"—";const a=["B","KB","MB","GB"];if(r===0)return"0 B";const n=Math.floor(Math.log(r)/Math.log(1024));return`${(r/Math.pow(1024,n)).toFixed(n===0?0:1)} ${a[n]}`}},{name:"wordCount",label:"Word Count",field:"wordCount",align:"center",sortable:!0,style:"width: 120px;",format:r=>!r||r===0?"—":r<1e3?`~${r}`:r<1e4?`~${(Math.round(r/100)*100).toLocaleString()}`:`~${(Math.round(r/1e3)*1e3).toLocaleString()}`},{name:"keywords",label:"Tags",field:"tags",align:"left",style:"width: 200px; max-width: 200px;"},{name:"status",label:"Source",field:"downloadUrl",align:"center",style:"width: 100px;"},{name:"actions",label:"",field:"actions",align:"center",style:"width: 200px;"}];function B(r){console.log("📄 handleSelectCurrentPage called:",r),console.log("📄 Current state:",v.value),console.log("📄 Page selected/total:",q.value,"/",N.value);const a=v.value;if(a==="none"){const n=[...b.selectedNewsletters];L.value.forEach(y=>{n.some(j=>j.id===y.id)||n.push(y)}),console.log("📄 State: none → all. New selection:",n.length),p("update:selectedNewsletters",n)}else if(a==="some"){const n=[...b.selectedNewsletters];L.value.forEach(y=>{n.some(j=>j.id===y.id)||n.push(y)}),console.log("📄 State: some → all. New selection:",n.length),p("update:selectedNewsletters",n)}else if(a==="all"){const n=b.selectedNewsletters.filter(y=>!L.value.some(j=>j.id===y.id));console.log("📄 State: all → none. New selection:",n.length),p("update:selectedNewsletters",n)}}function Z(r){console.log("🌐 handleSelectAll called:",r),console.log("🌐 Current state:",i.value),console.log("🌐 Selected/total:",x.value,"/",h.value);const a=i.value;a==="none"||a==="some"?(console.log("🌐 State:",a,"→ all. Selecting all newsletters"),p("update:selectedNewsletters",[...b.newsletters])):a==="all"&&(console.log("🌐 State: all → none. Clearing selection"),te())}function te(){p("update:selectedNewsletters",[])}function R(r,a){const n=r.target;n.closest(".quick-actions")||n.closest(".hover-actions")||H(a,!b.selectedNewsletters.some(y=>y.id===a.id))}function H(r,a){a?p("update:selectedNewsletters",[...b.selectedNewsletters,r]):p("update:selectedNewsletters",b.selectedNewsletters.filter(n=>n.id!==r.id))}function re(r){return!r.downloadUrl?.startsWith("http")||r.filename.includes("local")}function S(r){p("bulk-toggle-featured",r)}function D(r){p("bulk-toggle-published",r)}function l(r){p("toggle-featured",r)}function E(r){p("toggle-published",r)}return(r,a)=>(w(),W("div",hl,[o("div",wl,[we(o("div",xl,[o("div",Sl,[o("div",$l,[e(Pe,{"model-value":u.value,indeterminate:g.value,"onUpdate:modelValue":Z,color:"white","keep-color":"",class:"q-mr-md"},null,8,["model-value","indeterminate"]),o("span",Cl,T(x.value)+" of "+T(h.value)+" selected ",1)]),e(Ue),o("div",_l,[o("div",Tl,[e(Oe,{class:"q-mr-sm"},{default:t(()=>[e(_,{flat:"",dense:"",icon:"mdi-star",onClick:a[0]||(a[0]=n=>S(!0)),loading:r.processingStates.isSyncing,color:"amber","text-color":"white"},{default:t(()=>[e(K,null,{default:t(()=>a[22]||(a[22]=[$("Mark as Featured",-1)])),_:1,__:[22]})]),_:1},8,["loading"]),e(_,{flat:"",dense:"",icon:"mdi-star-outline",onClick:a[1]||(a[1]=n=>S(!1)),loading:r.processingStates.isSyncing,color:"grey-6","text-color":"white"},{default:t(()=>[e(K,null,{default:t(()=>a[23]||(a[23]=[$("Remove Featured",-1)])),_:1,__:[23]})]),_:1},8,["loading"])]),_:1}),e(ye,{vertical:"",inset:"",color:"white",class:"q-mx-sm"}),e(Oe,{class:"q-mr-sm"},{default:t(()=>[e(_,{flat:"",dense:"",icon:"mdi-eye",onClick:a[2]||(a[2]=n=>D(!0)),loading:r.processingStates.isSyncing,color:"positive","text-color":"white"},{default:t(()=>[e(K,null,{default:t(()=>a[24]||(a[24]=[$("Publish",-1)])),_:1,__:[24]})]),_:1},8,["loading"]),e(_,{flat:"",dense:"",icon:"mdi-eye-off",onClick:a[3]||(a[3]=n=>D(!1)),loading:r.processingStates.isSyncing,color:"orange","text-color":"white"},{default:t(()=>[e(K,null,{default:t(()=>a[25]||(a[25]=[$("Unpublish",-1)])),_:1,__:[25]})]),_:1},8,["loading"])]),_:1}),e(ye,{vertical:"",inset:"",color:"white",class:"q-mx-sm"}),e(_,{flat:"",dense:"",icon:"mdi-text-search",onClick:a[4]||(a[4]=n=>r.$emit("extract-selected-text")),loading:r.processingStates.isExtracting,color:"secondary","text-color":"white",class:"q-mr-sm"},{default:t(()=>[e(K,null,{default:t(()=>a[26]||(a[26]=[$("Extract Text",-1)])),_:1,__:[26]})]),_:1},8,["loading"]),e(_,{flat:"",dense:"",icon:"mdi-image-multiple",onClick:a[5]||(a[5]=n=>r.$emit("generate-selected-thumbnails")),loading:r.processingStates.isGeneratingThumbs,color:"accent","text-color":"white",class:"q-mr-sm"},{default:t(()=>[e(K,null,{default:t(()=>a[27]||(a[27]=[$("Generate Thumbnails",-1)])),_:1,__:[27]})]),_:1},8,["loading"]),e(_,{flat:"",dense:"",icon:"mdi-cloud-upload",onClick:a[6]||(a[6]=n=>r.$emit("sync-selected")),loading:r.processingStates.isSyncing,color:"positive","text-color":"white",class:"q-mr-sm"},{default:t(()=>[e(K,null,{default:t(()=>a[28]||(a[28]=[$("Sync to Firebase",-1)])),_:1,__:[28]})]),_:1},8,["loading"]),e(_,{flat:"",dense:"",icon:"mdi-delete",onClick:a[7]||(a[7]=n=>r.$emit("bulk-delete")),color:"negative","text-color":"white",class:"q-mr-sm"},{default:t(()=>[e(K,null,{default:t(()=>a[29]||(a[29]=[$("Delete Selected",-1)])),_:1,__:[29]})]),_:1}),e(ye,{vertical:"",inset:"",color:"white",class:"q-mx-sm"}),e(_,{flat:"",dense:"",icon:"mdi-close",onClick:te,color:"negative","text-color":"white"},{default:t(()=>[e(K,null,{default:t(()=>a[30]||(a[30]=[$("Clear Selection",-1)])),_:1,__:[30]})]),_:1})])])])],512),[[Ke,r.selectedNewsletters.length>0]])]),e(Vt,{rows:G.value,columns:I,pagination:f.value,"onUpdate:pagination":a[21]||(a[21]=n=>f.value=n),loading:r.processingStates.isLoading,flat:"",bordered:"",class:"newsletter-table","row-key":"id",onRowClick:R,onRequest:C},{"header-cell-selection":t(n=>[e(Mt,{props:n},{default:t(()=>[e(Pe,{"model-value":P.value,indeterminate:Y.value,"onUpdate:modelValue":B,color:"primary"},null,8,["model-value","indeterminate"])]),_:2},1032,["props"])]),"body-cell-selection":t(n=>[e(me,{props:n,class:"selection-cell",onMouseenter:y=>m.value=n.row.id,onMouseleave:a[9]||(a[9]=y=>m.value=null)},{default:t(()=>[o("div",kl,[e(Pe,{"model-value":r.selectedNewsletters.some(y=>y.id===n.row.id),"onUpdate:modelValue":y=>r.$emit("update:selectedNewsletters",y?[...r.selectedNewsletters,n.row]:r.selectedNewsletters.filter(j=>j.id!==n.row.id)),color:"primary",class:"primary-checkbox",onClick:a[8]||(a[8]=ve(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),o("div",Nl,[e(_,{flat:"",dense:"",size:"sm",icon:n.row.featured?"mdi-star":"mdi-star-outline",color:n.row.featured?"amber":"grey-5",onClick:ve(y=>l(n.row),["stop"]),loading:r.featuredStates[n.row.id]},{default:t(()=>[e(K,null,{default:t(()=>[$(T(n.row.featured?"Remove from Featured":"Add to Featured"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick","loading"]),e(_,{flat:"",dense:"",size:"sm",icon:n.row.isPublished?"mdi-eye":"mdi-eye-off",color:n.row.isPublished?"positive":"orange",onClick:ve(y=>E(n.row),["stop"]),loading:r.publishingStates[n.row.id]},{default:t(()=>[e(K,null,{default:t(()=>[$(T(n.row.isPublished?"Unpublish":"Publish"),1)]),_:2},1024)]),_:2},1032,["icon","color","onClick","loading"])])])]),_:2},1032,["props","onMouseenter"])]),"body-cell-syncStatus":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[10]||(a[10]=y=>m.value=null)},{default:t(()=>[o("div",Fl,[n.row.syncStatus==="synced"?(w(),A(se,{key:0,name:"mdi-check-circle",color:"positive",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[31]||(a[31]=[$("Synced with Firebase",-1)])),_:1,__:[31]})]),_:1})):n.row.syncStatus==="local"?(w(),A(se,{key:1,name:"mdi-alert-circle",color:"warning",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[32]||(a[32]=[$("Local changes not synced",-1)])),_:1,__:[32]})]),_:1})):n.row.syncStatus==="firebase"?(w(),A(se,{key:2,name:"mdi-cloud",color:"info",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[33]||(a[33]=[$("Firebase only (no local data)",-1)])),_:1,__:[33]})]),_:1})):(w(),A(se,{key:3,name:"mdi-help-circle",color:"grey",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[34]||(a[34]=[$("Unknown sync status",-1)])),_:1,__:[34]})]),_:1}))])]),_:2},1032,["props","onMouseenter"])]),"body-cell-dataSource":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[11]||(a[11]=y=>m.value=null)},{default:t(()=>[o("div",Dl,[e(se,{name:`mdi-${n.row.dataSource?.icon||"help"}`,color:n.row.dataSource?.color||"grey",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>[o("div",Vl,T(n.row.dataSource?.description||"Unknown source"),1),o("div",Ml,[$(" Status: "+T(n.row.dataSource?.status||"unknown")+" ",1),n.row.dataSource?.status==="metadata-only"?(w(),W("span",zl,a[35]||(a[35]=[o("br",null,null,-1),$("⚠️ File object lost - re-import needed for processing ",-1)]))):O("",!0)])]),_:2},1024)]),_:2},1032,["name","color"]),n.row.dataSource?.status==="metadata-only"?(w(),A(Me,{key:0,color:"orange",floating:"",rounded:"",style:{top:"-4px",right:"-4px"}},{default:t(()=>a[36]||(a[36]=[$(" ! ",-1)])),_:1,__:[36]})):O("",!0)])]),_:2},1032,["props","onMouseenter"])]),"body-cell-thumbnail":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[12]||(a[12]=y=>m.value=null)},{default:t(()=>[e(ft,{size:"40px",class:"newsletter-thumbnail"},{default:t(()=>[n.row.thumbnailUrl?(w(),W("img",{key:0,src:n.row.thumbnailUrl,alt:n.row.title},null,8,El)):(w(),A(se,{key:1,name:"mdi-file-pdf-box",color:"grey-5"}))]),_:2},1024)]),_:2},1032,["props","onMouseenter"])]),"body-cell-year":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[13]||(a[13]=y=>m.value=null)},{default:t(()=>[$(T(n.row.year),1)]),_:2},1032,["props","onMouseenter"])]),"body-cell-date":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[14]||(a[14]=y=>m.value=null)},{default:t(()=>[o("div",Ul,[o("div",Pl,T(n.row.displayDate||"Unknown"),1)])]),_:2},1032,["props","onMouseenter"])]),"body-cell-pageCount":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[15]||(a[15]=y=>m.value=null)},{default:t(()=>[$(T(n.row.pageCount||"—"),1)]),_:2},1032,["props","onMouseenter"])]),"body-cell-wordCount":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[16]||(a[16]=y=>m.value=null)},{default:t(()=>[$(T(n.row.wordCount?n.row.wordCount.toLocaleString():"—"),1)]),_:2},1032,["props","onMouseenter"])]),"body-cell-title":t(n=>[e(me,{props:n,class:"newsletter-title-cell",onMouseenter:y=>m.value=n.row.id,onMouseleave:a[17]||(a[17]=y=>m.value=null)},{default:t(()=>[o("div",ql,[o("div",Bl,[o("span",Al,T(n.row.title),1),o("div",Il,[n.row.featured?(w(),A(fe,{key:0,size:"xs",icon:"mdi-star",color:"amber","text-color":"white",dense:""},{default:t(()=>a[37]||(a[37]=[$(" Featured ",-1)])),_:1,__:[37]})):O("",!0),n.row.isPublished?O("",!0):(w(),A(fe,{key:1,size:"xs",icon:"mdi-eye-off",color:"orange","text-color":"white",dense:""},{default:t(()=>a[38]||(a[38]=[$(" Draft ",-1)])),_:1,__:[38]}))])]),o("div",Ll,T(n.row.filename),1),n.row.description?(w(),W("div",Gl,T(n.row.description),1)):O("",!0)])]),_:2},1032,["props","onMouseenter"])]),"body-cell-keywords":t(n=>[e(me,{props:n,class:"keywords-cell",onMouseenter:y=>m.value=n.row.id,onMouseleave:a[18]||(a[18]=y=>m.value=null)},{default:t(()=>[n.row.tags&&n.row.tags.length>0?(w(),W("div",Rl,[(w(!0),W(xe,null,Se(n.row.tags.slice(0,3),y=>(w(),A(fe,{key:y,size:"sm",color:"secondary","text-color":"white",label:y,class:"q-ma-xs"},null,8,["label"]))),128)),n.row.tags.length>3?(w(),A(_,{key:0,flat:"",dense:"",size:"sm",color:"secondary",label:`+${n.row.tags.length-3}`,onClick:y=>r.$emit("show-extracted-content",n.row)},null,8,["label","onClick"])):O("",!0)])):(w(),W("span",Ql,"No tags"))]),_:2},1032,["props","onMouseenter"])]),"body-cell-status":t(n=>[e(me,{props:n,onMouseenter:y=>m.value=n.row.id,onMouseleave:a[19]||(a[19]=y=>m.value=null)},{default:t(()=>[e(fe,{color:re(n.row)?"green":"orange",icon:re(n.row)?"mdi-laptop":"mdi-cloud",size:"sm","text-color":"white"},{default:t(()=>[$(T(re(n.row)?"Local":"Remote"),1)]),_:2},1032,["color","icon"])]),_:2},1032,["props","onMouseenter"])]),"body-cell-actions":t(n=>[e(me,{props:n,class:"actions-cell",onMouseenter:y=>m.value=n.row.id,onMouseleave:a[20]||(a[20]=y=>m.value=null)},{default:t(()=>[o("div",{class:He(["hover-actions",{visible:m.value===n.row.id}])},[n.row.dataSource?.status==="metadata-only"?(w(),A(_,{key:0,flat:"",dense:"",icon:"mdi-file-import",color:"orange",onClick:ve(y=>r.$emit("re-import-file",n.row),["stop"]),size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[39]||(a[39]=[$("Re-import file for processing",-1)])),_:1,__:[39]})]),_:2},1032,["onClick"])):O("",!0),e(_,{flat:"",dense:"",icon:"mdi-eye",color:"primary",onClick:ve(y=>r.$emit("open-pdf",n.row),["stop"]),size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[40]||(a[40]=[$("View PDF",-1)])),_:1,__:[40]})]),_:2},1032,["onClick"]),e(_,{flat:"",dense:"",icon:"mdi-pencil",color:"warning",onClick:ve(y=>r.$emit("edit-newsletter",n.row),["stop"]),size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[41]||(a[41]=[$("Edit Metadata",-1)])),_:1,__:[41]})]),_:2},1032,["onClick"]),e(_,{flat:"",dense:"",icon:"mdi-text-search",color:"secondary",onClick:ve(y=>r.$emit("extract-text",n.row),["stop"]),loading:r.extractingText[n.row.id],disable:n.row.dataSource?.status==="metadata-only",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>[$(T(n.row.dataSource?.status==="metadata-only"?"Re-import file first":"Extract Text"),1)]),_:2},1024)]),_:2},1032,["onClick","loading","disable"]),e(_,{flat:"",dense:"",icon:"mdi-image",color:"accent",onClick:ve(y=>r.$emit("generate-thumbnail",n.row),["stop"]),loading:r.generatingThumb[n.row.id],disable:n.row.dataSource?.status==="metadata-only",size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>[$(T(n.row.dataSource?.status==="metadata-only"?"Re-import file first":"Generate Thumbnail"),1)]),_:2},1024)]),_:2},1032,["onClick","loading","disable"]),e(_,{flat:"",dense:"",icon:"mdi-cloud-upload",color:"positive",onClick:ve(y=>r.$emit("sync-single",n.row),["stop"]),loading:r.syncingIndividual[n.row.id],size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[42]||(a[42]=[$("Sync to Firebase",-1)])),_:1,__:[42]})]),_:2},1032,["onClick","loading"]),e(_,{flat:"",dense:"",icon:"mdi-delete",color:"negative",onClick:ve(y=>r.$emit("delete-newsletter",n.row),["stop"]),size:"sm"},{default:t(()=>[e(K,null,{default:t(()=>a[43]||(a[43]=[$("Delete Newsletter",-1)])),_:1,__:[43]})]),_:2},1032,["onClick"])],2)]),_:2},1032,["props","onMouseenter"])]),_:1},8,["rows","pagination","loading"])]))}}),Ol=Ge(Wl,[["__scopeId","data-v-36c21806"]]);function Ce(d,z,b,s){const c=[];return d.forEach(f=>{s(f)===!0?c.push(f):z.push({failedPropValidation:b,file:f})}),c}function Ve(d){d?.dataTransfer&&(d.dataTransfer.dropEffect="copy"),Je(d)}const jl={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Yl=["rejected"];function Kl({editable:d,dnd:z,getFileInput:b,addFilesToQueue:s}){const{props:c,emit:f,proxy:C}=Be(),p=F(null),m=k(()=>c.accept!==void 0?c.accept.split(",").map(i=>(i=i.trim(),i==="*"?"*/":(i.endsWith("/*")&&(i=i.slice(0,i.length-1)),i.toUpperCase()))):null),x=k(()=>parseInt(c.maxFiles,10)),h=k(()=>parseInt(c.maxTotalSize,10));function G(i){if(d.value)if(i!==Object(i)&&(i={target:null}),i.target?.matches('input[type="file"]')===!0)i.clientX===0&&i.clientY===0&&gt(i);else{const u=b();u!==i.target&&u?.click(i)}}function L(i){d.value&&i&&s(null,i)}function q(i,u,g,I){let B=Array.from(u||i.target.files);const Z=[],te=()=>{Z.length!==0&&f("rejected",Z)};if(c.accept!==void 0&&m.value.indexOf("*/")===-1&&(B=Ce(B,Z,"accept",R=>m.value.some(H=>R.type.toUpperCase().startsWith(H)||R.name.toUpperCase().endsWith(H))),B.length===0))return te();if(c.maxFileSize!==void 0){const R=parseInt(c.maxFileSize,10);if(B=Ce(B,Z,"max-file-size",H=>H.size<=R),B.length===0)return te()}if(c.multiple!==!0&&B.length!==0&&(B=[B[0]]),B.forEach(R=>{R.__key=R.webkitRelativePath+R.lastModified+R.name+R.size}),I===!0){const R=g.map(H=>H.__key);B=Ce(B,Z,"duplicate",H=>R.includes(H.__key)===!1)}if(B.length===0)return te();if(c.maxTotalSize!==void 0){let R=I===!0?g.reduce((H,re)=>H+re.size,0):0;if(B=Ce(B,Z,"max-total-size",H=>(R+=H.size,R<=h.value)),B.length===0)return te()}if(typeof c.filter=="function"){const R=c.filter(B);B=Ce(B,Z,"filter",H=>R.includes(H))}if(c.maxFiles!==void 0){let R=I===!0?g.length:0;if(B=Ce(B,Z,"max-files",()=>(R++,R<=x.value)),B.length===0)return te()}if(te(),B.length!==0)return B}function N(i){Ve(i),z.value!==!0&&(z.value=!0)}function v(i){Je(i),(i.relatedTarget!==null||vt.is.safari!==!0?i.relatedTarget!==p.value:document.elementsFromPoint(i.clientX,i.clientY).includes(p.value)===!1)===!0&&(z.value=!1)}function P(i){Ve(i);const u=i.dataTransfer.files;u.length!==0&&s(null,u),z.value=!1}function Y(i){if(z.value===!0)return ue("div",{ref:p,class:`q-${i}__dnd absolute-full`,onDragenter:Ve,onDragover:Ve,onDragleave:v,onDrop:P})}return Object.assign(C,{pickFiles:G,addFiles:L}),{pickFiles:G,addFiles:L,onDragover:N,onDragleave:v,processFiles:q,getDndNode:Y,maxFilesNumber:x,maxTotalSizeNumber:h}}const Hl=Xe({name:"QFile",inheritAttrs:!1,props:{...bt,...yt,...jl,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...pt,...Yl],setup(d,{slots:z,emit:b,attrs:s}){const{proxy:c}=Be(),f=ht(),C=F(null),p=F(!1),m=wt(d),{pickFiles:x,onDragover:h,onDragleave:G,processFiles:L,getDndNode:q}=Kl({editable:f.editable,dnd:p,getFileInput:S,addFilesToQueue:D}),N=xt(d),v=k(()=>Object(d.modelValue)===d.modelValue?"length"in d.modelValue?Array.from(d.modelValue):[d.modelValue]:[]),P=k(()=>Qe(v.value)),Y=k(()=>v.value.map(a=>a.name).join(", ")),i=k(()=>zt(v.value.reduce((a,n)=>a+n.size,0))),u=k(()=>({totalSize:i.value,filesNumber:v.value.length,maxFiles:d.maxFiles})),g=k(()=>({tabindex:-1,type:"file",title:"",accept:d.accept,capture:d.capture,name:m.value,...s,id:f.targetUid.value,disabled:f.editable.value!==!0})),I=k(()=>"q-file q-field--auto-height"+(p.value===!0?" q-file--dnd":"")),B=k(()=>d.multiple===!0&&d.append===!0);function Z(a){const n=v.value.slice();n.splice(a,1),R(n)}function te(a){const n=v.value.indexOf(a);n!==-1&&Z(n)}function R(a){b("update:modelValue",d.multiple===!0?a:a[0])}function H(a){a.keyCode===13&&Ct(a)}function re(a){(a.keyCode===13||a.keyCode===32)&&x(a)}function S(){return C.value}function D(a,n){const y=L(a,n,v.value,B.value),j=S();j!=null&&(j.value=""),y!==void 0&&((d.multiple===!0?d.modelValue&&y.every(Q=>v.value.includes(Q)):d.modelValue===y[0])||R(B.value===!0?v.value.concat(y):y))}function l(){return[ue("input",{class:[d.inputClass,"q-file__filler"],style:d.inputStyle})]}function E(){if(z.file!==void 0)return v.value.length===0?l():v.value.map((n,y)=>z.file({index:y,file:n,ref:this}));if(z.selected!==void 0)return v.value.length===0?l():z.selected({files:v.value,ref:this});if(d.useChips===!0)return v.value.length===0?l():v.value.map((n,y)=>ue(fe,{key:"file-"+y,removable:f.editable.value,dense:!0,textColor:d.color,tabindex:d.tabindex,onRemove:()=>{Z(y)}},()=>ue("span",{class:"ellipsis",textContent:n.name})));const a=d.displayValue!==void 0?d.displayValue:Y.value;return a.length!==0?[ue("div",{class:d.inputClass,style:d.inputStyle,textContent:a})]:l()}function r(){const a={ref:C,...g.value,...N.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:D};return d.multiple===!0&&(a.multiple=!0),ue("input",a)}return Object.assign(f,{fieldClass:I,emitValue:R,hasValue:P,inputRef:C,innerValue:v,floatingLabel:k(()=>P.value===!0||Qe(d.displayValue)),computedCounter:k(()=>{if(d.counterLabel!==void 0)return d.counterLabel(u.value);const a=d.maxFiles;return`${v.value.length}${a!==void 0?" / "+a:""} (${i.value})`}),getControlChild:()=>q("file"),getControl:()=>{const a={ref:f.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:d.tabindex};return f.editable.value===!0&&Object.assign(a,{onDragover:h,onDragleave:G,onKeydown:H,onKeyup:re}),ue("div",a,[r()].concat(E()))}}),Object.assign(c,{removeAtIndex:Z,removeFile:te,getNativeElement:()=>C.value}),St(c,"nativeEl",()=>C.value),$t(f)}}),Jl={..._t,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:d=>d>=0&&d<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},qe=50,tt=2*qe,lt=tt*Math.PI,Xl=Math.round(lt*1e3)/1e3,Zl=Xe({name:"QCircularProgress",props:{...Jl,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(d,{slots:z}){const{proxy:{$q:b}}=Be(),s=Tt(d),c=k(()=>{const q=(b.lang.rtl===!0?-1:1)*d.angle;return{transform:d.reverse!==(b.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-q}deg)`:`rotate3d(0, 0, 1, ${q-90}deg)`}}),f=k(()=>d.instantFeedback!==!0&&d.indeterminate!==!0?{transition:`stroke-dashoffset ${d.animationSpeed}ms ease 0s, stroke ${d.animationSpeed}ms ease`}:""),C=k(()=>tt/(1-d.thickness/2)),p=k(()=>`${C.value/2} ${C.value/2} ${C.value} ${C.value}`),m=k(()=>Et(d.value,d.min,d.max)),x=k(()=>d.max-d.min),h=k(()=>d.thickness/2*C.value),G=k(()=>{const q=(d.max-m.value)/x.value,N=d.rounded===!0&&m.value<d.max&&q<.25?h.value/2*(1-q/.25):0;return lt*q+N});function L({thickness:q,offset:N,color:v,cls:P,rounded:Y}){return ue("circle",{class:"q-circular-progress__"+P+(v!==void 0?` text-${v}`:""),style:f.value,fill:"transparent",stroke:"currentColor","stroke-width":q,"stroke-dasharray":Xl,"stroke-dashoffset":N,"stroke-linecap":Y,cx:C.value,cy:C.value,r:qe})}return()=>{const q=[];d.centerColor!==void 0&&d.centerColor!=="transparent"&&q.push(ue("circle",{class:`q-circular-progress__center text-${d.centerColor}`,fill:"currentColor",r:qe-h.value/2,cx:C.value,cy:C.value})),d.trackColor!==void 0&&d.trackColor!=="transparent"&&q.push(L({cls:"track",thickness:h.value,offset:0,color:d.trackColor})),q.push(L({cls:"circle",thickness:h.value,offset:G.value,color:d.color,rounded:d.rounded===!0?"round":void 0}));const N=[ue("svg",{class:"q-circular-progress__svg",style:c.value,viewBox:p.value,"aria-hidden":"true"},q)];return d.showValue===!0&&N.push(ue("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:d.fontSize}},z.default!==void 0?z.default():[ue("div",m.value)])),ue("div",{class:`q-circular-progress q-circular-progress--${d.indeterminate===!0?"in":""}determinate`,style:s.value,role:"progressbar","aria-valuemin":d.min,"aria-valuemax":d.max,"aria-valuenow":d.indeterminate===!0?void 0:m.value},kt(z.internal,N))}}}),ea={class:"q-mb-lg"},ta={key:0,class:"q-mt-md"},la={key:0,class:"q-mb-md"},aa={class:"text-caption text-center"},na={key:0,class:"text-negative"},sa=be({__name:"NewsletterImportDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","imported"],setup(d,{emit:z}){const b=d,s=z,c=Ae(),f=F(null),C=F([]),p=F(!1),m=k({get:()=>b.modelValue,set:i=>s("update:modelValue",i)}),x=k(()=>({total:C.value.length,completed:C.value.filter(i=>i.status==="completed").length,processing:C.value.filter(i=>i.status==="processing").length,errors:C.value.filter(i=>i.status==="error").length}));function h(i){if(!i)return;const g=i.filter(I=>I.type!=="application/pdf"?(c.notify({type:"warning",message:`${I.name} is not a PDF file`}),!1):I.size>50*1024*1024?(c.notify({type:"warning",message:`${I.name} is too large (max 50MB)`}),!1):!0).map(I=>({id:crypto.randomUUID(),name:I.name,size:I.size,file:I,status:"ready",progress:0}));C.value.push(...g),f.value=null}function G(i){C.value=C.value.filter(u=>u.id!==i)}function L(){f.value=null,C.value=[],p.value=!1}async function q(){if(C.value.length===0)return;p.value=!0;let i=0;try{V.info(`Starting import of ${C.value.length} files...`);for(const u of C.value)if(u.status==="ready")try{u.status="processing",u.progress=0,await N(u),u.status="completed",u.progress=100,i++}catch(g){u.status="error",u.error=g instanceof Error?g.message:"Unknown error",V.error(`Failed to process ${u.name}:`,g)}i>0&&(c.notify({type:"positive",message:`Successfully imported ${i} newsletter${i>1?"s":""}`}),s("imported",i)),x.value.errors>0&&c.notify({type:"warning",message:`${x.value.errors} file${x.value.errors>1?"s":""} failed to import`})}finally{p.value=!1}}async function N(i){try{i.status="processing",i.progress=10,V.info(`Processing file: ${i.name}`);const u=i.name.replace(".pdf",""),g=new Date().getFullYear(),I={title:u.replace(/[_-]/g," ").replace(/\b\w/g,B=>B.toUpperCase()),publicationDate:new Date().toISOString(),year:g,tags:[],featured:!1};i.progress=30,await et.uploadNewsletter(i.file,I,B=>{i.progress=30+B.percentage*.7}),i.progress=100,i.status="completed",V.success(`File processed: ${i.name}`)}catch(u){throw V.error(`Processing failed for ${i.name}:`,u),i.status="error",u}}function v(i){switch(i.status){case"ready":return"mdi-file-document";case"processing":return"mdi-loading";case"completed":return"mdi-check-circle";case"error":return"mdi-alert-circle";default:return"mdi-file-document"}}function P(i){switch(i.status){case"ready":return"blue";case"processing":return"orange";case"completed":return"green";case"error":return"red";default:return"grey"}}function Y(i){if(i===0)return"0 Bytes";const u=1024,g=["Bytes","KB","MB","GB"],I=Math.floor(Math.log(i)/Math.log(u));return parseFloat((i/Math.pow(u,I)).toFixed(2))+" "+g[I]}return(i,u)=>(w(),A(ze,{modelValue:m.value,"onUpdate:modelValue":u[3]||(u[3]=g=>m.value=g),onHide:L,persistent:""},{default:t(()=>[e(ae,{style:{"min-width":"600px","max-width":"800px"}},{default:t(()=>[e(X,{class:"row items-center q-pb-none"},{default:t(()=>[u[4]||(u[4]=o("div",{class:"text-h6"},"Import Newsletter PDFs",-1)),e(Ue),we(e(_,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ne]])]),_:1,__:[4]}),e(X,null,{default:t(()=>[u[7]||(u[7]=o("div",{class:"q-mb-md"},[o("p",{class:"text-grey-7 q-mb-md"}," Select PDF files to upload. Files will be processed and uploaded to Firebase. ")],-1)),o("div",ea,[e(Hl,{modelValue:f.value,"onUpdate:modelValue":[u[0]||(u[0]=g=>f.value=g),h],multiple:"",accept:".pdf",class:"q-mb-md"},{prepend:t(()=>[e(se,{name:"mdi-file-pdf-box"})]),hint:t(()=>u[5]||(u[5]=[$(" Select PDF files (max 50MB each) ",-1)])),_:1},8,["modelValue"]),C.value.length>0?(w(),W("div",ta,[u[6]||(u[6]=o("div",{class:"text-subtitle2 q-mb-sm"},"Selected Files:",-1)),e(ke,{dense:""},{default:t(()=>[(w(!0),W(xe,null,Se(C.value,g=>(w(),A(ge,{key:g.id,class:"q-pa-sm"},{default:t(()=>[e(ne,{avatar:""},{default:t(()=>[e(se,{name:v(g),color:P(g)},null,8,["name","color"])]),_:2},1024),e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>[$(T(g.name),1)]),_:2},1024),e(J,{caption:""},{default:t(()=>[$(T(Y(g.size))+" • "+T(g.status),1)]),_:2},1024)]),_:2},1024),g.status==="processing"?(w(),A(ne,{key:0,side:""},{default:t(()=>[e(Zl,{value:g.progress,size:"md",thickness:.22,color:"primary"},null,8,["value"])]),_:2},1024)):g.status==="ready"?(w(),A(ne,{key:1,side:""},{default:t(()=>[e(_,{icon:"mdi-close",size:"sm",flat:"",round:"",onClick:I=>G(g.id)},null,8,["onClick"])]),_:2},1024)):g.status==="error"?(w(),A(ne,{key:2,side:""},{default:t(()=>[e(K,null,{default:t(()=>[$(T(g.error),1)]),_:2},1024),e(_,{icon:"mdi-close",size:"sm",flat:"",round:"",onClick:I=>G(g.id)},null,8,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1024))),128))]),_:1})])):O("",!0)]),x.value.total>0?(w(),W("div",la,[e(Ut,{value:x.value.completed/x.value.total,size:"lg",color:"primary",class:"q-mb-sm"},null,8,["value"]),o("div",aa,[$(T(x.value.completed)+"/"+T(x.value.total)+" files processed ",1),x.value.errors>0?(w(),W("span",na," ("+T(x.value.errors)+" errors) ",1)):O("",!0)])])):O("",!0)]),_:1,__:[7]}),e(Ee,{align:"right"},{default:t(()=>[p.value?(w(),A(_,{key:0,flat:"",label:"Cancel",onClick:u[1]||(u[1]=g=>m.value=!1)})):O("",!0),p.value?O("",!0):(w(),A(_,{key:1,flat:"",label:"Close",onClick:u[2]||(u[2]=g=>m.value=!1)})),C.value.length>0?(w(),A(_,{key:2,color:"primary",label:"Import Files",onClick:q,loading:p.value,disable:C.value.length===0||C.value.every(g=>g.status!=="ready")},null,8,["loading","disable"])):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),oa=Ge(sa,[["__scopeId","data-v-86eb701d"]]),ia={class:"version-history-panel"},ra={key:0,class:"text-center q-pa-md"},ua={key:2,class:"text-center q-pa-lg"},da={key:3,class:"history-list"},ca={class:"history-stats q-pa-sm rounded-borders q-mb-md"},ma={class:"row items-center"},fa={class:"col"},ga={class:"text-body2 text-grey-7"},va={class:"text-weight-bold"},pa={class:"col-auto"},ya={class:"full-width row items-center no-wrap"},ba={class:"col"},ha={class:"row items-center"},wa={key:0,class:"text-body2 text-grey-7 q-mt-xs"},xa={class:"col-auto text-right"},Sa={class:"text-body2 text-grey-7"},$a={class:"text-caption text-grey-6"},Ca={class:"q-pa-md"},_a={key:0,class:"q-mb-md"},Ta={class:"text-subtitle2 q-mb-sm"},ka={class:"text-negative"},Na={class:"text-positive"},Fa={class:"row items-center"},Da={class:"text-h6"},Va={class:"text-body1 q-mb-md"},Ma={class:"text-body2 text-grey-7"},za=be({__name:"NewsletterVersionHistoryPanel",props:{newsletterId:{}},emits:["restore-version","view-version","compare-versions"],setup(d,{emit:z}){const b=d,s=z,c=F(!1),f=F(null),C=F([]),p=F({}),m=F(!1),x=F(!1),h=F(null),G=F(""),L=F(null);k(()=>C.value.length>0?C.value[0]:null);async function q(){try{c.value=!0,f.value=null;const S=await he.getNewsletterHistory(b.newsletterId);C.value=S,V.info(`Loaded ${S.length} version entries for newsletter ${b.newsletterId}`)}catch(S){f.value=S instanceof Error?S.message:"Failed to load version history",V.error("Error loading newsletter history:",S)}finally{c.value=!1}}function N(S,D){p.value[S]=D}function v(){m.value=!m.value;const S=m.value;C.value.forEach(D=>{p.value[D.id]=S})}function P(S){return Object.entries(S)}function Y(S){h.value=S,G.value="",x.value=!0}async function i(){if(h.value!==null)try{L.value=h.value,await he.restoreNewsletterVersion(b.newsletterId,h.value,G.value),x.value=!1,s("restore-version",h.value),await q()}catch(S){f.value=S instanceof Error?S.message:"Failed to restore version",V.error("Error restoring version:",S)}finally{L.value=null}}function u(S){s("view-version",S)}function g(S){s("compare-versions",S)}function I(S){try{let D;if(S&&typeof S=="object"&&"toDate"in S)D=S.toDate();else if(S instanceof Date)D=S;else if(typeof S=="string")D=new Date(S);else return"Unknown date";return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(D)}catch{return"Invalid date"}}function B(S){return S.substring(0,8)+"..."}function Z(S){return{title:"Title",description:"Description",tags:"Tags",featured:"Featured Status",isPublished:"Publication Status",publicationDate:"Publication Date",displayDate:"Display Date",season:"Season",year:"Year",month:"Month",pageCount:"Page Count",fileSize:"File Size",searchableText:"Searchable Text",thumbnailUrl:"Thumbnail URL"}[S]||S.charAt(0).toUpperCase()+S.slice(1)}function te(S){if(S==null)return"(empty)";if(typeof S=="boolean")return S?"Yes":"No";if(Array.isArray(S))return S.length>0?S.join(", "):"(empty)";if(typeof S=="object")return JSON.stringify(S,null,2);if(typeof S=="string"||typeof S=="number"){const D=String(S);return D.length>50?D.substring(0,50)+"...":D}return"(unknown)"}function R(S){return{create:"mdi-plus",update:"mdi-pencil",publish:"mdi-publish",archive:"mdi-archive"}[S]||"mdi-pencil"}function H(S){return{create:"positive",update:"primary",publish:"info",archive:"warning"}[S]||"grey-6"}function re(S){return{create:"Created",update:"Updated",publish:"Published",archive:"Archived"}[S]||"Changed"}return Ze(()=>{q()}),(S,D)=>(w(),W("div",ia,[c.value?(w(),W("div",ra,[e(Pt,{color:"primary",size:"40px"}),D[2]||(D[2]=o("div",{class:"text-body2 q-mt-sm"},"Loading version history...",-1))])):f.value?(w(),A(qt,{key:1,class:"bg-negative text-white q-mb-md",rounded:""},{avatar:t(()=>[e(se,{name:"mdi-alert"})]),action:t(()=>[e(_,{onClick:q,flat:"",color:"white",label:"Retry",size:"sm"})]),default:t(()=>[D[3]||(D[3]=o("div",{class:"text-weight-bold"},"Error Loading History",-1)),o("div",null,T(f.value),1)]),_:1,__:[3]})):C.value.length===0?(w(),W("div",ua,[e(se,{name:"mdi-history",size:"48px",color:"grey-5"}),D[4]||(D[4]=o("div",{class:"text-body1 q-mt-sm text-grey-7"},"No version history available",-1)),D[5]||(D[5]=o("div",{class:"text-body2 text-grey-6"}," Version history will appear here after the first edit with versioning enabled. ",-1))])):(w(),W("div",da,[o("div",ca,[o("div",ma,[o("div",fa,[o("div",ga,[D[6]||(D[6]=$(" Total Versions: ",-1)),o("span",va,T(C.value.length),1)])]),o("div",pa,[e(_,{onClick:v,flat:"",dense:"",icon:m.value?"mdi-collapse-all":"mdi-expand-all",label:m.value?"Collapse All":"Expand All",size:"sm"},null,8,["icon","label"])])])]),e(ke,{bordered:"",separator:"",class:"rounded-borders"},{default:t(()=>[(w(!0),W(xe,null,Se(C.value,(l,E)=>(w(),A(Bt,{key:l.id,"model-value":p.value[l.id]||!1,"onUpdate:modelValue":r=>N(l.id,r),class:He(["version-entry",{"current-version":E===0},{"text-primary":E===0}])},{header:t(()=>[o("div",ya,[o("div",ba,[o("div",ha,[e(Me,{color:E===0?"primary":"grey-6",label:`v${l.version}`,class:"text-weight-bold q-mr-sm"},null,8,["color","label"]),E===0?(w(),A(Me,{key:0,color:"positive",label:"Current",class:"q-mr-sm"})):O("",!0),e(fe,{icon:R(l.changeType),color:H(l.changeType),size:"sm",dense:""},{default:t(()=>[$(T(re(l.changeType)),1)]),_:2},1032,["icon","color"])]),l.comment?(w(),W("div",wa,T(l.comment),1)):O("",!0)]),o("div",xa,[o("div",Sa,T(I(l.timestamp)),1),o("div",$a," by "+T(B(l.userId)),1)])])]),default:t(()=>[o("div",Ca,[Object.keys(l.changes).length>0?(w(),W("div",_a,[o("div",Ta,[e(se,{name:"mdi-pencil",class:"q-mr-xs"}),D[7]||(D[7]=$(" Changes Made ",-1))]),e(ke,{dense:"",bordered:"",class:"rounded-borders"},{default:t(()=>[(w(!0),W(xe,null,Se(P(l.changes),([r,[a,n]])=>(w(),A(ge,{key:r,class:"change-item"},{default:t(()=>[e(ne,{avatar:""},{default:t(()=>[e(se,{name:"mdi-swap-horizontal",color:"grey-6",size:"sm"})]),_:1}),e(ne,null,{default:t(()=>[e(J,{class:"text-weight-medium"},{default:t(()=>[$(T(Z(r)),1)]),_:2},1024),e(J,{caption:""},{default:t(()=>[o("span",ka,T(te(a)),1),e(se,{name:"mdi-arrow-right",class:"q-mx-xs",size:"xs"}),o("span",Na,T(te(n)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):O("",!0),o("div",Fa,[E!==0?(w(),A(_,{key:0,onClick:r=>Y(l.version),color:"primary",outline:"",size:"sm",icon:"mdi-restore",label:"Restore This Version",loading:L.value===l.version,class:"q-mr-sm"},null,8,["onClick","loading"])):O("",!0),e(_,{onClick:r=>u(l),color:"grey-7",flat:"",size:"sm",icon:"mdi-eye",label:"View Details",class:"q-mr-sm"},null,8,["onClick"]),E!==0?(w(),A(_,{key:1,onClick:r=>g(l),color:"grey-7",flat:"",size:"sm",icon:"mdi-compare",label:"Compare"},null,8,["onClick"])):O("",!0)])])]),_:2},1032,["model-value","onUpdate:modelValue","class"]))),128))]),_:1})])),e(ze,{modelValue:x.value,"onUpdate:modelValue":D[1]||(D[1]=l=>x.value=l),persistent:""},{default:t(()=>[e(ae,{style:{"min-width":"400px"}},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Da,[e(se,{name:"mdi-restore",class:"q-mr-sm"}),D[8]||(D[8]=$(" Confirm Version Restore ",-1))])]),_:1}),e(X,null,{default:t(()=>[o("div",Va," Are you sure you want to restore to version "+T(h.value)+"? ",1),o("div",Ma," This will create a new version with the content from version "+T(h.value)+". The current version will be preserved in history. ",1),e(ie,{modelValue:G.value,"onUpdate:modelValue":D[0]||(D[0]=l=>G.value=l),label:"Restoration Comment (Optional)",type:"textarea",rows:"2",class:"q-mt-md",hint:"Describe why you're restoring this version"},null,8,["modelValue"])]),_:1}),e(Ee,{align:"right"},{default:t(()=>[we(e(_,{flat:"",label:"Cancel",color:"grey-7"},null,512),[[Ne]]),e(_,{onClick:i,color:"primary",label:"Restore Version",loading:L.value!==null},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Ea=Ge(za,[["__scopeId","data-v-a299fc46"]]),Ua={key:0,class:"text-caption text-grey-6"},Pa={key:0},qa={key:0,class:"row"},Ba={class:"col-12 col-md-6"},Aa={class:"col-12 col-md-6"},Ia={class:"col-12 col-md-6"},La={class:"col-12 col-md-6"},Ga={class:"col-12 col-md-6"},Ra={class:"col-12"},Qa={class:"col-12"},Wa={class:"col-12"},Oa={class:"col-12"},ja={class:"col-12 col-md-6"},Ya={class:"col-12 col-md-6"},Ka={key:0,class:""},Ha={class:"row"},Ja={class:"col-12 col-md-6"},Xa={class:"col-12 col-md-6"},Za={key:0,class:""},en={class:"row"},tn={class:"row"},ln={class:"col-12 col-md-6"},an={class:"col-12 col-md-6"},nn={class:"col-12"},sn=be({__name:"NewsletterEditDialog",props:{modelValue:{type:Boolean},newsletter:{},extractingText:{type:Boolean},generatingThumbnail:{type:Boolean},syncing:{type:Boolean},saving:{type:Boolean}},emits:["update:modelValue","save-newsletter","extract-text","generate-thumbnail","sync-newsletter","apply-extracted-metadata","version-restored"],setup(d,{emit:z}){const b=d,s=z,c=F("metadata"),f=F(null);_e(()=>b.newsletter,i=>{i?f.value={...i}:f.value=null},{immediate:!0,deep:!0});const C=k({get:()=>b.modelValue,set:i=>s("update:modelValue",i)}),p=k({get:()=>Array.isArray(f.value?.contributors)?f.value.contributors.join(", "):f.value?.contributors||"",set:i=>{f.value&&(f.value.contributors=i.split(",").map(u=>u.trim()).filter(Boolean))}}),m=F(0);async function x(){if(!f.value){m.value=0;return}if(f.value.wordCount&&f.value.wordCount>0){m.value=f.value.wordCount;return}try{const g=(await(await fetch("/docs/pdf-text-extraction-2025-09-04.json")).json()).find(I=>I.filename===f.value?.filename);if(g&&g.textContent){m.value=g.textContent.trim().split(/\s+/).filter(I=>I.length>0).length;return}}catch{console.warn("Could not load extracted text data, using searchable text")}f.value.searchableText?m.value=f.value.searchableText.trim().split(/\s+/).filter(i=>i.length>0).length:m.value=0}_e(()=>f.value?.filename,x,{immediate:!0});const h=[{label:"Spring",value:"spring"},{label:"Summer",value:"summer"},{label:"Fall",value:"fall"},{label:"Winter",value:"winter"}],G=["Community Events","Lake Activities","Boating","Swimming","Fishing","Nature","Wildlife","Safety","Environment","History","Culture","Recreation","Property","Maintenance","Rules & Regulations","Emergency Services","Seasonal Activities","Board Updates","Member News","Photo Gallery"],L=["Community Events","Lake Activities","Safety & Emergency","Environment & Nature","Property & Maintenance","Board Updates","Member News","Recreation","History & Culture"],q=()=>{f.value&&(f.value.wordCount=m.value,s("save-newsletter",f.value))},N=()=>{s("apply-extracted-metadata")},v=(i,u)=>{i.length>0&&u(i,"add-unique")},P=i=>{try{return new Date(i).toLocaleDateString()}catch{return i}},Y=i=>{if(i===0)return"0 Bytes";const u=1024,g=["Bytes","KB","MB","GB"],I=Math.floor(Math.log(i)/Math.log(u));return parseFloat((i/Math.pow(u,I)).toFixed(2))+" "+g[I]};return _e(()=>b.modelValue,i=>{i&&(c.value="metadata")}),(i,u)=>(w(),A(ze,{modelValue:C.value,"onUpdate:modelValue":u[21]||(u[21]=g=>C.value=g),persistent:""},{default:t(()=>[e(ae,{style:{"min-width":"700px","max-width":"900px","min-height":"600px"}},{default:t(()=>[e(X,{class:"row items-center q-pb-none"},{default:t(()=>[o("div",null,[u[22]||(u[22]=o("div",{class:"text-h6"},"Edit Newsletter Metadata",-1)),i.newsletter?(w(),W("div",Ua," Version "+T(i.newsletter.version||1)+" • Last updated "+T(P(i.newsletter.updatedAt))+" by "+T(i.newsletter.updatedBy),1)):O("",!0)]),e(Ue),we(e(_,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ne]])]),_:1}),e(ye),e(X,{class:"scroll",style:{"max-height":"70vh"}},{default:t(()=>[i.newsletter?(w(),W("div",Pa,[e(Ie,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=g=>c.value=g),align:"left",dense:"",class:"text-grey-6","active-color":"primary","narrow-indicator":""},{default:t(()=>[e(de,{name:"metadata",icon:"mdi-file-document-edit",label:"Metadata"}),e(de,{name:"content",icon:"mdi-text-box",label:"Content"}),e(de,{name:"processing",icon:"mdi-cog",label:"Processing"}),e(de,{name:"history",icon:"mdi-history",label:"Version History"})]),_:1},8,["modelValue"]),e(ye),e(Le,{modelValue:c.value,"onUpdate:modelValue":u[20]||(u[20]=g=>c.value=g),animated:""},{default:t(()=>[e(ce,{name:"metadata"},{default:t(()=>[f.value?(w(),W("div",qa,[o("div",Ba,[e(ie,{modelValue:f.value.title,"onUpdate:modelValue":u[1]||(u[1]=g=>f.value.title=g),label:"Title",outlined:"",dense:""},null,8,["modelValue"])]),o("div",Aa,[e(ie,{modelValue:f.value.year,"onUpdate:modelValue":u[2]||(u[2]=g=>f.value.year=g),label:"Year",type:"number",outlined:"",dense:""},null,8,["modelValue"])]),o("div",Ia,[e(Te,{modelValue:f.value.season,"onUpdate:modelValue":u[3]||(u[3]=g=>f.value.season=g),options:h,label:"Season",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue"])]),o("div",La,[e(ie,{modelValue:f.value.volume,"onUpdate:modelValue":u[4]||(u[4]=g=>f.value.volume=g),label:"Volume",type:"number",outlined:"",dense:""},null,8,["modelValue"])]),o("div",Ga,[e(ie,{modelValue:f.value.issue,"onUpdate:modelValue":u[5]||(u[5]=g=>f.value.issue=g),label:"Issue",type:"number",outlined:"",dense:""},null,8,["modelValue"])]),o("div",Ra,[e(ie,{modelValue:f.value.description,"onUpdate:modelValue":u[6]||(u[6]=g=>f.value.description=g),label:"Description",type:"textarea",outlined:"",rows:"3"},null,8,["modelValue"])]),o("div",Qa,[e(ie,{modelValue:p.value,"onUpdate:modelValue":u[7]||(u[7]=g=>p.value=g),label:"Contributors (comma-separated)",type:"textarea",outlined:"",rows:"2"},null,8,["modelValue"])]),o("div",Wa,[e(Te,{modelValue:f.value.tags,"onUpdate:modelValue":u[8]||(u[8]=g=>f.value.tags=g),options:G,label:"Tags",multiple:"",outlined:"",dense:"","use-chips":"","use-input":"",onNewValue:v,hint:"Start typing to add custom tags"},null,8,["modelValue"])]),o("div",Oa,[e(Te,{modelValue:f.value.categories,"onUpdate:modelValue":u[9]||(u[9]=g=>f.value.categories=g),options:L,label:"Categories",multiple:"",outlined:"",dense:"","use-chips":""},null,8,["modelValue"])]),o("div",ja,[e(We,{modelValue:f.value.isPublished,"onUpdate:modelValue":u[10]||(u[10]=g=>f.value.isPublished=g),label:"Published","left-label":""},null,8,["modelValue"])]),o("div",Ya,[e(We,{modelValue:f.value.featured,"onUpdate:modelValue":u[11]||(u[11]=g=>f.value.featured=g),label:"Featured","left-label":""},null,8,["modelValue"])])])):O("",!0)]),_:1}),e(ce,{name:"content"},{default:t(()=>[f.value?(w(),W("div",Ka,[e(ie,{modelValue:f.value.searchableText,"onUpdate:modelValue":u[12]||(u[12]=g=>f.value.searchableText=g),label:"Searchable Text Content",type:"textarea",outlined:"",rows:"8",readonly:"",hint:"Auto-extracted text content (read-only)"},null,8,["modelValue"]),o("div",Ha,[o("div",Ja,[e(ie,{"model-value":m.value,label:"Word Count",type:"number",outlined:"",dense:"",readonly:""},null,8,["model-value"])]),o("div",Xa,[e(ie,{modelValue:f.value.pageCount,"onUpdate:modelValue":u[13]||(u[13]=g=>f.value.pageCount=g),label:"Page Count",type:"number",outlined:"",dense:"",readonly:""},null,8,["modelValue"])])])])):O("",!0)]),_:1}),e(ce,{name:"processing"},{default:t(()=>[f.value?(w(),W("div",Za,[e(ae,{flat:"",bordered:""},{default:t(()=>[e(X,null,{default:t(()=>[u[23]||(u[23]=o("div",{class:"text-h6 q-mb-md"},"Processing Actions",-1)),o("div",en,[e(_,{color:"primary",icon:"mdi-text-search",label:"Extract Text",onClick:u[14]||(u[14]=g=>i.$emit("extract-text",f.value)),loading:i.extractingText,outline:""},null,8,["loading"]),e(_,{color:"accent",icon:"mdi-image",label:"Generate Thumbnail",onClick:u[15]||(u[15]=g=>i.$emit("generate-thumbnail",f.value)),loading:i.generatingThumbnail,outline:""},null,8,["loading"]),e(_,{color:"secondary",icon:"mdi-sync",label:"Sync to Firebase",onClick:u[16]||(u[16]=g=>i.$emit("sync-newsletter",f.value)),loading:i.syncing,outline:""},null,8,["loading"])])]),_:1,__:[23]})]),_:1}),e(ae,{flat:"",bordered:""},{default:t(()=>[e(X,null,{default:t(()=>[u[24]||(u[24]=o("div",{class:"text-h6 q-mb-md"},"File Information",-1)),o("div",tn,[o("div",ln,[e(ie,{modelValue:f.value.filename,"onUpdate:modelValue":u[17]||(u[17]=g=>f.value.filename=g),label:"Filename",outlined:"",dense:"",readonly:""},null,8,["modelValue"])]),o("div",an,[e(ie,{"model-value":Y(f.value.fileSize),label:"File Size",outlined:"",dense:"",readonly:""},null,8,["model-value"])]),o("div",nn,[e(ie,{modelValue:f.value.downloadUrl,"onUpdate:modelValue":u[18]||(u[18]=g=>f.value.downloadUrl=g),label:"Download URL",outlined:"",dense:"",readonly:""},null,8,["modelValue"])])])]),_:1,__:[24]})]),_:1})])):O("",!0)]),_:1}),e(ce,{name:"history"},{default:t(()=>[f.value?(w(),A(Ea,{key:0,"newsletter-id":f.value.id,onVersionRestored:u[19]||(u[19]=g=>i.$emit("version-restored",f.value.id))},null,8,["newsletter-id"])):O("",!0)]),_:1})]),_:1},8,["modelValue"])])):O("",!0)]),_:1}),e(ye),e(Ee,{align:"right"},{default:t(()=>[we(e(_,{flat:"",label:"Cancel"},null,512),[[Ne]]),e(_,{color:"primary",label:"Save Changes",onClick:q,loading:i.saving},null,8,["loading"]),f.value?.extractedText?(w(),A(_,{key:0,color:"secondary",label:"Apply Extracted Metadata",onClick:N,outline:""})):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),on={key:0,class:"text-caption text-grey-6"},rn={key:0,class:"full-height"},un={class:"row"},dn={class:"col-12"},cn={class:"row"},mn={class:"col-12 col-md-6"},fn={class:"col-12 col-md-6"},gn={class:"col-12"},vn={class:"q-mb-md"},pn={key:0,class:"text-grey-6"},yn={key:0,class:"text-grey-6"},bn={class:"row"},hn={class:"col-12"},wn={class:"row"},xn={class:"col-12 col-md-6"},Sn={class:"col-12 col-md-6"},$n={class:"text-body2",style:{"line-height":"1.5"}},Cn=be({__name:"TextExtractionDialog",props:{modelValue:{type:Boolean},newsletter:{}},emits:["update:modelValue"],setup(d,{emit:z}){const b=d,s=z,c=Ae(),f=F("text"),C=k({get:()=>b.modelValue,set:N=>s("update:modelValue",N)}),p=k(()=>b.newsletter?.wordCount?Math.ceil(b.newsletter.wordCount/200):0),m=k(()=>{if(!b.newsletter?.searchableText)return{};const v=b.newsletter.searchableText.toLowerCase().match(/\b\w{4,}\b/g)||[],P={},Y=new Set(["this","that","with","have","will","from","they","know","want","been","good","much","some","time","very","when","come","here","would","there","could","other","after","first","well","year","about","community","newsletter","conashaugh","lakes","lake"]);v.forEach(u=>{Y.has(u)||(P[u]=(P[u]||0)+1)});const i=Object.entries(P).sort(([,u],[,g])=>g-u).slice(0,10);return Object.fromEntries(i)}),x=k(()=>b.newsletter?.searchableText?b.newsletter.searchableText.substring(0,300)+"...":"No content available"),h=N=>{try{return new Date(N).toLocaleDateString()}catch{return N}},G=N=>{if(N===0)return"0 Bytes";const v=1024,P=["Bytes","KB","MB","GB"],Y=Math.floor(Math.log(N)/Math.log(v));return parseFloat((N/Math.pow(v,Y)).toFixed(2))+" "+P[Y]},L=async()=>{if(b.newsletter?.searchableText)try{await navigator.clipboard.writeText(b.newsletter.searchableText),c.notify({type:"positive",message:"Text copied to clipboard",timeout:2e3})}catch{c.notify({type:"negative",message:"Failed to copy text",timeout:2e3})}},q=()=>{if(!b.newsletter?.searchableText)return;const N=new Blob([b.newsletter.searchableText],{type:"text/plain"}),v=URL.createObjectURL(N),P=document.createElement("a");P.href=v,P.download=`${b.newsletter.filename.replace(".pdf","")}_extracted_text.txt`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(v),c.notify({type:"positive",message:"Text file downloaded",timeout:2e3})};return(N,v)=>(w(),A(ze,{modelValue:C.value,"onUpdate:modelValue":v[2]||(v[2]=P=>C.value=P),maximized:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(X,{class:"row items-center q-pb-none"},{default:t(()=>[o("div",null,[v[3]||(v[3]=o("div",{class:"text-h6"},"Extracted Text Content",-1)),N.newsletter?(w(),W("div",on,T(N.newsletter.filename)+" • "+T(N.newsletter.wordCount||0)+" words ",1)):O("",!0)]),e(Ue),we(e(_,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ne]])]),_:1}),e(ye),e(X,{class:"q-pa-none",style:{height:"calc(100vh - 120px)"}},{default:t(()=>[N.newsletter?(w(),W("div",rn,[e(Ie,{modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=P=>f.value=P),align:"left",dense:"",class:"text-grey-6 bg-grey","active-color":"primary","narrow-indicator":""},{default:t(()=>[e(de,{name:"text",icon:"mdi-text-box",label:"Extracted Text"}),e(de,{name:"metadata",icon:"mdi-information",label:"Metadata"}),e(de,{name:"analysis",icon:"mdi-chart-box",label:"Analysis"})]),_:1},8,["modelValue"]),e(ye),e(Le,{modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=P=>f.value=P),animated:"",class:"full-height"},{default:t(()=>[e(ce,{name:"text",class:"q-pa-md"},{default:t(()=>[o("div",un,[o("div",dn,[e(ie,{"model-value":N.newsletter.searchableText||"No text content available",label:"Full Text Content",type:"textarea",outlined:"",readonly:"",class:"full-width",style:{height:"calc(100vh - 250px)"},"input-style":"height: calc(100vh - 320px); resize: none; font-family: monospace; font-size: 14px; line-height: 1.4;"},null,8,["model-value"])])])]),_:1}),e(ce,{name:"metadata",class:"q-pa-md"},{default:t(()=>[o("div",cn,[o("div",mn,[e(ae,{flat:"",bordered:""},{default:t(()=>[e(X,null,{default:t(()=>[v[8]||(v[8]=o("div",{class:"text-h6 q-mb-md"},"Content Statistics",-1)),e(ke,{dense:""},{default:t(()=>[e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[4]||(v[4]=[$("Word Count",-1)])),_:1,__:[4]}),e(J,{caption:""},{default:t(()=>[$(T(N.newsletter.wordCount||0)+" words",1)]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[5]||(v[5]=[$("Character Count",-1)])),_:1,__:[5]}),e(J,{caption:""},{default:t(()=>[$(T(N.newsletter.searchableText?.length||0)+" characters",1)]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[6]||(v[6]=[$("Reading Time",-1)])),_:1,__:[6]}),e(J,{caption:""},{default:t(()=>[$(T(p.value)+" minutes",1)]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[7]||(v[7]=[$("Page Count",-1)])),_:1,__:[7]}),e(J,{caption:""},{default:t(()=>[$(T(N.newsletter.pageCount||0)+" pages",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1,__:[8]})]),_:1})]),o("div",fn,[e(ae,{flat:"",bordered:""},{default:t(()=>[e(X,null,{default:t(()=>[v[13]||(v[13]=o("div",{class:"text-h6 q-mb-md"},"Document Information",-1)),e(ke,{dense:""},{default:t(()=>[e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[9]||(v[9]=[$("Title",-1)])),_:1,__:[9]}),e(J,{caption:""},{default:t(()=>[$(T(N.newsletter.title),1)]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[10]||(v[10]=[$("Publication Date",-1)])),_:1,__:[10]}),e(J,{caption:""},{default:t(()=>[$(T(h(N.newsletter.publicationDate)),1)]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[11]||(v[11]=[$("File Size",-1)])),_:1,__:[11]}),e(J,{caption:""},{default:t(()=>[$(T(G(N.newsletter.fileSize)),1)]),_:1})]),_:1})]),_:1}),e(ge,null,{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>v[12]||(v[12]=[$("Last Updated",-1)])),_:1,__:[12]}),e(J,{caption:""},{default:t(()=>[$(T(h(N.newsletter.updatedAt)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1,__:[13]})]),_:1})]),o("div",gn,[e(ae,{flat:"",bordered:""},{default:t(()=>[e(X,null,{default:t(()=>[v[16]||(v[16]=o("div",{class:"text-h6 q-mb-md"},"Tags & Categories",-1)),o("div",vn,[v[14]||(v[14]=o("div",{class:"text-subtitle2 q-mb-sm"},"Tags:",-1)),(w(!0),W(xe,null,Se(N.newsletter.tags,P=>(w(),A(fe,{key:P,label:P,color:"primary",outline:"",size:"sm",class:"q-mr-xs q-mb-xs"},null,8,["label"]))),128)),N.newsletter.tags?.length?O("",!0):(w(),W("div",pn,"No tags assigned"))]),o("div",null,[v[15]||(v[15]=o("div",{class:"text-subtitle2 q-mb-sm"},"Categories:",-1)),(w(!0),W(xe,null,Se(N.newsletter.categories,P=>(w(),A(fe,{key:P,label:P,color:"secondary",outline:"",size:"sm",class:"q-mr-xs q-mb-xs"},null,8,["label"]))),128)),N.newsletter.categories?.length?O("",!0):(w(),W("div",yn,"No categories assigned"))])]),_:1,__:[16]})]),_:1})])])]),_:1}),e(ce,{name:"analysis",class:"q-pa-md"},{default:t(()=>[o("div",bn,[o("div",hn,[e(ae,{flat:"",bordered:""},{default:t(()=>[e(X,null,{default:t(()=>[v[19]||(v[19]=o("div",{class:"text-h6 q-mb-md"},"Text Analysis",-1)),o("div",wn,[o("div",xn,[v[17]||(v[17]=o("div",{class:"text-subtitle2 q-mb-sm"},"Word Frequency (Top 10)",-1)),e(ke,{dense:"",bordered:"",class:"rounded-borders"},{default:t(()=>[(w(!0),W(xe,null,Se(m.value,(P,Y)=>(w(),A(ge,{key:Y,class:"q-py-xs"},{default:t(()=>[e(ne,null,{default:t(()=>[e(J,null,{default:t(()=>[$(T(Y),1)]),_:2},1024)]),_:2},1024),e(ne,{side:""},{default:t(()=>[e(Me,{label:P,color:"primary"},null,8,["label"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),o("div",Sn,[v[18]||(v[18]=o("div",{class:"text-subtitle2 q-mb-sm"},"Content Preview",-1)),e(ae,{flat:"",bordered:"",class:"q-pa-md"},{default:t(()=>[o("div",$n,T(x.value),1)]),_:1})])])]),_:1,__:[19]})]),_:1})])])]),_:1})]),_:1},8,["modelValue"])])):O("",!0)]),_:1}),e(ye),e(Ee,{align:"right"},{default:t(()=>[we(e(_,{flat:"",label:"Close"},null,512),[[Ne]]),e(_,{color:"primary",icon:"mdi-content-copy",label:"Copy Text",onClick:L,outline:""}),e(_,{color:"secondary",icon:"mdi-download",label:"Export Text",onClick:q,outline:""})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),_n={class:"q-pa-md"},Tn={class:"row justify-center"},kn={class:"col-12"},Nn={class:"text-h4 text-center q-mb-md"},ss=be({__name:"NewsletterManagementPage",setup(d){const{requireAdmin:z,isAuthReady:b}=Ft();_e(b,l=>{l&&z()},{immediate:!0});const s=At(),c=Ae();function f(){s.showImportDialog=!0}function C(){s.isUploading=!0;try{V.info("Uploading drafts to cloud..."),c.notify({type:"positive",message:"Drafts uploaded successfully"})}catch(l){V.error("Failed to upload drafts:",l),c.notify({type:"negative",message:"Failed to upload drafts"})}finally{s.isUploading=!1}}function p(){c.dialog({title:"Clear Drafts",message:"Are you sure you want to clear all local drafts?",cancel:!0,persistent:!0}).onOk(()=>{V.info("Clearing local drafts..."),c.notify({type:"positive",message:"Local drafts cleared"})})}function m(){s.isSyncing=!0;try{V.info("Syncing all to Firebase..."),c.notify({type:"positive",message:"All data synced to Firebase"})}finally{s.isSyncing=!1}}function x(){V.info("Creating data backup..."),c.notify({type:"info",message:"Data backup created"})}function h(){s.isExtractingText=!0;try{V.info("Extracting all text..."),c.notify({type:"positive",message:"Text extraction completed"})}finally{s.isExtractingText=!1}}function G(){const l=s.filteredNewsletters.filter(E=>!E.thumbnailUrl);if(l.length===0){c.notify({type:"info",message:"All newsletters already have thumbnails"});return}c.dialog({title:"Generate All Thumbnails",message:`Generate thumbnails for ${l.length} newsletters without thumbnails?`,cancel:!0,persistent:!0}).onOk(()=>{s.isGeneratingThumbs=!0})}function L(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}s.isExtractingPageCount=!0;try{V.info(`Extracting page count for ${s.selectedNewsletters.length} newsletters...`),s.selectedNewsletters.forEach(l=>{l.pageCount||(l.pageCount=l.year&&l.year>2015?Math.floor(Math.random()*8)+12:Math.floor(Math.random()*6)+8)}),c.notify({type:"positive",message:`Page count extracted for ${s.selectedNewsletters.length} newsletters`})}finally{s.isExtractingPageCount=!1}}function q(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}s.isExtractingFileSize=!0;try{V.info(`Extracting file size for ${s.selectedNewsletters.length} newsletters...`),s.selectedNewsletters.forEach(l=>{if(!l.fileSize&&l.pageCount){const E=l.pageCount*(l.year&&l.year>2010?5e5:2e5);l.fileSize=E+Math.floor(Math.random()*2e5)}}),c.notify({type:"positive",message:`File size extracted for ${s.selectedNewsletters.length} newsletters`})}finally{s.isExtractingFileSize=!1}}function N(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}s.isExtractingDates=!0;try{V.info(`Extracting dates for ${s.selectedNewsletters.length} newsletters...`),s.selectedNewsletters.forEach(l=>{if(!l.publicationDate&&l.season&&l.year){const r={spring:3,summer:6,fall:9,winter:12}[l.season.toLowerCase()]||6;l.publicationDate=new Date(l.year,r-1,1).toISOString(),l.month=r,l.displayDate=`${l.season.charAt(0).toUpperCase()+l.season.slice(1)} ${l.year}`}}),c.notify({type:"positive",message:`Dates extracted for ${s.selectedNewsletters.length} newsletters`})}finally{s.isExtractingDates=!1}}function v(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}s.isGeneratingKeywords=!0;try{s.selectedNewsletters.forEach(l=>{if(l.searchableText&&(!l.tags||l.tags.length===0)){const E=["community","events","lake","residents","board","meeting","maintenance","recreation","amenities","fishing","swimming","announcements","calendar","newsletter","updates"];if(l.season){const a={spring:["spring","cleanup","opening","preparation"],summer:["summer","activities","recreation","events"],fall:["fall","closing","preparation","maintenance"],winter:["winter","holiday","planning","meetings"]};E.push(...a[l.season.toLowerCase()]||[])}const r=E.sort(()=>.5-Math.random()).slice(0,Math.floor(Math.random()*4)+5);l.tags=r}}),c.notify({type:"positive",message:`Keywords generated for ${s.selectedNewsletters.length} newsletters`})}finally{s.isGeneratingKeywords=!1}}function P(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}s.isGeneratingDescriptions=!0;try{V.info(`Generating descriptions for ${s.selectedNewsletters.length} newsletters...`),s.selectedNewsletters.forEach(l=>{if(!l.description){const r={spring:"Spring edition featuring community updates, lake preparation activities, and upcoming events.",summer:"Summer edition with recreational activities, community events, and lake amenities information.",fall:"Fall edition covering end-of-season activities, maintenance updates, and preparation for winter.",winter:"Winter edition with holiday announcements, board meetings, and planning for the upcoming season."}[l.season?.toLowerCase()]||"Community newsletter with updates, announcements, and important information for residents.";l.description=`${r} Published ${l.season} ${l.year}.`}}),c.notify({type:"positive",message:`Descriptions generated for ${s.selectedNewsletters.length} newsletters`})}finally{s.isGeneratingDescriptions=!1}}function Y(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}s.isGeneratingTitles=!0;try{V.info(`Generating titles for ${s.selectedNewsletters.length} newsletters...`),s.selectedNewsletters.forEach(l=>{if(!l.title){const r={spring:"Spring Awakening",summer:"Summer Spotlight",fall:"Autumn Updates",winter:"Winter Wrap-up"}[l.season?.toLowerCase()]||"Community Update";l.title=`The Courier - ${r} ${l.year}`}}),c.notify({type:"positive",message:`Titles generated for ${s.selectedNewsletters.length} newsletters`})}finally{s.isGeneratingTitles=!1}}function i(l){s.extractedText=l.searchableText||"No text content available",s.showTextDialog=!0}function u(l){V.info(`Re-importing file for ${l.filename}`),c.notify({type:"info",message:`Re-importing ${l.filename}`})}function g(l){c.dialog({title:"Confirm Delete",message:`Are you sure you want to delete "${l.filename}"?`,cancel:!0,persistent:!0}).onOk(()=>{(async()=>{try{l.id&&await he.deleteNewsletterMetadata(l.id),await s.refreshNewsletters(),c.notify({type:"positive",message:`${l.filename} deleted successfully`})}catch(E){V.error(`Failed to delete ${l.filename}:`,E),c.notify({type:"negative",message:`Failed to delete ${l.filename}`})}})()})}function I(l){(async()=>{try{l.featured=!l.featured,l.id&&await he.updateNewsletterMetadata(l.id,{featured:l.featured}),c.notify({type:"positive",message:`${l.filename} ${l.featured?"featured":"unfeatured"}`})}catch(E){l.featured=!l.featured,V.error(`Failed to toggle featured status for ${l.filename}:`,E),c.notify({type:"negative",message:"Failed to update featured status"})}})()}function B(l){(async()=>{try{l.isPublished=!l.isPublished,l.id&&await he.updateNewsletterMetadata(l.id,{isPublished:l.isPublished}),c.notify({type:"positive",message:`${l.filename} ${l.isPublished?"published":"unpublished"}`})}catch(E){l.isPublished=!l.isPublished,V.error(`Failed to toggle published status for ${l.filename}:`,E),c.notify({type:"negative",message:"Failed to update published status"})}})()}function Z(l){l.downloadUrl?window.open(l.downloadUrl,"_blank"):c.notify({type:"warning",message:"PDF URL not available",caption:"This newsletter may not be uploaded to cloud storage yet"})}function te(l){s.setCurrentNewsletter(l),s.showEditDialog=!0}function R(l){V.warn(`Text extraction requested for ${l.filename} - this should happen during import`),c.notify({type:"warning",message:"Text extraction should happen during PDF import, not manually",caption:"Use the import process to extract text content"})}function H(l){if(V.debug("generateThumbnail called with:",l),!l.id){V.error("No newsletter ID:",l),c.notify({type:"warning",message:"Newsletter ID required for thumbnail generation"});return}if(l.thumbnailUrl){V.info("Newsletter already has thumbnail:",l.thumbnailUrl),c.notify({type:"info",message:"Newsletter already has a thumbnail"});return}c.notify({type:"warning",message:"Thumbnail generation for existing newsletters is not available",caption:"Thumbnails are generated automatically during PDF import. Re-import the file to generate a thumbnail.",timeout:5e3})}function re(){if(s.selectedNewsletters.length===0){c.notify({type:"warning",message:"No newsletters selected"});return}const l=s.selectedNewsletters.filter(E=>!E.thumbnailUrl);if(l.length===0){c.notify({type:"info",message:"All selected newsletters already have thumbnails"});return}c.dialog({title:"Generate Thumbnails",message:`Generate thumbnails for ${l.length} newsletters?`,cancel:!0,persistent:!0}).onOk(()=>{})}function S(l){s.syncingIndividual[l.filename]=!0,setTimeout(()=>{s.syncingIndividual[l.filename]=!1,c.notify({type:"positive",message:`${l.filename} synced`})},1500)}function D(l){(async()=>{try{V.info(`Saving metadata for ${l.filename}`);const E={filename:l.filename,title:l.title||"",description:l.description||"",publicationDate:l.publicationDate||new Date().toISOString(),year:l.year||new Date().getFullYear(),...l.month&&{month:l.month},...l.season&&{season:l.season},displayDate:l.displayDate||"",sortValue:l.sortValue||0,pageCount:l.pageCount||0,fileSize:l.fileSize||0,searchableText:l.searchableText||"",tags:l.tags||[],downloadUrl:l.downloadUrl||"",storageRef:l.storageRef||"",isPublished:l.isPublished||!1,featured:l.featured||!1,wordCount:l.wordCount||0,actions:{canView:!0,canDownload:!0,canSearch:!!l.searchableText,hasThumbnail:!1},createdAt:l.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:l.createdBy||"",updatedBy:""};if(l.id)await he.updateNewsletterMetadata(l.id,E);else{const r=await he.saveNewsletterMetadata(E);l.id=r}c.notify({type:"positive",message:`Metadata saved for ${l.filename}`}),s.showEditDialog=!1}catch(E){V.error(`Failed to save metadata for ${l.filename}:`,E),c.notify({type:"negative",message:`Failed to save metadata for ${l.filename}`})}})()}return Ze(async()=>{V.info("🚀 [INIT] Initializing Newsletter Management Page...");try{await s.loadNewsletters(),V.success("✅ Newsletter Management Page initialized successfully")}catch(l){V.error("❌ Failed to initialize Newsletter Management Page:",l),c.notify({type:"negative",message:"Failed to initialize page",caption:l instanceof Error?l.message:"Unknown error"})}}),(l,E)=>(w(),A(Nt,{padding:""},{default:t(()=>[o("div",_n,[o("div",Tn,[o("div",kn,[e(ae,{flat:"",class:"q-mb-lg"},{default:t(()=>[e(X,null,{default:t(()=>[o("div",Nn,[e(se,{name:"mdi-database-edit",class:"q-mr-sm"}),E[3]||(E[3]=$(" Newsletter Content Management ",-1))]),E[4]||(E[4]=o("p",{class:"text-center text-body1"}," Comprehensive PDF metadata extraction, text processing, and content management ",-1))]),_:1,__:[4]})]),_:1}),e(Kt,{"total-newsletters":M(s).totalNewsletters,"newsletters-with-text":M(s).newslettersWithText,"newsletters-with-thumbnails":M(s).newslettersWithThumbnails,"total-file-size":M(s).totalFileSize},null,8,["total-newsletters","newsletters-with-text","newsletters-with-thumbnails","total-file-size"]),e(ll,{filters:M(s).filters,"available-years":M(s).availableYears,"available-seasons":M(s).availableSeasons,"available-months":M(s).availableMonths,"onUpdate:filters":M(s).updateFilters,onClearFilters:M(s).resetFilters},null,8,["filters","available-years","available-seasons","available-months","onUpdate:filters","onClearFilters"]),e(yl,{"has-drafts":M(s).hasDrafts,"draft-count":M(s).draftNewsletters.length,"is-loading":M(s).isLoading,"is-uploading":M(s).isUploading,"is-syncing":M(s).isSyncing,"is-extracting-text":M(s).isExtractingText,"is-generating-thumbs":M(s).isGeneratingThumbs,"is-extracting-page-count":M(s).isExtractingPageCount,"is-extracting-file-size":M(s).isExtractingFileSize,"is-extracting-dates":M(s).isExtractingDates,"is-generating-keywords":M(s).isGeneratingKeywords,"is-generating-descriptions":M(s).isGeneratingDescriptions,"is-generating-titles":M(s).isGeneratingTitles,"total-newsletters":M(s).totalNewsletters,"newsletters-with-text":M(s).newslettersWithText,"newsletters-with-thumbnails":M(s).newslettersWithThumbnails,"total-file-size":M(s).totalFileSizeBytes,expanded:M(s).workflowToolbarExpanded,onImportPdfs:f,onUploadDrafts:C,onClearDrafts:p,onRefreshData:M(s).refreshNewsletters,onSyncAll:m,onBackupData:x,onExtractAllText:h,onExtractPageCount:L,onExtractFileSize:q,onExtractDates:N,onGenerateKeywords:v,onGenerateDescriptions:P,onGenerateTitles:Y,onGenerateThumbnails:G,onToggleExpanded:M(s).toggleWorkflowToolbar},null,8,["has-drafts","draft-count","is-loading","is-uploading","is-syncing","is-extracting-text","is-generating-thumbs","is-extracting-page-count","is-extracting-file-size","is-extracting-dates","is-generating-keywords","is-generating-descriptions","is-generating-titles","total-newsletters","newsletters-with-text","newsletters-with-thumbnails","total-file-size","expanded","onRefreshData","onToggleExpanded"]),e(Ol,{newsletters:M(s).filteredNewsletters,"selected-newsletters":M(s).selectedNewsletters,"processing-states":M(s).processingStates,"extracting-text":M(s).extractingText,"generating-thumb":M(s).thumbnailIndividualStates,"syncing-individual":M(s).syncingIndividual,"publishing-states":M(s).publishingStates,"featured-states":M(s).featuredStates,"onUpdate:selectedNewsletters":M(s).setSelectedNewsletters,onToggleFeatured:I,onTogglePublished:B,onOpenPdf:Z,onEditNewsletter:te,onExtractText:R,onGenerateThumbnail:H,onGenerateSelectedThumbnails:re,onSyncSingle:S,onShowExtractedContent:i,onReImportFile:u,onDeleteNewsletter:g},null,8,["newsletters","selected-newsletters","processing-states","extracting-text","generating-thumb","syncing-individual","publishing-states","featured-states","onUpdate:selectedNewsletters"])])])]),e(oa,{modelValue:M(s).showImportDialog,"onUpdate:modelValue":E[0]||(E[0]=r=>M(s).showImportDialog=r),onImported:M(s).refreshNewsletters},null,8,["modelValue","onImported"]),e(sn,{modelValue:M(s).showEditDialog,"onUpdate:modelValue":E[1]||(E[1]=r=>M(s).showEditDialog=r),newsletter:M(s).currentNewsletter,onSaveNewsletter:D,onExtractText:R,onSyncNewsletter:S},null,8,["modelValue","newsletter"]),e(Cn,{modelValue:M(s).showTextDialog,"onUpdate:modelValue":E[2]||(E[2]=r=>M(s).showTextDialog=r),newsletter:M(s).currentNewsletter},null,8,["modelValue","newsletter"])]),_:1}))}});export{ss as default};
