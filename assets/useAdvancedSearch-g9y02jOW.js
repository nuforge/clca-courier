import{k as U,aM as V,c as w,at as k,h as M,R as A,aQ as F,G as E,r as b,bm as p}from"./index-DDm66URI.js";import{Q as I}from"./QBtnGroup-Y3E2aR4E.js";import{pdfMetadataService as D}from"./pdf-metadata-service-CsES0isO.js";const $=U({name:"QBtnToggle",props:{...V,modelValue:{required:!0},options:{type:Array,required:!0,validator:l=>l.every(u=>("label"in u||"icon"in u||"slot"in u)&&"value"in u)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(l,{slots:u,emit:m}){const C=w(()=>l.options.find(i=>i.value===l.modelValue)!==void 0),r=w(()=>({type:"hidden",name:l.name,value:l.modelValue})),y=F(r),T=w(()=>k(l)),B=w(()=>({rounded:l.rounded,dense:l.dense,...T.value})),L=w(()=>l.options.map((i,f)=>{const{attrs:S,value:e,slot:a,...t}=i;return{slot:a,props:{key:f,"aria-pressed":e===l.modelValue?"true":"false",...S,...t,...B.value,disable:l.disable===!0||t.disable===!0,color:e===l.modelValue?g(t,"toggleColor"):g(t,"color"),textColor:e===l.modelValue?g(t,"toggleTextColor"):g(t,"textColor"),noCaps:g(t,"noCaps")===!0,noWrap:g(t,"noWrap")===!0,size:g(t,"size"),padding:g(t,"padding"),ripple:g(t,"ripple"),stack:g(t,"stack")===!0,stretch:g(t,"stretch")===!0,onClick(o){R(e,i,o)}}}}));function R(i,f,S){l.readonly!==!0&&(l.modelValue===i?l.clearable===!0&&(m("update:modelValue",null,null),m("clear")):m("update:modelValue",i,f),m("click",S))}function g(i,f){return i[f]===void 0?l[f]:i[f]}function x(){const i=L.value.map(f=>M(A,f.props,f.slot!==void 0?u[f.slot]:void 0));return l.name!==void 0&&l.disable!==!0&&C.value===!0&&y(i,"push"),E(u.default,i)}return()=>M(I,{class:"q-btn-toggle",...T.value,rounded:l.rounded,stretch:l.stretch,glossy:l.glossy,spread:l.spread},x)}});function j(){const l=b(!1),u=b([]),m=b(null),C=b({totalResults:0,searchTime:0,searchMode:"lightweight",cachedResults:0,cachedIssues:0,hasContentMatches:!1,averageScore:0,indexedPdfs:0}),r=b({query:"",dateRange:{start:null,end:null},contentTypes:[],categories:[],minPages:null,maxPages:null,includeContent:!1}),y=w(()=>{let e=[...u.value];return(r.value.dateRange.start||r.value.dateRange.end)&&(e=e.filter(a=>{const t=a.date?new Date(a.date):null;return!(!t||r.value.dateRange.start&&t<r.value.dateRange.start||r.value.dateRange.end&&t>r.value.dateRange.end)})),r.value.contentTypes.length>0&&(e=e.filter(a=>r.value.contentTypes.some(t=>a.title?.toLowerCase().includes(t.toLowerCase())||a.description?.toLowerCase().includes(t.toLowerCase())))),(r.value.minPages!==null||r.value.maxPages!==null)&&(e=e.filter(a=>{const t=a.pages;return!(!t||r.value.minPages!==null&&t<r.value.minPages||r.value.maxPages!==null&&t>r.value.maxPages)})),e.sort((a,t)=>t.score-a.score)});function T(e,a,t,o={}){return{id:e.id,title:e.title,date:e.date,pages:e.pages,filename:e.filename,status:e.status,syncStatus:e.syncStatus,...e.url&&{url:e.url},...e.description&&{description:e.description},...e.fileSize&&{fileSize:e.fileSize},...e.thumbnailUrl&&{thumbnailUrl:e.thumbnailUrl},...e.tags&&{tags:e.tags},...e.googleDriveFileId&&{googleDriveFileId:e.googleDriveFileId},...e.category&&{category:e.category},...e.localUrl&&{localUrl:e.localUrl},...e.googleDriveUrl&&{googleDriveUrl:e.googleDriveUrl},...e.cacheThumbnailUrl&&{cacheThumbnailUrl:e.cacheThumbnailUrl},score:a,matchType:t,snippet:o.snippet,matchedTerms:o.matchedTerms||[],issue:e}}function B(e,a,t){let o=0;const n=a.toLowerCase();switch(t){case"title":o+=100;break;case"filename":o+=80;break;case"metadata":o+=60;break;case"content":o+=40;break}if(e.title?.toLowerCase().includes(n)&&(o+=50),e.description?.toLowerCase().includes(n)&&(o+=30),e.filename?.toLowerCase().includes(n)&&(o+=40),e.date){const c=new Date(e.date),h=(Date.now()-c.getTime())/(1e3*60*60*24);h<30?o+=20:h<90&&(o+=10)}return o}function L(e,a,t=150){const o=a.toLowerCase(),c=e.toLowerCase().indexOf(o);if(c===-1)return e.slice(0,t)+(e.length>t?"...":"");const h=Math.max(0,c-50),d=Math.min(e.length,c+a.length+50),s=e.slice(h,d);return(h>0?"...":"")+s+(d<e.length?"...":"")}function R(e,a){if(!a||a.length<2)return[];const t=a.toLowerCase(),o=[];return e.forEach(n=>{let c=0,h="metadata";const d=[];n.title?.toLowerCase().includes(t)&&(c+=100,h="title",d.push(a)),n.filename?.toLowerCase().includes(t)&&(c+=80,h==="metadata"&&(h="filename"),d.push(a)),n.description?.toLowerCase().includes(t)&&(c+=60,d.push(a)),n.tags?.some(v=>v.toLowerCase().includes(t))&&(c+=40,d.push(a));const s=D.getCachedMetadata(n.filename);if(s&&(s.extractedTopics?.some(v=>v.toLowerCase().includes(t))&&(c+=30,d.push(a)),r.value.includeContent&&s.searchableText?.toLowerCase().includes(t)&&(c+=50,h="content",d.push(a))),n.date){const v=new Date(n.date),P=(Date.now()-v.getTime())/(1e3*60*60*24);P<30?c+=20:P<90&&(c+=10)}if(c>0){const v=n.description||(s?.searchableText?L(s.searchableText,a):n.title)||"";o.push(T(n,c,h,{snippet:v,matchedTerms:d}))}}),o}async function g(e,a){const t=a||r.value.query.trim();if(!t||t.length<2){u.value=[],m.value=null;return}l.value=!0,m.value=null;const o=Date.now();try{const n=R(e,t);u.value=n,await Promise.resolve();const c=n.filter(s=>s.matchType==="content").length,h=n.some(s=>s.matchType==="content"),d=n.length>0?n.reduce((s,v)=>s+v.score,0)/n.length:0;C.value={totalResults:n.length,searchTime:Date.now()-o,searchMode:r.value.includeContent?"content":"lightweight",cachedResults:c,cachedIssues:c,hasContentMatches:h,averageScore:d,indexedPdfs:e.length},console.log(`[AdvancedSearch] Found ${n.length} results in ${C.value.searchTime}ms (${c} from cached content)`)}catch(n){console.error("Search error:",n),m.value=n instanceof Error?n.message:"Search failed",u.value=[]}finally{l.value=!1}}function x(){u.value=[],m.value=null,r.value.query="",C.value={totalResults:0,searchTime:0,searchMode:"lightweight",cachedResults:0,cachedIssues:0,hasContentMatches:!1,averageScore:0,indexedPdfs:0}}function i(e){Object.assign(r.value,e)}function f(e,a){if(a.length<2)return[];const t=new Set,o=a.toLowerCase();return e.forEach(n=>{(`${n.title||""} ${n.filename||""} ${n.description||""}`.toLowerCase().match(/\b\w{3,}\b/g)||[]).forEach(s=>{s.includes(o)&&s!==o&&t.add(s)});const d=D.getCachedMetadata(n.filename);d?.extractedTopics&&d.extractedTopics.forEach(s=>{s.toLowerCase().includes(o)&&s.toLowerCase()!==o&&t.add(s)})}),Array.from(t).slice(0,8)}function S(){try{D.clearCache(),console.log("[AdvancedSearch] PDF content cache cleared")}catch(e){console.error("[AdvancedSearch] Error clearing cache:",e)}}return{isSearching:p(l),searchResults:p(u),filteredResults:y,searchError:p(m),searchStats:p(C),filters:p(r),searchFilters:p(r),performSearch:g,clearSearch:x,clearContentCache:S,updateFilters:i,getSearchSuggestions:f,calculateRelevanceScore:B,generateSnippet:L}}export{$ as Q,j as u};
