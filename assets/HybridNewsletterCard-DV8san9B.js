import{k as ge,ak as me,c as x,al as we,h as Z,R as B,am as fe,G as ve,r as $,an as he,d as pe,E as X,o as ye,I as z,J as S,a6 as W,M as c,f as n,P as F,a5 as f,a3 as _,a7 as V,a2 as y,N as T,a4 as P,aa as G,K as O,ab as be,ag as R,a9 as De,$ as J,ad as Se,F as ke,ae as ee,ao as Ne}from"./index-B4l13YHj.js";import{a as Fe,Q as Ce}from"./QBtnDropdown-CMKkdQ38.js";import{Q}from"./QTooltip-CD1bd5pY.js";import{Q as _e}from"./QImg-123gazj3.js";import{Q as Ie}from"./QSpinnerDots-B658sqUw.js";import{Q as te}from"./QChip-BHmoNq_m.js";import{Q as Pe}from"./QSpace-CIpCS4hu.js";import{Q as H,a as U,b as A}from"./QItem-8jf-usdw.js";import{Q as xe}from"./QList-DP6x53Br.js";import{C as re}from"./ClosePopup-a7FmroUF.js";import{u as Le}from"./use-quasar-BHZBCShy.js";import{p as $e}from"./pdf-metadata-service-CImhVS20.js";import{g as oe,a as ae}from"./path-utils-Bbt-OTF7.js";import{u as Te}from"./usePdfViewer-BPNJlUHg.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $t=ge({name:"QBtnToggle",props:{...me,modelValue:{required:!0},options:{type:Array,required:!0,validator:i=>i.every(e=>("label"in e||"icon"in e||"slot"in e)&&"value"in e)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(i,{slots:e,emit:t}){const a=x(()=>i.options.find(d=>d.value===i.modelValue)!==void 0),r=x(()=>({type:"hidden",name:i.name,value:i.modelValue})),s=fe(r),w=x(()=>we(i)),g=x(()=>({rounded:i.rounded,dense:i.dense,...w.value})),p=x(()=>i.options.map((d,m)=>{const{attrs:I,value:u,slot:b,...v}=d;return{slot:b,props:{key:m,"aria-pressed":u===i.modelValue?"true":"false",...I,...v,...g.value,disable:i.disable===!0||v.disable===!0,color:u===i.modelValue?h(v,"toggleColor"):h(v,"color"),textColor:u===i.modelValue?h(v,"toggleTextColor"):h(v,"textColor"),noCaps:h(v,"noCaps")===!0,noWrap:h(v,"noWrap")===!0,size:h(v,"size"),padding:h(v,"padding"),ripple:h(v,"ripple"),stack:h(v,"stack")===!0,stretch:h(v,"stretch")===!0,onClick(C){L(u,d,C)}}}}));function L(d,m,I){i.readonly!==!0&&(i.modelValue===d?i.clearable===!0&&(t("update:modelValue",null,null),t("clear")):t("update:modelValue",d,m),t("click",I))}function h(d,m){return d[m]===void 0?i[m]:d[m]}function k(){const d=p.value.map(m=>Z(B,m.props,m.slot!==void 0?e[m.slot]:void 0));return i.name!==void 0&&i.disable!==!0&&a.value===!0&&s(d,"push"),ve(e.default,d)}return()=>Z(Fe,{class:"q-btn-toggle",...w.value,rounded:i.rounded,stretch:i.stretch,glossy:i.glossy,spread:i.spread},k)}});function Ae(i){return i.includes("drive.google.com")}function ze(i){const e=[/\/file\/d\/([a-zA-Z0-9_-]+)/,/\/uc\?.*[?&]id=([a-zA-Z0-9_-]+)/,/\/open\?id=([a-zA-Z0-9_-]+)/];for(const t of e){const a=i.match(t);if(a&&a[1])return a[1]}return null}function le(i){if(i.includes("uc?export=view"))return i;const e=ze(i);return e?`https://drive.google.com/uc?export=view&id=${e}`:i}class Be{cache=new Map;localBasePath=oe("issues/");driveBaseUrl="https://drive.google.com/file/d/";constructor(){this.initializeService()}initializeService(){console.log("[NewsletterService] Initializing hybrid newsletter service with REAL Google Drive integration"),console.log("[NewsletterService] Google Drive Folder IDs:"),console.log("- Issues Folder:",""),console.log("- PDFs Folder:",""),console.log("- API Key:","Missing ❌"),console.log("- Client ID:","Missing ❌")}async getNewsletters(){const e="newsletters";if(this.cache.has(e))return this.cache.get(e);console.log("[NewsletterService] Loading newsletters from REAL sources...");try{const t=this.discoverLocalPDFs();console.log(`[NewsletterService] Found ${t.length} local PDF files`);let r=(await $e.processPDFBatch(t)).map(w=>this.convertPDFMetadataToNewsletter(w));const s=await this.discoverGoogleDriveNewsletters();if(r=this.mergeLocalAndDriveSources(r,s),r.length===0){console.log("[NewsletterService] NO REAL DATA FOUND - using JSON fallback");const w=await this.loadFallbackNewsletters();r=this.mergeFallbackData(r,w)}return r.sort((w,g)=>new Date(g.publishDate||"").getTime()-new Date(w.publishDate||"").getTime()),this.cache.set(e,r),console.log(`[NewsletterService] Generated metadata for ${r.length} newsletters`,`(${r.filter(w=>w.localFile).length} local, ${r.filter(w=>w.driveId).length} drive, ${r.filter(w=>w.localFile&&w.driveId).length} hybrid)`),r}catch(t){console.error("[NewsletterService] Error generating newsletters:",t);const a=await this.loadFallbackNewsletters();return console.log(`[NewsletterService] Fallback: Loaded ${a.length} newsletters from JSON`),a}}discoverLocalPDFs(){return["2024.02-conashaugh-courier.pdf","2024.03-conashaugh-courier.pdf","2024.04-conashaugh-courier.pdf","2024.05-conashaugh-courier.pdf","2024.06-conashaugh-courier.pdf","2024.08-conashaugh-courier.pdf","2024.09-conashaugh-courier.pdf","2024.10-conashaugh-courier.pdf","2024.11-conashaugh-courier.pdf","2024.12-conashaugh-courier.pdf","2025.02-conashaugh-courier.pdf","2025.05-conashaugh-courier.pdf","2025.06-conashaugh-courier.pdf","2025.07-conashaugh-courier.pdf","2025.08-conashaugh-courier.pdf"].map(t=>({url:`${this.localBasePath}${t}`,filename:t}))}convertPDFMetadataToNewsletter(e){const t=this.parsePublishDateFromFilename(e.filename);return{id:this.generateNumericId(e.filename),title:e.title,filename:e.filename,date:t,pages:e.pages,url:`${this.localBasePath}${e.filename}`,localFile:e.filename,thumbnailPath:e.thumbnailDataUrl,fileSize:e.fileSize,publishDate:new Date(t).toISOString(),contentType:"newsletter",quality:"web",...e.author&&{author:e.author},...e.subject&&{subject:e.subject},...e.keywords&&{keywords:e.keywords}}}parsePublishDateFromFilename(e){const t=e.match(/^(\d{4})\.(\d{2})-/);if(t){const[,a,r]=t;return`${a}-${r}-01`}return new Date().toISOString().split("T")[0]||""}generateNumericId(e){let t=0;for(let a=0;a<e.length;a++){const r=e.charCodeAt(a);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}generateId(e){return e.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()}enhanceNewsletterMetadata(e){const t=e.driveId||this.extractDriveId(),a=e.driveUrl||this.generateDriveUrl();return{...e,thumbnailPath:e.thumbnailPath||this.generateThumbnailPath(e.filename),...t&&{driveId:t},...a&&{driveUrl:a}}}enhanceWithHybridMetadata(e){const t=this.extractDriveId(),a=this.generateDriveUrl();return{...e,localFile:e.filename,thumbnailPath:this.generateThumbnailPath(e.filename),publishDate:this.parsePublishDate(e.date),contentType:this.determineContentType(e.title),quality:"web",...t&&{driveId:t},...a&&{driveUrl:a}}}async getNewsletterSources(e){const t=[];if(e.localFile){const a=`${this.localBasePath}${e.localFile}`;await this.checkLocalAvailability(a)&&t.push({type:"local",url:a,available:!0,lastChecked:new Date})}return e.driveId&&e.driveUrl&&t.push({type:"drive",url:e.driveUrl,available:!0,lastChecked:new Date}),t}async getWebViewUrl(e){const t=await this.getNewsletterSources(e),a=t.find(s=>s.type==="local"&&s.available);if(a)return a.url;const r=t.find(s=>s.type==="drive"&&s.available);return r?le(r.url):e.url?le(e.url):e.url}async getDownloadUrl(e){const t=await this.getNewsletterSources(e),a=t.find(s=>s.type==="drive"&&s.available);return a?`${a.url}/view?usp=sharing`:t.find(s=>s.type==="local"&&s.available)?.url||e.url}async checkLocalAvailability(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch{return!1}}generateThumbnailPath(e){const t=e.replace(/\.pdf$/i,"");return oe(`thumbnails/${t}.jpg`)}parsePublishDate(e){try{if(e.includes("2024")||e.includes("2025")){const t=e.match(/\d{4}/)?.[0],a=e.toLowerCase().includes("january")?"01":e.toLowerCase().includes("february")?"02":e.toLowerCase().includes("march")?"03":e.toLowerCase().includes("april")?"04":e.toLowerCase().includes("may")?"05":e.toLowerCase().includes("june")?"06":e.toLowerCase().includes("july")?"07":e.toLowerCase().includes("august")?"08":e.toLowerCase().includes("september")?"09":e.toLowerCase().includes("october")?"10":e.toLowerCase().includes("november")?"11":e.toLowerCase().includes("december")?"12":"01";if(t&&a)return`${t}-${a}-01`}return new Date().toISOString()}catch{return new Date().toISOString()}}determineContentType(e){const t=e.toLowerCase();return t.includes("annual")||t.includes("picnic")?"annual":t.includes("special")||t.includes("winter")&&!t.includes("2024")&&!t.includes("2025")?"special":"newsletter"}extractDriveId(){}generateDriveUrl(){const e=this.extractDriveId();return e?`${this.driveBaseUrl}${e}`:void 0}clearCache(){this.cache.clear()}async getServiceStats(){const e=await this.getNewsletters(),t={local:0,drive:0,hybrid:0};for(const a of e){const r=await this.getNewsletterSources(a);r.some(s=>s.type==="hybrid"&&s.available)?t.hybrid++:r.some(s=>s.type==="local"&&s.available)?t.local++:r.some(s=>s.type==="drive"&&s.available)&&t.drive++}return{totalNewsletters:e.length,sourceCounts:t,cacheSize:this.cache.size,lastUpdated:new Date().toISOString()}}async discoverGoogleDriveNewsletters(){try{console.log("[NewsletterService] Discovering Google Drive newsletters from REAL folders...");const e=await this.fetchFromGoogleDriveAPI();if(e.length>0)return console.log(`[NewsletterService] Found ${e.length} newsletters from Google Drive API`),e;console.log("[NewsletterService] Google Drive API not available, checking for existing hybrid data...");const t=await this.loadGoogleDriveHybridData();return t.length>0?(console.log(`[NewsletterService] Found ${t.length} newsletters with Google Drive metadata from hybrid JSON`),t):(console.log("[NewsletterService] No Google Drive data found - authenticate to load from real folders"),[])}catch(e){return console.error("[NewsletterService] Error discovering Google Drive newsletters:",e),[]}}async loadGoogleDriveHybridData(){try{return(await(await fetch(ae("newsletters-hybrid.json"))).json()).newsletters.filter(r=>r.driveId&&r.driveUrl).map(r=>({...r,publishDate:r.publishDate||r.date||new Date().toISOString(),quality:r.quality||"web",contentType:r.contentType||"newsletter"}))}catch(e){return console.error("[NewsletterService] Error loading hybrid data:",e),[]}}async fetchFromGoogleDriveAPI(){try{console.log("[NewsletterService] Fetching newsletters from Google Drive API without authentication...");const e="",t="",a="";if(!e||!t||!a)return console.warn("[NewsletterService] Google Drive API key or folder IDs not found in environment"),[];console.log(`[NewsletterService] Using folders: Issues=${t}, PDFs=${a}`);const[r,s]=await Promise.all([this.fetchFilesFromFolder(t,"Issues"),this.fetchFilesFromFolder(a,"PDFs")]),w=[];for(const g of[...r,...s])if(g.mimeType==="application/pdf"&&this.isNewsletterFile(g.name)){const p=this.convertGoogleDriveFileToNewsletter(g);w.push(p)}return console.log(`[NewsletterService] Found ${w.length} newsletters from Google Drive API`),w}catch(e){return console.error("[NewsletterService] Error fetching from Google Drive API:",e),[]}}isNewsletterFile(e){const t=e.toLowerCase();return t.includes("courier")||t.includes("newsletter")||t.match(/^\d{4}\.\d{2}-/)!==null||t.includes("picnic")||t.includes("conashaugh")}async fetchFilesFromFolder(e,t){try{const r=`https://www.googleapis.com/drive/v3/files?q='${e}'+in+parents&key=&fields=files(id,name,size,modifiedTime,mimeType,webViewLink,webContentLink)`;console.log(`[NewsletterService] Fetching from ${t} folder: ${e}`);const s=await fetch(r);if(!s.ok){const g=await s.text();return console.error(`[NewsletterService] Failed to fetch from ${t} folder: ${s.status} ${s.statusText}`,g),[]}const w=await s.json();return console.log(`[NewsletterService] Found ${w.files?.length||0} files in ${t} folder`),w.files||[]}catch(a){return console.error(`[NewsletterService] Error fetching from ${t} folder:`,a),[]}}convertGoogleDriveFileToNewsletter(e){const t=this.parsePublishDateFromFilename(e.name),a=this.generateNumericId(e.id||e.name);let r=e.name.replace(".pdf","");if(r.match(/^\d{4}\.\d{2}-(.+)/)){const s=r.match(/^\d{4}\.\d{2}-(.+)/);s&&s[1]&&(r=`Conashaugh Courier - ${this.formatDateFromFilename(r)}`)}return{id:a,title:r,filename:e.name,date:this.formatDateFromFilename(e.name)||t,pages:0,url:e.webViewLink||`https://drive.google.com/file/d/${e.id}`,driveId:e.id,driveUrl:e.webViewLink||`https://drive.google.com/file/d/${e.id}`,fileSize:this.formatFileSize(e.size),publishDate:new Date(t).toISOString(),contentType:this.determineContentType(r),quality:"print",...e.modifiedTime&&{lastModified:e.modifiedTime}}}formatFileSize(e){if(!e||e===0)return"Unknown";const t=typeof e=="string"?parseInt(e):e;if(isNaN(t))return"Unknown";const a=["B","KB","MB","GB"];let r=0,s=t;for(;s>=1024&&r<a.length-1;)s/=1024,r++;return`${s.toFixed(1)} ${a[r]}`}formatDateFromFilename(e){const t=e.match(/^(\d{4})\.(\d{2})-/);if(t&&t[1]&&t[2]){const[,a,r]=t,s=["January","February","March","April","May","June","July","August","September","October","November","December"],w=parseInt(r,10)-1;return`${s[w]||"Unknown"} ${a}`}return e.toLowerCase().includes("winter")?"Winter":e.toLowerCase().includes("summer")?"Summer":e.toLowerCase().includes("spring")?"Spring":e.toLowerCase().includes("fall")?"Fall":e.replace(".pdf","")}mergeLocalAndDriveSources(e,t){const a=[...e];for(const r of t){const s=a.find(w=>this.isSameNewsletter(w,r));s?(r.driveId&&(s.driveId=r.driveId),r.driveUrl&&(s.driveUrl=r.driveUrl),console.log(`[NewsletterService] Found hybrid source for: ${s.filename}`)):(a.push(r),console.log(`[NewsletterService] Found Drive-only newsletter: ${r.filename}`))}return a}async loadFallbackNewsletters(){try{return console.log("[NewsletterService] Loading fallback data from issues.json"),(await(await fetch(ae("issues.json"))).json()).map(a=>this.convertFallbackToNewsletter(a))}catch(e){return console.error("[NewsletterService] Failed to load fallback data:",e),[]}}mergeFallbackData(e,t){const a=[...e];for(const r of t)a.some(w=>this.isSameNewsletter(w,r))||(console.log(`[NewsletterService] Adding fallback newsletter: ${r.filename}`),a.push(r));return a}convertFallbackToNewsletter(e){let t;const a=e.filename?.match(/^(\d{4})\.(\d{2})-/);if(a){const[,r,s]=a;t=`${r}-${s}-01`}else{const r=e.date.match(/^(\w+)\s+(\d{4})$/);if(r){const[,s,w]=r;if(s){const g=this.getMonthNumber(s);t=`${w}-${g.toString().padStart(2,"0")}-01`}else t=new Date().toISOString().split("T")[0]||"1970-01-01"}else t=new Date().toISOString().split("T")[0]||"1970-01-01"}return{...e,publishDate:new Date(t).toISOString(),contentType:this.determineContentType(e.title),quality:"web",fileSize:"Unknown"}}getMonthNumber(e){return{January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12,Spring:4,Summer:7,Fall:10,Autumn:10,Winter:1}[e]||1}isSameNewsletter(e,t){return e.filename&&t.filename?e.filename===t.filename:e.title===t.title&&e.date===t.date?!0:e.id===t.id}}const q=new Be;function Ve(){const i=$([]),e=$(!1),t=$(null),a=$(null),r=async()=>{try{e.value=!0,t.value=null,console.log("[useHybridNewsletters] Loading newsletters...");const u=await q.getNewsletters();i.value=u,a.value=await q.getServiceStats(),console.log(`[useHybridNewsletters] Loaded ${u.length} newsletters`)}catch(u){console.error("[useHybridNewsletters] Error loading newsletters:",u),t.value="Failed to load newsletters"}finally{e.value=!1}},s=async u=>{try{return await q.getNewsletterSources(u)}catch(b){return console.error("[useHybridNewsletters] Error getting newsletter sources:",b),[]}},w=async u=>{try{return await q.getWebViewUrl(u)}catch(b){return console.error("[useHybridNewsletters] Error getting web view URL:",b),u.url}},g=async u=>{try{return await q.getDownloadUrl(u)}catch(b){return console.error("[useHybridNewsletters] Error getting download URL:",b),u.url}},p=async u=>(await s(u)).some(v=>v.type==="local"&&v.available),L=async u=>(await s(u)).some(v=>v.type==="drive"&&v.available),h=async u=>{const b=await s(u),v=b.some(N=>N.type==="local"&&N.available),C=b.some(N=>N.type==="drive"&&N.available);return v&&C},k=async()=>{q.clearCache(),await r()},d=x(()=>{const u={};i.value.forEach(C=>{const N=C.publishDate?new Date(C.publishDate).getFullYear().toString():"Unknown";u[N]||(u[N]=[]),u[N].push(C)});const b=Object.keys(u).sort((C,N)=>C==="Unknown"?1:N==="Unknown"?-1:parseInt(N)-parseInt(C)),v={};return b.forEach(C=>{const N=u[C];N&&(v[C]=N.sort((E,j)=>E.publishDate?j.publishDate?new Date(j.publishDate).getTime()-new Date(E.publishDate).getTime():-1:1))}),v}),m=x(()=>i.value.slice().sort((u,b)=>u.publishDate?b.publishDate?new Date(b.publishDate).getTime()-new Date(u.publishDate).getTime():-1:1).slice(0,5)),I=x(()=>{const u={newsletter:[],special:[],annual:[]};return i.value.forEach(b=>{const v=b.contentType||"newsletter";u[v]&&u[v].push(b)}),u});return{newsletters:i,loading:e,error:t,serviceStats:a,loadNewsletters:r,getNewsletterSources:s,getWebViewUrl:w,getDownloadUrl:g,hasLocalSource:p,hasDriveSource:L,hasHybridSources:h,refresh:k,newslettersByYear:d,recentNewsletters:m,newslettersByContentType:I}}function Ge(){const i=$({}),e=async g=>{if(i.value[g])return i.value[g];if(Ae(g)){console.log("Skipping PDF metadata extraction for Google Drive URL - CORS restrictions make this impossible");const p={pageCount:1,title:"Google Drive PDF"};return i.value[g]=p,p}try{const p=await he(()=>import("./pdf-ZhLmi4kS.js"),[]);if(!p.GlobalWorkerOptions.workerSrc){const m="/clca-courier";p.GlobalWorkerOptions.workerSrc=`${m}/pdf.worker.min.js`}const h=await p.getDocument({url:g,withCredentials:!1}).promise,k={pageCount:h.numPages};try{const d=await h.getMetadata();if(d.info){const m=d.info;m.Title&&(k.title=m.Title),m.Author&&(k.author=m.Author),m.CreationDate&&(k.creationDate=new Date(m.CreationDate)),m.ModDate&&(k.modificationDate=new Date(m.ModDate))}}catch(d){console.log("Could not extract additional metadata:",d)}try{const m=(await fetch(g,{method:"HEAD"})).headers.get("content-length");if(m){const I=parseInt(m);k.fileSize=r(I)}}catch(d){console.log("Could not get file size:",d)}return i.value[g]=k,k}catch(p){return console.error("Error extracting PDF metadata:",p),null}},t=async g=>(await e(g))?.pageCount||null,a=async g=>(await e(g))?.fileSize||null,r=g=>{if(g===0)return"0 B";const p=1024,L=["B","KB","MB","GB"],h=Math.floor(Math.log(g)/Math.log(p));return parseFloat((g/Math.pow(p,h)).toFixed(1))+" "+L[h]};return{extractMetadata:e,getPageCount:t,getFileSize:a,clearCache:()=>{i.value={}},clearUrlCache:g=>{delete i.value[g]},metadataCache:i}}const qe={class:"row items-start justify-between"},Ee={class:"col-12"},Oe={class:"text-h6 q-mb-xs line-clamp-2 text-break"},Qe={class:"text-subtitle2 text-grey-6"},je={class:"thumbnail-container"},Me={class:"absolute-full flex flex-center bg-grey-3 text-grey-7 column"},He={class:"absolute-full newsletter-overlay flex flex-center"},We={class:"row items-center justify-between text-body2 text-grey-7"},Re={class:"col-12"},Je={class:"row items-center q-gutter-md"},Ke={key:0,class:"flex items-center no-wrap"},Ye={class:"text-nowrap"},Ze={key:1,class:"flex items-center no-wrap"},Xe={class:"text-nowrap"},et={key:2,class:"flex items-center no-wrap"},tt={key:0,class:"row q-gutter-xs q-mt-sm items-center"},rt={class:"q-gutter-xs"},ot={class:"full-width"},at={class:"row q-gutter-xs"},lt={class:"column q-gutter-md"},st={class:"flex items-center"},nt={class:"column"},it={class:"text-subtitle1 text-weight-medium"},ct={class:"q-gutter-sm"},ut={key:0},dt={key:1},gt={key:2},mt={key:3},wt={key:4},ft={key:5},vt=pe({__name:"HybridNewsletterCard",props:{newsletter:{}},setup(i){const e=i,t=Le(),a=Ve(),r=Te(),{getPageCount:s,getFileSize:w}=Ge(),g=$(!1),p=$(!1),L=$([]),h=$(null),k=$(null),d=X({webView:!1,download:!1,sources:!1,drive:!1,metadata:!1}),m=X({local:!1,drive:!1}),I=x(()=>{const l=h.value||e.newsletter.pages;return l&&l>0?l:null}),u=x(()=>k.value||e.newsletter.fileSize),b=x(()=>{if(!e.newsletter.date)return!1;const l=new Date(e.newsletter.date);return!isNaN(l.getTime())}),v=x(()=>l=>l==="local"?"Fast web viewing with interactive features":"High-quality archive download"),C=async()=>{let l=null;try{l=await a.getWebViewUrl(e.newsletter)}catch(o){console.log("Could not get web view URL for metadata extraction:",o)}if(!l&&e.newsletter.localFile&&(l=`/issues/${e.newsletter.localFile}`),l&&(!h.value||!k.value))try{d.metadata=!0;const[o,D]=await Promise.all([h.value?Promise.resolve(h.value):s(l),k.value?Promise.resolve(k.value):w(l)]);o!==null&&!h.value&&(h.value=o),D!==null&&!k.value&&(k.value=D)}catch(o){console.log("Could not load live metadata for",e.newsletter.title,":",o),l&&l.includes("drive.google.com")&&console.log("Metadata loading failed for Google Drive file - this is expected due to CORS restrictions when not authenticated")}finally{d.metadata=!1}},N=async()=>{try{d.sources=!0,L.value=await a.getNewsletterSources(e.newsletter),m.local=await a.hasLocalSource(e.newsletter),m.drive=await a.hasDriveSource(e.newsletter)}catch(l){console.error("Error loading sources:",l)}finally{d.sources=!1}},E=async()=>{try{d.webView=!0;const l=await a.getWebViewUrl(e.newsletter);l?r.openDocument({...e.newsletter,url:l}):t.notify({type:"negative",message:"Newsletter not available for viewing"})}catch(l){console.error("Error opening web viewer:",l),t.notify({type:"negative",message:"Failed to open newsletter"})}finally{d.webView=!1}},j=async()=>{try{d.download=!0;const l=await a.getDownloadUrl(e.newsletter);l?(window.open(l,"_blank"),t.notify({type:"positive",message:"Download started"})):t.notify({type:"negative",message:"Download not available"})}catch(l){console.error("Error downloading newsletter:",l),t.notify({type:"negative",message:"Failed to download newsletter"})}finally{d.download=!1}},se=()=>{try{d.drive=!0;const l=L.value.find(o=>o.type==="drive"&&o.available);l?(window.open(l.url,"_blank"),t.notify({type:"positive",message:"Opening in Google Drive"})):e.newsletter.driveUrl?(window.open(e.newsletter.driveUrl,"_blank"),t.notify({type:"positive",message:"Opening in Google Drive"})):t.notify({type:"negative",message:"Google Drive link not available"})}catch(l){console.error("Error opening in Drive:",l),t.notify({type:"negative",message:"Failed to open in Google Drive"})}finally{d.drive=!1}},ne=async()=>{try{const l=await a.getWebViewUrl(e.newsletter);l&&(await navigator.clipboard.writeText(window.location.origin+l),t.notify({type:"positive",message:"Link copied to clipboard"}))}catch(l){console.error("Error copying link:",l),t.notify({type:"negative",message:"Failed to copy link"})}},ie=l=>{window.open(l.url,"_blank"),g.value=!1},ce=()=>{console.warn(`Thumbnail not found: ${e.newsletter.thumbnailPath}`)},M=l=>{if(!l)return null;try{const o=l.match(/(\d{4})\.(\d{2})-/);if(o&&o[1]&&o[2]){const K=parseInt(o[1]),de=parseInt(o[2]),Y=new Date(K,de-1,1);if(!isNaN(Y.getTime()))return Y.toLocaleDateString("en-US",{year:"numeric",month:"long"})}const D=new Date(l);return isNaN(D.getTime())?null:D.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return null}},ue=l=>{switch(l){case"local":return"computer";case"drive":return"cloud";case"hybrid":return"sync";default:return"source"}};return ye(async()=>{await N(),await C()}),(l,o)=>(S(),z(W,{class:"newsletter-card full-height",flat:""},{default:c(()=>[n(V,{class:"q-pb-sm"},{default:c(()=>[f("div",qe,[f("div",Ee,[f("div",Oe,_(l.newsletter.title),1),f("div",Qe,_(M(l.newsletter.date)),1)])])]),_:1}),l.newsletter.thumbnailPath?(S(),z(V,{key:0,class:"q-pa-sm"},{default:c(()=>[f("div",je,[n(_e,{src:l.newsletter.thumbnailPath,alt:`${l.newsletter.title} cover`,class:"rounded-borders newsletter-thumbnail",loading:"lazy",fit:"cover",ratio:1/1.3,onError:ce,onClick:E},{error:c(()=>[f("div",Me,[n(T,{name:"description",size:"2rem"}),o[4]||(o[4]=f("div",{class:"text-caption q-mt-sm"},"PDF Cover",-1))])]),default:c(()=>[f("div",He,[n(B,{round:"",color:"primary",icon:"visibility",size:"lg",class:"overlay-btn"},{default:c(()=>[n(Q,null,{default:c(()=>o[5]||(o[5]=[y("View Newsletter",-1)])),_:1,__:[5]})]),_:1})])]),_:1},8,["src","alt"])])]),_:1})):F("",!0),n(V,{class:"q-py-sm"},{default:c(()=>[f("div",We,[f("div",Re,[f("div",Je,[I.value?(S(),P("div",Ke,[n(T,{name:"description",size:"sm",class:"q-mr-xs"}),f("span",Ye,_(I.value)+" pages",1)])):F("",!0),u.value?(S(),P("div",Ze,[n(T,{name:"storage",size:"sm",class:"q-mr-xs"}),f("span",Xe,_(u.value),1)])):F("",!0),d.metadata?(S(),P("div",et,[n(Ie,{size:"sm",class:"q-mr-xs"}),o[6]||(o[6]=f("span",{class:"text-caption text-grey-6"},"Loading info...",-1))])):F("",!0)])])]),Object.keys(m).length>0?(S(),P("div",tt,[f("div",rt,[m.local?(S(),z(te,{key:0,icon:"computer",size:"sm",color:"primary","text-color":"white",dense:"",outline:"",class:"q-my-none"},{default:c(()=>[n(Q,null,{default:c(()=>o[7]||(o[7]=[y("Available locally for fast web viewing",-1)])),_:1,__:[7]}),o[8]||(o[8]=y(" Local ",-1))]),_:1,__:[8]})):F("",!0),m.drive?(S(),z(te,{key:1,icon:"cloud",size:"sm",color:"secondary","text-color":"white",dense:"",outline:"",class:"q-my-none"},{default:c(()=>[n(Q,null,{default:c(()=>o[9]||(o[9]=[y("Available from Google Drive archive",-1)])),_:1,__:[9]}),o[10]||(o[10]=y(" Drive ",-1))]),_:1,__:[10]})):F("",!0)])])):F("",!0)]),_:1}),n(Pe),n(R,{class:"q-pa-md"},{default:c(()=>[f("div",ot,[f("div",at,[m.local?(S(),z(B,{key:0,unelevated:"",icon:"visibility",color:"primary",onClick:E,loading:d.webView,class:"col"},{default:c(()=>[n(Q,null,{default:c(()=>o[11]||(o[11]=[y("View in web browser (Local)",-1)])),_:1,__:[11]})]),_:1},8,["loading"])):F("",!0),m.drive?(S(),z(B,{key:1,unelevated:"",icon:"download",color:"secondary",onClick:j,loading:d.download,class:"col"},{default:c(()=>[n(Q,null,{default:c(()=>o[12]||(o[12]=[y("Download high-quality PDF (Google Drive)",-1)])),_:1,__:[12]})]),_:1},8,["loading"])):F("",!0),n(Ce,{unelevated:"",icon:"more_vert",color:"grey-7","dropdown-icon":"","auto-close":"",class:"col-auto"},{default:c(()=>[n(xe,null,{default:c(()=>[m.drive?(S(),z(H,{key:0,clickable:"",onClick:se,disable:d.drive},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"open_in_new"})]),_:1}),n(U,null,{default:c(()=>[n(A,null,{default:c(()=>o[13]||(o[13]=[y("View in Drive",-1)])),_:1,__:[13]}),n(A,{caption:""},{default:c(()=>o[14]||(o[14]=[y("Open original in Google Drive",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["disable"])):F("",!0),n(H,{clickable:"",onClick:o[0]||(o[0]=D=>g.value=!0)},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"source",color:G(t).dark.isActive?"grey-4":"grey-7"},null,8,["color"])]),_:1}),n(U,null,{default:c(()=>[n(A,{class:O(G(t).dark.isActive?"text-grey-3":"text-grey-8")},{default:c(()=>o[15]||(o[15]=[y("View Sources",-1)])),_:1,__:[15]},8,["class"]),n(A,{caption:"",class:O(G(t).dark.isActive?"text-grey-5":"text-grey-6")},{default:c(()=>o[16]||(o[16]=[y("Show all available sources",-1)])),_:1,__:[16]},8,["class"])]),_:1})]),_:1}),n(H,{clickable:"",onClick:ne},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"link"})]),_:1}),n(U,null,{default:c(()=>[n(A,null,{default:c(()=>o[17]||(o[17]=[y("Copy Link",-1)])),_:1,__:[17]}),n(A,{caption:""},{default:c(()=>o[18]||(o[18]=[y("Copy shareable URL",-1)])),_:1,__:[18]})]),_:1})]),_:1}),n(be),n(H,{clickable:"",onClick:o[1]||(o[1]=D=>p.value=!0)},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"info"})]),_:1}),n(U,null,{default:c(()=>[n(A,null,{default:c(()=>o[19]||(o[19]=[y("Details",-1)])),_:1,__:[19]}),n(A,{caption:""},{default:c(()=>o[20]||(o[20]=[y("View metadata and info",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1}),n(ee,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=D=>g.value=D)},{default:c(()=>[n(W,{class:O([G(t).dark.isActive?"bg-dark text-white":"bg-white text-dark","q-pa-md"]),style:{"min-width":"350px","max-width":"500px"}},{default:c(()=>[n(V,{class:"q-pb-md"},{default:c(()=>[o[21]||(o[21]=f("div",{class:"text-h6 text-primary q-mb-md"},"Available Sources",-1)),f("div",lt,[(S(!0),P(ke,null,De(L.value,D=>J((S(),P("div",{key:D.type,class:O([G(t).dark.isActive?"bg-grey-8 shadow-2":"bg-grey-2 shadow-1","flex items-center justify-between q-pa-md rounded-borders"])},[f("div",st,[n(T,{name:ue(D.type),color:D.type==="local"?"primary":"secondary",size:"md",class:"q-mr-md"},null,8,["name","color"]),f("div",nt,[f("span",it,_(D.type==="local"?"Local File":"Google Drive"),1),f("span",{class:O([G(t).dark.isActive?"text-grey-4":"text-grey-6","text-caption"])},_(v.value(D.type)),3)])]),n(B,{unelevated:"",color:D.type==="local"?"primary":"secondary",icon:D.type==="local"?"visibility":"download",label:D.type==="local"?"View":"Download",onClick:K=>ie(D)},null,8,["color","icon","label","onClick"])],2)),[[Se,D.available]])),128))])]),_:1,__:[21]}),n(R,{align:"right",class:"q-pt-none"},{default:c(()=>[J(n(B,{flat:"",label:"Close",color:"primary"},null,512),[[re]])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),n(ee,{modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=D=>p.value=D)},{default:c(()=>[n(W,{style:{"min-width":"350px"}},{default:c(()=>[n(V,{class:"row items-center"},{default:c(()=>[n(Ne,{icon:"info",color:"primary","text-color":"white"}),o[22]||(o[22]=f("span",{class:"q-ml-sm text-h6"},"Newsletter Details",-1))]),_:1,__:[22]}),n(V,null,{default:c(()=>[f("div",ct,[f("div",null,[o[23]||(o[23]=f("strong",null,"Title:",-1)),y(" "+_(l.newsletter.title),1)]),b.value?(S(),P("div",ut,[o[24]||(o[24]=f("strong",null,"Date:",-1)),y(" "+_(M(l.newsletter.date)),1)])):F("",!0),I.value?(S(),P("div",dt,[o[25]||(o[25]=f("strong",null,"Pages:",-1)),y(" "+_(I.value),1)])):F("",!0),f("div",null,[o[26]||(o[26]=f("strong",null,"Filename:",-1)),y(" "+_(l.newsletter.filename),1)]),u.value?(S(),P("div",gt,[o[27]||(o[27]=f("strong",null,"File Size:",-1)),y(" "+_(u.value),1)])):F("",!0),l.newsletter.publishDate&&M(l.newsletter.publishDate)?(S(),P("div",mt,[o[28]||(o[28]=f("strong",null,"Published:",-1)),y(" "+_(M(l.newsletter.publishDate)),1)])):F("",!0),l.newsletter.topics?.length?(S(),P("div",wt,[o[29]||(o[29]=f("strong",null,"Topics:",-1)),y(" "+_(l.newsletter.topics.join(", ")),1)])):F("",!0),l.newsletter.tags?.length?(S(),P("div",ft,[o[30]||(o[30]=f("strong",null,"Tags:",-1)),y(" "+_(l.newsletter.tags.join(", ")),1)])):F("",!0)])]),_:1}),n(R,{align:"right"},{default:c(()=>[J(n(B,{flat:"",label:"Close",color:"primary"},null,512),[[re]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Tt=Ue(vt,[["__scopeId","data-v-5cf5471c"]]);export{Tt as H,$t as Q,Ve as u};
