import{d as T,c as V,r as y,o as E,I as q,M as c,a5 as o,f as s,a7 as w,a2 as h,N as p,K as P,a6 as z,a4 as u,P as g,R as b,ab as L,a3 as v,F as N,a9 as $,J as l}from"./index-exu2_NhE.js";import{Q as A}from"./QSpinnerDots-bj-uQrgp.js";import{Q as R}from"./QBanner-Bcv1Uyxm.js";import{Q as U}from"./QExpansionItem-BrG9a7En.js";import{Q as j}from"./QPage-Bb9ZLHd0.js";import{u as H}from"./site-store-simple-B1eq71_p.js";import{u as K}from"./usePdfViewer-CgY8xKep.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QItem-BjTdXJgq.js";import"./QSlideTransition-jZUTpWCA.js";import"./useUserSettings-DtMyk0UU.js";import"./use-quasar-DJa0Nk5u.js";import"./pdf-ZhLmi4kS.js";async function B(F){try{const n=await fetch(F,{method:"HEAD",cache:"no-cache"});if(!n.ok)return{isValid:!1,error:`HTTP ${n.status}: ${n.statusText}`};const k=n.headers.get("content-type");if(k&&!k.includes("application/pdf"))return{isValid:!1,error:`Invalid content type: ${k}`};const _=n.headers.get("content-length"),r=_?parseInt(_,10):void 0;return r&&r<1024?{isValid:!1,error:"File is too small to be a valid PDF"}:{isValid:!0,...r!==void 0&&{size:r}}}catch(n){return{isValid:!1,error:n instanceof Error?n.message:"Network error"}}}const J={class:"q-pa-md"},O={class:"row justify-center"},W={class:"col-12 col-md-10 col-lg-8"},X={class:"text-h4 q-mb-md"},Y={class:"row justify-between items-center q-mb-md"},Z={key:0,class:"text-center q-pa-lg"},ee={key:1,class:"text-center q-pa-lg"},te={class:"text-caption"},se={key:2,class:"q-gutter-md"},ae={key:0,class:"text-caption"},ie={class:"q-gutter-sm"},oe={class:"text-body2 q-mb-sm"},ne={key:0,class:"text-positive"},le={key:0,class:"text-caption q-mt-xs"},re={key:1,class:"text-negative"},ce={key:2,class:"text-warning"},de={class:"q-mt-md q-gutter-sm"},ue=T({__name:"PdfDiagnosticsPage",setup(F){const n=H(),{openDocument:k}=K(),_=V(()=>n.isDarkMode?"bg-dark text-white q-dark":"bg-white text-dark"),r=y(!1),x=y(!1),C=y(0),D=y(0),f=y([]),d=V(()=>{const a=f.value.filter(i=>i.status==="valid").length,e=f.value.filter(i=>i.status==="invalid").length,t=f.value.length;return{valid:a,invalid:e,total:t}});async function Q(){r.value=!0,x.value=!1,C.value=0;const a=n.archivedIssues;D.value=a.length,f.value=a.map(e=>({document:e,status:"pending",checking:!1}));for(let e=0;e<a.length;e++){const t=a[e],i=f.value[e];if(!(!i||!t)){try{const m=await B(t.url);i.status=m.isValid?"valid":"invalid",m.error&&(i.error=m.error),m.size!==void 0&&(i.size=m.size)}catch(m){i.status="invalid",i.error=m instanceof Error?m.message:"Unknown error"}C.value=e+1}}r.value=!1,x.value=!0}async function S(a){const e=f.value.find(t=>t.document.id===a.id);if(e){e.checking=!0;try{const t=await B(a.url);e.status=t.isValid?"valid":"invalid",t.error&&(e.error=t.error),t.size!==void 0&&(e.size=t.size)}catch(t){e.status="invalid",e.error=t instanceof Error?t.message:"Unknown error"}finally{e.checking=!1}}}function I(a){k(a)}function M(a){if(a===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,i)).toFixed(2))+" "+t[i]}return E(()=>{n.archivedIssues.length>0&&!n.isLoading&&Q()}),(a,e)=>(l(),q(j,{padding:""},{default:c(()=>[o("div",J,[o("div",O,[o("div",W,[s(z,{flat:"",class:P([_.value,"q-mb-md"])},{default:c(()=>[s(w,null,{default:c(()=>[o("div",X,[s(p,{name:"mdi-file-check",class:"q-mr-sm"}),e[0]||(e[0]=h(" PDF Diagnostics ",-1))]),e[1]||(e[1]=o("p",{class:"text-body1"}," Check the status of all PDF files in the system. This helps identify broken links and invalid files. ",-1))]),_:1,__:[1]})]),_:1},8,["class"]),s(z,{flat:"",class:P(_.value)},{default:c(()=>[s(w,null,{default:c(()=>[o("div",Y,[e[2]||(e[2]=o("div",{class:"text-h6"},"PDF File Status",-1)),s(b,{color:"primary",label:"Check All PDFs",icon:"mdi-refresh",onClick:Q,loading:r.value},null,8,["loading"])]),s(L,{class:"q-mb-md"}),!x.value&&!r.value?(l(),u("div",Z,[s(p,{name:"mdi-information",size:"3em",color:"info"}),e[3]||(e[3]=o("div",{class:"q-mt-md text-body1"},'Click "Check All PDFs" to start validation',-1))])):g("",!0),r.value?(l(),u("div",ee,[s(A,{size:"50px",color:"primary"}),e[4]||(e[4]=o("div",{class:"q-mt-md"},"Checking PDF files...",-1)),o("div",te,v(C.value)+"/"+v(D.value)+" files checked",1)])):g("",!0),x.value&&!r.value?(l(),u("div",se,[d.value.total>0?(l(),q(R,{key:0,class:P(d.value.valid===d.value.total?"bg-positive text-white":"bg-warning text-dark"),rounded:""},{avatar:c(()=>[s(p,{name:d.value.valid===d.value.total?"mdi-check-circle":"mdi-alert-circle"},null,8,["name"])]),default:c(()=>[h(" "+v(d.value.valid)+"/"+v(d.value.total)+" PDF files are valid ",1),d.value.invalid>0?(l(),u("div",ae,v(d.value.invalid)+" files have issues ",1)):g("",!0)]),_:1},8,["class"])):g("",!0),o("div",ie,[(l(!0),u(N,null,$(f.value,t=>(l(),q(U,{key:t.document.id,label:t.document.title,caption:t.document.filename,icon:t.status==="valid"?"mdi-check-circle":t.status==="invalid"?"mdi-alert-circle":"mdi-help-circle","header-class":t.status==="valid"?"text-positive":t.status==="invalid"?"text-negative":"text-warning"},{default:c(()=>[s(z,{flat:"",bordered:""},{default:c(()=>[s(w,null,{default:c(()=>[o("div",oe,[e[5]||(e[5]=o("strong",null,"URL:",-1)),h(" "+v(t.document.url),1)]),t.status==="valid"?(l(),u("div",ne,[s(p,{name:"mdi-check",class:"q-mr-sm"}),e[6]||(e[6]=h(" File is accessible and valid ",-1)),t.size?(l(),u("div",le," File size: "+v(M(t.size)),1)):g("",!0)])):t.status==="invalid"?(l(),u("div",re,[s(p,{name:"mdi-alert",class:"q-mr-sm"}),h(" "+v(t.error),1)])):(l(),u("div",ce,[s(p,{name:"mdi-help",class:"q-mr-sm"}),e[7]||(e[7]=h(" Status unknown - check pending ",-1))])),o("div",de,[s(b,{size:"sm",color:"primary",label:"Test Load",icon:"mdi-eye",onClick:i=>I(t.document),outline:""},null,8,["onClick"]),s(b,{size:"sm",color:"secondary",label:"Direct Link",icon:"mdi-open-in-new",href:t.document.url,target:"_blank",outline:""},null,8,["href"]),s(b,{size:"sm",color:"accent",label:"Re-check",icon:"mdi-refresh",onClick:i=>S(t.document),loading:t.checking,outline:""},null,8,["onClick","loading"])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["label","caption","icon","header-class"]))),128))])])):g("",!0)]),_:1})]),_:1},8,["class"])])])])]),_:1}))}}),we=G(ue,[["__scopeId","data-v-6ff295d7"]]);export{we as default};
