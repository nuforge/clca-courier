import{k as de,an as ge,c as x,ao as me,h as Z,R as B,ap as we,G as fe,r as L,aq as ve,d as he,E as X,o as pe,I as z,J as S,a6 as W,M as c,f as n,P as N,a5 as w,a3 as _,a7 as V,a2 as y,N as T,a4 as P,aa as G,K as E,ab as ye,aj as R,a9 as be,$ as J,ad as De,F as Se,ae as ee,ar as ke}from"./index-BkroMTFl.js";import{a as Fe,g as Ne,b as te,Q as Ce}from"./QBtnDropdown-CG0Iko_m.js";import{Q as j}from"./QTooltip-D6H5Lyt1.js";import{Q as _e}from"./QImg-p3iH161R.js";import{Q as Ie}from"./QSpinnerDots-D7baX2G4.js";import{Q as re}from"./QChip-DHEOGddt.js";import{Q as Pe}from"./QSpace-CBQjbQhR.js";import{Q as H,a as U,b as A}from"./QItem-DSBGMVcc.js";import{Q as xe}from"./QList-hgBCullG.js";import{C as oe}from"./ClosePopup-BakmTuqE.js";import{u as $e}from"./use-quasar-mWvpehSq.js";import{p as Le}from"./pdf-metadata-service-CImhVS20.js";import{u as Te}from"./usePdfViewer-DbUU3Fn1.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $t=de({name:"QBtnToggle",props:{...ge,modelValue:{required:!0},options:{type:Array,required:!0,validator:i=>i.every(e=>("label"in e||"icon"in e||"slot"in e)&&"value"in e)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(i,{slots:e,emit:t}){const a=x(()=>i.options.find(g=>g.value===i.modelValue)!==void 0),o=x(()=>({type:"hidden",name:i.name,value:i.modelValue})),s=we(o),p=x(()=>me(i)),u=x(()=>({rounded:i.rounded,dense:i.dense,...p.value})),h=x(()=>i.options.map((g,m)=>{const{attrs:I,value:d,slot:b,...f}=g;return{slot:b,props:{key:m,"aria-pressed":d===i.modelValue?"true":"false",...I,...f,...u.value,disable:i.disable===!0||f.disable===!0,color:d===i.modelValue?v(f,"toggleColor"):v(f,"color"),textColor:d===i.modelValue?v(f,"toggleTextColor"):v(f,"textColor"),noCaps:v(f,"noCaps")===!0,noWrap:v(f,"noWrap")===!0,size:v(f,"size"),padding:v(f,"padding"),ripple:v(f,"ripple"),stack:v(f,"stack")===!0,stretch:v(f,"stretch")===!0,onClick(C){$(d,g,C)}}}}));function $(g,m,I){i.readonly!==!0&&(i.modelValue===g?i.clearable===!0&&(t("update:modelValue",null,null),t("clear")):t("update:modelValue",g,m),t("click",I))}function v(g,m){return g[m]===void 0?i[m]:g[m]}function k(){const g=h.value.map(m=>Z(B,m.props,m.slot!==void 0?e[m.slot]:void 0));return i.name!==void 0&&i.disable!==!0&&a.value===!0&&s(g,"push"),fe(e.default,g)}return()=>Z(Fe,{class:"q-btn-toggle",...p.value,rounded:i.rounded,stretch:i.stretch,glossy:i.glossy,spread:i.spread},k)}});function Ae(i){return i.includes("drive.google.com")}function ze(i){const e=[/\/file\/d\/([a-zA-Z0-9_-]+)/,/\/uc\?.*[?&]id=([a-zA-Z0-9_-]+)/,/\/open\?id=([a-zA-Z0-9_-]+)/];for(const t of e){const a=i.match(t);if(a&&a[1])return a[1]}return null}function ae(i){if(i.includes("uc?export=view"))return i;const e=ze(i);return e?`https://drive.google.com/uc?export=view&id=${e}`:i}class Be{cache=new Map;localBasePath=Ne("issues/");driveBaseUrl="https://drive.google.com/file/d/";constructor(){this.initializeService()}initializeService(){console.log("[NewsletterService] Initializing hybrid newsletter service with REAL Google Drive integration"),console.log("[NewsletterService] Google Drive Folder IDs:"),console.log("- Issues Folder:",""),console.log("- PDFs Folder:",""),console.log("- API Key:","Missing ❌"),console.log("- Client ID:","Missing ❌")}async getNewsletters(){const e="newsletters";if(this.cache.has(e))return this.cache.get(e);try{const t=this.discoverLocalPDFs();console.log(`[NewsletterService] Found ${t.length} local PDF files`);let o=(await Le.processPDFBatch(t)).map(u=>this.convertPDFMetadataToNewsletter(u));const s=await this.discoverGoogleDriveNewsletters();o=this.mergeLocalAndDriveSources(o,s);const p=await this.loadFallbackNewsletters();return o=this.mergeFallbackData(o,p),o.sort((u,h)=>new Date(h.publishDate||"").getTime()-new Date(u.publishDate||"").getTime()),this.cache.set(e,o),console.log(`[NewsletterService] Generated metadata for ${o.length} newsletters`,`(${o.filter(u=>u.localFile).length} local, ${o.filter(u=>u.driveId).length} drive, ${o.filter(u=>u.localFile&&u.driveId).length} hybrid)`),o}catch(t){return console.error("[NewsletterService] Error generating newsletters:",t),await this.loadFallbackNewsletters()}}discoverLocalPDFs(){return["2024.02-conashaugh-courier.pdf","2024.03-conashaugh-courier.pdf","2024.04-conashaugh-courier.pdf","2024.05-conashaugh-courier.pdf","2024.06-conashaugh-courier.pdf","2024.08-conashaugh-courier.pdf","2024.09-conashaugh-courier.pdf","2024.10-conashaugh-courier.pdf","2024.11-conashaugh-courier.pdf","2024.12-conashaugh-courier.pdf","2025.02-conashaugh-courier.pdf","2025.05-conashaugh-courier.pdf","2025.06-conashaugh-courier.pdf","2025.07-conashaugh-courier.pdf","2025.08-conashaugh-courier.pdf"].map(t=>({url:`${this.localBasePath}${t}`,filename:t}))}convertPDFMetadataToNewsletter(e){const t=this.parsePublishDateFromFilename(e.filename);return{id:this.generateNumericId(e.filename),title:e.title,filename:e.filename,date:t,pages:e.pages,url:`${this.localBasePath}${e.filename}`,localFile:e.filename,thumbnailPath:e.thumbnailDataUrl,fileSize:e.fileSize,publishDate:new Date(t).toISOString(),contentType:"newsletter",quality:"web",...e.author&&{author:e.author},...e.subject&&{subject:e.subject},...e.keywords&&{keywords:e.keywords}}}parsePublishDateFromFilename(e){const t=e.match(/^(\d{4})\.(\d{2})-/);if(t){const[,a,o]=t;return`${a}-${o}-01`}return new Date().toISOString().split("T")[0]||""}generateNumericId(e){let t=0;for(let a=0;a<e.length;a++){const o=e.charCodeAt(a);t=(t<<5)-t+o,t=t&t}return Math.abs(t)}generateId(e){return e.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()}enhanceNewsletterMetadata(e){const t=e.driveId||this.extractDriveId(),a=e.driveUrl||this.generateDriveUrl();return{...e,thumbnailPath:e.thumbnailPath||this.generateThumbnailPath(e.filename),...t&&{driveId:t},...a&&{driveUrl:a}}}enhanceWithHybridMetadata(e){const t=this.extractDriveId(),a=this.generateDriveUrl();return{...e,localFile:e.filename,thumbnailPath:this.generateThumbnailPath(e.filename),publishDate:this.parsePublishDate(e.date),contentType:this.determineContentType(e.title),quality:"web",...t&&{driveId:t},...a&&{driveUrl:a}}}async getNewsletterSources(e){const t=[];if(e.localFile){const a=`${this.localBasePath}${e.localFile}`;await this.checkLocalAvailability(a)&&t.push({type:"local",url:a,available:!0,lastChecked:new Date})}return e.driveId&&e.driveUrl&&t.push({type:"drive",url:e.driveUrl,available:!0,lastChecked:new Date}),t}async getWebViewUrl(e){const t=await this.getNewsletterSources(e),a=t.find(s=>s.type==="local"&&s.available);if(a)return a.url;const o=t.find(s=>s.type==="drive"&&s.available);return o?ae(o.url):e.url?ae(e.url):e.url}async getDownloadUrl(e){const t=await this.getNewsletterSources(e),a=t.find(s=>s.type==="drive"&&s.available);return a?`${a.url}/view?usp=sharing`:t.find(s=>s.type==="local"&&s.available)?.url||e.url}async checkLocalAvailability(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch{return!1}}generateThumbnailPath(e){return`/thumbnails/${e.replace(/\.pdf$/i,"")}.jpg`}parsePublishDate(e){try{if(e.includes("2024")||e.includes("2025")){const t=e.match(/\d{4}/)?.[0],a=e.toLowerCase().includes("january")?"01":e.toLowerCase().includes("february")?"02":e.toLowerCase().includes("march")?"03":e.toLowerCase().includes("april")?"04":e.toLowerCase().includes("may")?"05":e.toLowerCase().includes("june")?"06":e.toLowerCase().includes("july")?"07":e.toLowerCase().includes("august")?"08":e.toLowerCase().includes("september")?"09":e.toLowerCase().includes("october")?"10":e.toLowerCase().includes("november")?"11":e.toLowerCase().includes("december")?"12":"01";if(t&&a)return`${t}-${a}-01`}return new Date().toISOString()}catch{return new Date().toISOString()}}determineContentType(e){const t=e.toLowerCase();return t.includes("annual")||t.includes("picnic")?"annual":t.includes("special")||t.includes("winter")&&!t.includes("2024")&&!t.includes("2025")?"special":"newsletter"}extractDriveId(){}generateDriveUrl(){const e=this.extractDriveId();return e?`${this.driveBaseUrl}${e}`:void 0}clearCache(){this.cache.clear()}async getServiceStats(){const e=await this.getNewsletters(),t={local:0,drive:0,hybrid:0};for(const a of e){const o=await this.getNewsletterSources(a);o.some(s=>s.type==="hybrid"&&s.available)?t.hybrid++:o.some(s=>s.type==="local"&&s.available)?t.local++:o.some(s=>s.type==="drive"&&s.available)&&t.drive++}return{totalNewsletters:e.length,sourceCounts:t,cacheSize:this.cache.size,lastUpdated:new Date().toISOString()}}async discoverGoogleDriveNewsletters(){try{console.log("[NewsletterService] Discovering Google Drive newsletters from REAL folders...");const e=await this.fetchFromGoogleDriveAPI();if(e.length>0)return console.log(`[NewsletterService] Found ${e.length} newsletters from Google Drive API`),e;console.log("[NewsletterService] Google Drive API not available, checking for existing hybrid data...");const t=await this.loadGoogleDriveHybridData();return t.length>0?(console.log(`[NewsletterService] Found ${t.length} newsletters with Google Drive metadata from hybrid JSON`),t):(console.log("[NewsletterService] No Google Drive data found - authenticate to load from real folders"),[])}catch(e){return console.error("[NewsletterService] Error discovering Google Drive newsletters:",e),[]}}async loadGoogleDriveHybridData(){try{return(await(await fetch(te("newsletters-hybrid.json"))).json()).newsletters.filter(o=>o.driveId&&o.driveUrl).map(o=>({...o,publishDate:o.publishDate||o.date||new Date().toISOString(),quality:o.quality||"web",contentType:o.contentType||"newsletter"}))}catch(e){return console.error("[NewsletterService] Error loading hybrid data:",e),[]}}async fetchFromGoogleDriveAPI(){try{console.log("[NewsletterService] Fetching newsletters from Google Drive API without authentication...");const e="",t="",a="";if(!e||!t||!a)return console.warn("[NewsletterService] Google Drive API key or folder IDs not found in environment"),[];console.log(`[NewsletterService] Using folders: Issues=${t}, PDFs=${a}`);const[o,s]=await Promise.all([this.fetchFilesFromFolder(t,"Issues"),this.fetchFilesFromFolder(a,"PDFs")]),p=[];for(const u of[...o,...s])if(u.mimeType==="application/pdf"&&this.isNewsletterFile(u.name)){const h=this.convertGoogleDriveFileToNewsletter(u);p.push(h)}return console.log(`[NewsletterService] Found ${p.length} newsletters from Google Drive API`),p}catch(e){return console.error("[NewsletterService] Error fetching from Google Drive API:",e),[]}}isNewsletterFile(e){const t=e.toLowerCase();return t.includes("courier")||t.includes("newsletter")||t.match(/^\d{4}\.\d{2}-/)!==null||t.includes("picnic")||t.includes("conashaugh")}async fetchFilesFromFolder(e,t){try{const o=`https://www.googleapis.com/drive/v3/files?q='${e}'+in+parents&key=&fields=files(id,name,size,modifiedTime,mimeType,webViewLink,webContentLink)`;console.log(`[NewsletterService] Fetching from ${t} folder: ${e}`);const s=await fetch(o);if(!s.ok){const u=await s.text();return console.error(`[NewsletterService] Failed to fetch from ${t} folder: ${s.status} ${s.statusText}`,u),[]}const p=await s.json();return console.log(`[NewsletterService] Found ${p.files?.length||0} files in ${t} folder`),p.files||[]}catch(a){return console.error(`[NewsletterService] Error fetching from ${t} folder:`,a),[]}}convertGoogleDriveFileToNewsletter(e){const t=this.parsePublishDateFromFilename(e.name),a=this.generateNumericId(e.id||e.name);let o=e.name.replace(".pdf","");if(o.match(/^\d{4}\.\d{2}-(.+)/)){const s=o.match(/^\d{4}\.\d{2}-(.+)/);s&&s[1]&&(o=`Conashaugh Courier - ${this.formatDateFromFilename(o)}`)}return{id:a,title:o,filename:e.name,date:this.formatDateFromFilename(e.name)||t,pages:0,url:e.webViewLink||`https://drive.google.com/file/d/${e.id}`,driveId:e.id,driveUrl:e.webViewLink||`https://drive.google.com/file/d/${e.id}`,fileSize:this.formatFileSize(e.size),publishDate:new Date(t).toISOString(),contentType:this.determineContentType(o),quality:"print",...e.modifiedTime&&{lastModified:e.modifiedTime}}}formatFileSize(e){if(!e||e===0)return"Unknown";const t=typeof e=="string"?parseInt(e):e;if(isNaN(t))return"Unknown";const a=["B","KB","MB","GB"];let o=0,s=t;for(;s>=1024&&o<a.length-1;)s/=1024,o++;return`${s.toFixed(1)} ${a[o]}`}formatDateFromFilename(e){const t=e.match(/^(\d{4})\.(\d{2})-/);if(t&&t[1]&&t[2]){const[,a,o]=t,s=["January","February","March","April","May","June","July","August","September","October","November","December"],p=parseInt(o,10)-1;return`${s[p]||"Unknown"} ${a}`}return e.toLowerCase().includes("winter")?"Winter":e.toLowerCase().includes("summer")?"Summer":e.toLowerCase().includes("spring")?"Spring":e.toLowerCase().includes("fall")?"Fall":e.replace(".pdf","")}mergeLocalAndDriveSources(e,t){const a=[...e];for(const o of t){const s=a.find(p=>this.isSameNewsletter(p,o));s?(o.driveId&&(s.driveId=o.driveId),o.driveUrl&&(s.driveUrl=o.driveUrl),console.log(`[NewsletterService] Found hybrid source for: ${s.filename}`)):(a.push(o),console.log(`[NewsletterService] Found Drive-only newsletter: ${o.filename}`))}return a}async loadFallbackNewsletters(){try{return console.log("[NewsletterService] Loading fallback data from issues.json"),(await(await fetch(te("issues.json"))).json()).map(a=>this.convertFallbackToNewsletter(a))}catch(e){return console.error("[NewsletterService] Failed to load fallback data:",e),[]}}mergeFallbackData(e,t){const a=[...e];for(const o of t)a.some(p=>this.isSameNewsletter(p,o))||(console.log(`[NewsletterService] Adding fallback newsletter: ${o.filename}`),a.push(o));return a}convertFallbackToNewsletter(e){let t;const a=e.filename?.match(/^(\d{4})\.(\d{2})-/);if(a){const[,o,s]=a;t=`${o}-${s}-01`}else{const o=e.date.match(/^(\w+)\s+(\d{4})$/);if(o){const[,s,p]=o;if(s){const u=this.getMonthNumber(s);t=`${p}-${u.toString().padStart(2,"0")}-01`}else t=new Date().toISOString().split("T")[0]||"1970-01-01"}else t=new Date().toISOString().split("T")[0]||"1970-01-01"}return{...e,publishDate:new Date(t).toISOString(),contentType:this.determineContentType(e.title),quality:"web",fileSize:"Unknown"}}getMonthNumber(e){return{January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12,Spring:4,Summer:7,Fall:10,Autumn:10,Winter:1}[e]||1}isSameNewsletter(e,t){return e.filename&&t.filename?e.filename===t.filename:e.title===t.title&&e.date===t.date?!0:e.id===t.id}}const q=new Be;function Ve(){const i=L([]),e=L(!1),t=L(null),a=L(null),o=async()=>{try{e.value=!0,t.value=null,console.log("[useHybridNewsletters] Loading newsletters...");const d=await q.getNewsletters();i.value=d,a.value=await q.getServiceStats(),console.log(`[useHybridNewsletters] Loaded ${d.length} newsletters`)}catch(d){console.error("[useHybridNewsletters] Error loading newsletters:",d),t.value="Failed to load newsletters"}finally{e.value=!1}},s=async d=>{try{return await q.getNewsletterSources(d)}catch(b){return console.error("[useHybridNewsletters] Error getting newsletter sources:",b),[]}},p=async d=>{try{return await q.getWebViewUrl(d)}catch(b){return console.error("[useHybridNewsletters] Error getting web view URL:",b),d.url}},u=async d=>{try{return await q.getDownloadUrl(d)}catch(b){return console.error("[useHybridNewsletters] Error getting download URL:",b),d.url}},h=async d=>(await s(d)).some(f=>f.type==="local"&&f.available),$=async d=>(await s(d)).some(f=>f.type==="drive"&&f.available),v=async d=>{const b=await s(d),f=b.some(F=>F.type==="local"&&F.available),C=b.some(F=>F.type==="drive"&&F.available);return f&&C},k=async()=>{q.clearCache(),await o()},g=x(()=>{const d={};i.value.forEach(C=>{const F=C.publishDate?new Date(C.publishDate).getFullYear().toString():"Unknown";d[F]||(d[F]=[]),d[F].push(C)});const b=Object.keys(d).sort((C,F)=>C==="Unknown"?1:F==="Unknown"?-1:parseInt(F)-parseInt(C)),f={};return b.forEach(C=>{const F=d[C];F&&(f[C]=F.sort((Q,O)=>Q.publishDate?O.publishDate?new Date(O.publishDate).getTime()-new Date(Q.publishDate).getTime():-1:1))}),f}),m=x(()=>i.value.slice().sort((d,b)=>d.publishDate?b.publishDate?new Date(b.publishDate).getTime()-new Date(d.publishDate).getTime():-1:1).slice(0,5)),I=x(()=>{const d={newsletter:[],special:[],annual:[]};return i.value.forEach(b=>{const f=b.contentType||"newsletter";d[f]&&d[f].push(b)}),d});return{newsletters:i,loading:e,error:t,serviceStats:a,loadNewsletters:o,getNewsletterSources:s,getWebViewUrl:p,getDownloadUrl:u,hasLocalSource:h,hasDriveSource:$,hasHybridSources:v,refresh:k,newslettersByYear:g,recentNewsletters:m,newslettersByContentType:I}}function Ge(){const i=L({}),e=async u=>{if(i.value[u])return i.value[u];if(Ae(u)){console.log("Skipping PDF metadata extraction for Google Drive URL - CORS restrictions make this impossible");const h={pageCount:1,title:"Google Drive PDF"};return i.value[u]=h,h}try{const h=await ve(()=>import("./pdf-ZhLmi4kS.js"),[]);if(!h.GlobalWorkerOptions.workerSrc){const m="/clca-courier";h.GlobalWorkerOptions.workerSrc=`${m}/pdf.worker.min.js`}const v=await h.getDocument({url:u,withCredentials:!1}).promise,k={pageCount:v.numPages};try{const g=await v.getMetadata();if(g.info){const m=g.info;m.Title&&(k.title=m.Title),m.Author&&(k.author=m.Author),m.CreationDate&&(k.creationDate=new Date(m.CreationDate)),m.ModDate&&(k.modificationDate=new Date(m.ModDate))}}catch(g){console.log("Could not extract additional metadata:",g)}try{const m=(await fetch(u,{method:"HEAD"})).headers.get("content-length");if(m){const I=parseInt(m);k.fileSize=o(I)}}catch(g){console.log("Could not get file size:",g)}return i.value[u]=k,k}catch(h){return console.error("Error extracting PDF metadata:",h),null}},t=async u=>(await e(u))?.pageCount||null,a=async u=>(await e(u))?.fileSize||null,o=u=>{if(u===0)return"0 B";const h=1024,$=["B","KB","MB","GB"],v=Math.floor(Math.log(u)/Math.log(h));return parseFloat((u/Math.pow(h,v)).toFixed(1))+" "+$[v]};return{extractMetadata:e,getPageCount:t,getFileSize:a,clearCache:()=>{i.value={}},clearUrlCache:u=>{delete i.value[u]},metadataCache:i}}const qe={class:"row items-start justify-between"},Qe={class:"col-12"},Ee={class:"text-h6 q-mb-xs line-clamp-2 text-break"},je={class:"text-subtitle2 text-grey-6"},Oe={class:"thumbnail-container"},Me={class:"absolute-full flex flex-center bg-grey-3 text-grey-7 column"},He={class:"absolute-full newsletter-overlay flex flex-center"},We={class:"row items-center justify-between text-body2 text-grey-7"},Re={class:"col-12"},Je={class:"row items-center q-gutter-md"},Ke={key:0,class:"flex items-center no-wrap"},Ye={class:"text-nowrap"},Ze={key:1,class:"flex items-center no-wrap"},Xe={class:"text-nowrap"},et={key:2,class:"flex items-center no-wrap"},tt={key:0,class:"row q-gutter-xs q-mt-sm items-center"},rt={class:"q-gutter-xs"},ot={class:"full-width"},at={class:"row q-gutter-xs"},lt={class:"column q-gutter-md"},st={class:"flex items-center"},nt={class:"column"},it={class:"text-subtitle1 text-weight-medium"},ct={class:"q-gutter-sm"},ut={key:0},dt={key:1},gt={key:2},mt={key:3},wt={key:4},ft={key:5},vt=he({__name:"HybridNewsletterCard",props:{newsletter:{}},setup(i){const e=i,t=$e(),a=Ve(),o=Te(),{getPageCount:s,getFileSize:p}=Ge(),u=L(!1),h=L(!1),$=L([]),v=L(null),k=L(null),g=X({webView:!1,download:!1,sources:!1,drive:!1,metadata:!1}),m=X({local:!1,drive:!1}),I=x(()=>{const l=v.value||e.newsletter.pages;return l&&l>0?l:null}),d=x(()=>k.value||e.newsletter.fileSize),b=x(()=>{if(!e.newsletter.date)return!1;const l=new Date(e.newsletter.date);return!isNaN(l.getTime())}),f=x(()=>l=>l==="local"?"Fast web viewing with interactive features":"High-quality archive download"),C=async()=>{let l=null;try{l=await a.getWebViewUrl(e.newsletter)}catch(r){console.log("Could not get web view URL for metadata extraction:",r)}if(!l&&e.newsletter.localFile&&(l=`/issues/${e.newsletter.localFile}`),l&&(!v.value||!k.value))try{g.metadata=!0;const[r,D]=await Promise.all([v.value?Promise.resolve(v.value):s(l),k.value?Promise.resolve(k.value):p(l)]);r!==null&&!v.value&&(v.value=r),D!==null&&!k.value&&(k.value=D)}catch(r){console.log("Could not load live metadata for",e.newsletter.title,":",r),l&&l.includes("drive.google.com")&&console.log("Metadata loading failed for Google Drive file - this is expected due to CORS restrictions when not authenticated")}finally{g.metadata=!1}},F=async()=>{try{g.sources=!0,$.value=await a.getNewsletterSources(e.newsletter),m.local=await a.hasLocalSource(e.newsletter),m.drive=await a.hasDriveSource(e.newsletter)}catch(l){console.error("Error loading sources:",l)}finally{g.sources=!1}},Q=async()=>{try{g.webView=!0;const l=await a.getWebViewUrl(e.newsletter);l?o.openDocument({...e.newsletter,url:l}):t.notify({type:"negative",message:"Newsletter not available for viewing"})}catch(l){console.error("Error opening web viewer:",l),t.notify({type:"negative",message:"Failed to open newsletter"})}finally{g.webView=!1}},O=async()=>{try{g.download=!0;const l=await a.getDownloadUrl(e.newsletter);l?(window.open(l,"_blank"),t.notify({type:"positive",message:"Download started"})):t.notify({type:"negative",message:"Download not available"})}catch(l){console.error("Error downloading newsletter:",l),t.notify({type:"negative",message:"Failed to download newsletter"})}finally{g.download=!1}},le=()=>{try{g.drive=!0;const l=$.value.find(r=>r.type==="drive"&&r.available);l?(window.open(l.url,"_blank"),t.notify({type:"positive",message:"Opening in Google Drive"})):e.newsletter.driveUrl?(window.open(e.newsletter.driveUrl,"_blank"),t.notify({type:"positive",message:"Opening in Google Drive"})):t.notify({type:"negative",message:"Google Drive link not available"})}catch(l){console.error("Error opening in Drive:",l),t.notify({type:"negative",message:"Failed to open in Google Drive"})}finally{g.drive=!1}},se=async()=>{try{const l=await a.getWebViewUrl(e.newsletter);l&&(await navigator.clipboard.writeText(window.location.origin+l),t.notify({type:"positive",message:"Link copied to clipboard"}))}catch(l){console.error("Error copying link:",l),t.notify({type:"negative",message:"Failed to copy link"})}},ne=l=>{window.open(l.url,"_blank"),u.value=!1},ie=()=>{console.warn(`Thumbnail not found: ${e.newsletter.thumbnailPath}`)},M=l=>{if(!l)return null;try{const r=l.match(/(\d{4})\.(\d{2})-/);if(r&&r[1]&&r[2]){const K=parseInt(r[1]),ue=parseInt(r[2]),Y=new Date(K,ue-1,1);if(!isNaN(Y.getTime()))return Y.toLocaleDateString("en-US",{year:"numeric",month:"long"})}const D=new Date(l);return isNaN(D.getTime())?null:D.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return null}},ce=l=>{switch(l){case"local":return"computer";case"drive":return"cloud";case"hybrid":return"sync";default:return"source"}};return pe(async()=>{await F(),await C()}),(l,r)=>(S(),z(W,{class:"newsletter-card full-height",flat:""},{default:c(()=>[n(V,{class:"q-pb-sm"},{default:c(()=>[w("div",qe,[w("div",Qe,[w("div",Ee,_(l.newsletter.title),1),w("div",je,_(M(l.newsletter.date)),1)])])]),_:1}),l.newsletter.thumbnailPath?(S(),z(V,{key:0,class:"q-pa-sm"},{default:c(()=>[w("div",Oe,[n(_e,{src:l.newsletter.thumbnailPath,alt:`${l.newsletter.title} cover`,class:"rounded-borders newsletter-thumbnail",loading:"lazy",fit:"cover",ratio:1/1.3,onError:ie,onClick:Q},{error:c(()=>[w("div",Me,[n(T,{name:"description",size:"2rem"}),r[4]||(r[4]=w("div",{class:"text-caption q-mt-sm"},"PDF Cover",-1))])]),default:c(()=>[w("div",He,[n(B,{round:"",color:"primary",icon:"visibility",size:"lg",class:"overlay-btn"},{default:c(()=>[n(j,null,{default:c(()=>r[5]||(r[5]=[y("View Newsletter",-1)])),_:1,__:[5]})]),_:1})])]),_:1},8,["src","alt"])])]),_:1})):N("",!0),n(V,{class:"q-py-sm"},{default:c(()=>[w("div",We,[w("div",Re,[w("div",Je,[I.value?(S(),P("div",Ke,[n(T,{name:"description",size:"sm",class:"q-mr-xs"}),w("span",Ye,_(I.value)+" pages",1)])):N("",!0),d.value?(S(),P("div",Ze,[n(T,{name:"storage",size:"sm",class:"q-mr-xs"}),w("span",Xe,_(d.value),1)])):N("",!0),g.metadata?(S(),P("div",et,[n(Ie,{size:"sm",class:"q-mr-xs"}),r[6]||(r[6]=w("span",{class:"text-caption text-grey-6"},"Loading info...",-1))])):N("",!0)])])]),Object.keys(m).length>0?(S(),P("div",tt,[w("div",rt,[m.local?(S(),z(re,{key:0,icon:"computer",size:"sm",color:"primary","text-color":"white",dense:"",outline:"",class:"q-my-none"},{default:c(()=>[n(j,null,{default:c(()=>r[7]||(r[7]=[y("Available locally for fast web viewing",-1)])),_:1,__:[7]}),r[8]||(r[8]=y(" Local ",-1))]),_:1,__:[8]})):N("",!0),m.drive?(S(),z(re,{key:1,icon:"cloud",size:"sm",color:"secondary","text-color":"white",dense:"",outline:"",class:"q-my-none"},{default:c(()=>[n(j,null,{default:c(()=>r[9]||(r[9]=[y("Available from Google Drive archive",-1)])),_:1,__:[9]}),r[10]||(r[10]=y(" Drive ",-1))]),_:1,__:[10]})):N("",!0)])])):N("",!0)]),_:1}),n(Pe),n(R,{class:"q-pa-md"},{default:c(()=>[w("div",ot,[w("div",at,[m.local?(S(),z(B,{key:0,unelevated:"",icon:"visibility",color:"primary",onClick:Q,loading:g.webView,class:"col"},{default:c(()=>[n(j,null,{default:c(()=>r[11]||(r[11]=[y("View in web browser (Local)",-1)])),_:1,__:[11]})]),_:1},8,["loading"])):N("",!0),m.drive?(S(),z(B,{key:1,unelevated:"",icon:"download",color:"secondary",onClick:O,loading:g.download,class:"col"},{default:c(()=>[n(j,null,{default:c(()=>r[12]||(r[12]=[y("Download high-quality PDF (Google Drive)",-1)])),_:1,__:[12]})]),_:1},8,["loading"])):N("",!0),n(Ce,{unelevated:"",icon:"more_vert",color:"grey-7","dropdown-icon":"","auto-close":"",class:"col-auto"},{default:c(()=>[n(xe,null,{default:c(()=>[m.drive?(S(),z(H,{key:0,clickable:"",onClick:le,disable:g.drive},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"open_in_new"})]),_:1}),n(U,null,{default:c(()=>[n(A,null,{default:c(()=>r[13]||(r[13]=[y("View in Drive",-1)])),_:1,__:[13]}),n(A,{caption:""},{default:c(()=>r[14]||(r[14]=[y("Open original in Google Drive",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["disable"])):N("",!0),n(H,{clickable:"",onClick:r[0]||(r[0]=D=>u.value=!0)},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"source",color:G(t).dark.isActive?"grey-4":"grey-7"},null,8,["color"])]),_:1}),n(U,null,{default:c(()=>[n(A,{class:E(G(t).dark.isActive?"text-grey-3":"text-grey-8")},{default:c(()=>r[15]||(r[15]=[y("View Sources",-1)])),_:1,__:[15]},8,["class"]),n(A,{caption:"",class:E(G(t).dark.isActive?"text-grey-5":"text-grey-6")},{default:c(()=>r[16]||(r[16]=[y("Show all available sources",-1)])),_:1,__:[16]},8,["class"])]),_:1})]),_:1}),n(H,{clickable:"",onClick:se},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"link"})]),_:1}),n(U,null,{default:c(()=>[n(A,null,{default:c(()=>r[17]||(r[17]=[y("Copy Link",-1)])),_:1,__:[17]}),n(A,{caption:""},{default:c(()=>r[18]||(r[18]=[y("Copy shareable URL",-1)])),_:1,__:[18]})]),_:1})]),_:1}),n(ye),n(H,{clickable:"",onClick:r[1]||(r[1]=D=>h.value=!0)},{default:c(()=>[n(U,{avatar:""},{default:c(()=>[n(T,{name:"info"})]),_:1}),n(U,null,{default:c(()=>[n(A,null,{default:c(()=>r[19]||(r[19]=[y("Details",-1)])),_:1,__:[19]}),n(A,{caption:""},{default:c(()=>r[20]||(r[20]=[y("View metadata and info",-1)])),_:1,__:[20]})]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1}),n(ee,{modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=D=>u.value=D)},{default:c(()=>[n(W,{class:E([G(t).dark.isActive?"bg-dark text-white":"bg-white text-dark","q-pa-md"]),style:{"min-width":"350px","max-width":"500px"}},{default:c(()=>[n(V,{class:"q-pb-md"},{default:c(()=>[r[21]||(r[21]=w("div",{class:"text-h6 text-primary q-mb-md"},"Available Sources",-1)),w("div",lt,[(S(!0),P(Se,null,be($.value,D=>J((S(),P("div",{key:D.type,class:E([G(t).dark.isActive?"bg-grey-8 shadow-2":"bg-grey-2 shadow-1","flex items-center justify-between q-pa-md rounded-borders"])},[w("div",st,[n(T,{name:ce(D.type),color:D.type==="local"?"primary":"secondary",size:"md",class:"q-mr-md"},null,8,["name","color"]),w("div",nt,[w("span",it,_(D.type==="local"?"Local File":"Google Drive"),1),w("span",{class:E([G(t).dark.isActive?"text-grey-4":"text-grey-6","text-caption"])},_(f.value(D.type)),3)])]),n(B,{unelevated:"",color:D.type==="local"?"primary":"secondary",icon:D.type==="local"?"visibility":"download",label:D.type==="local"?"View":"Download",onClick:K=>ne(D)},null,8,["color","icon","label","onClick"])],2)),[[De,D.available]])),128))])]),_:1,__:[21]}),n(R,{align:"right",class:"q-pt-none"},{default:c(()=>[J(n(B,{flat:"",label:"Close",color:"primary"},null,512),[[oe]])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),n(ee,{modelValue:h.value,"onUpdate:modelValue":r[3]||(r[3]=D=>h.value=D)},{default:c(()=>[n(W,{style:{"min-width":"350px"}},{default:c(()=>[n(V,{class:"row items-center"},{default:c(()=>[n(ke,{icon:"info",color:"primary","text-color":"white"}),r[22]||(r[22]=w("span",{class:"q-ml-sm text-h6"},"Newsletter Details",-1))]),_:1,__:[22]}),n(V,null,{default:c(()=>[w("div",ct,[w("div",null,[r[23]||(r[23]=w("strong",null,"Title:",-1)),y(" "+_(l.newsletter.title),1)]),b.value?(S(),P("div",ut,[r[24]||(r[24]=w("strong",null,"Date:",-1)),y(" "+_(M(l.newsletter.date)),1)])):N("",!0),I.value?(S(),P("div",dt,[r[25]||(r[25]=w("strong",null,"Pages:",-1)),y(" "+_(I.value),1)])):N("",!0),w("div",null,[r[26]||(r[26]=w("strong",null,"Filename:",-1)),y(" "+_(l.newsletter.filename),1)]),d.value?(S(),P("div",gt,[r[27]||(r[27]=w("strong",null,"File Size:",-1)),y(" "+_(d.value),1)])):N("",!0),l.newsletter.publishDate&&M(l.newsletter.publishDate)?(S(),P("div",mt,[r[28]||(r[28]=w("strong",null,"Published:",-1)),y(" "+_(M(l.newsletter.publishDate)),1)])):N("",!0),l.newsletter.topics?.length?(S(),P("div",wt,[r[29]||(r[29]=w("strong",null,"Topics:",-1)),y(" "+_(l.newsletter.topics.join(", ")),1)])):N("",!0),l.newsletter.tags?.length?(S(),P("div",ft,[r[30]||(r[30]=w("strong",null,"Tags:",-1)),y(" "+_(l.newsletter.tags.join(", ")),1)])):N("",!0)])]),_:1}),n(R,{align:"right"},{default:c(()=>[J(n(B,{flat:"",label:"Close",color:"primary"},null,512),[[oe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Lt=Ue(vt,[["__scopeId","data-v-5cf5471c"]]);export{Lt as H,$t as Q,Ve as u};
