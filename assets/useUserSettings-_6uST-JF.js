import{l as u,r as v,f as g,w as O,a3 as L}from"./index-Cz4yoHZ0.js";const f={theme:"auto",language:"en-US",notifications:{browser:!0,email:!1,issues:!0,events:!0},display:{compactMode:!1,animationsEnabled:!0,autoplayVideos:!1,sideMenuCollapsed:!1},pdf:{defaultZoom:1,pageLayout:"cover",thumbnailSize:"medium"}},j="clca-courier-storage",C=1,h="user-settings",S="app-cache";class k{db=null;initPromise=null;constructor(){this.initPromise=this.initializeDB()}serializeForIndexedDB(t){try{return JSON.parse(JSON.stringify(t))}catch(e){throw u.warn("Failed to serialize data for IndexedDB:",e),new Error("Data contains non-serializable values")}}async initializeDB(){return new Promise((t,e)=>{const s=indexedDB.open(j,C);s.onerror=()=>{u.error("Failed to open IndexedDB:",s.error),e(new Error(s.error?.message||"Failed to open IndexedDB"))},s.onsuccess=()=>{this.db=s.result,t()},s.onupgradeneeded=n=>{const c=n.target.result;if(c.objectStoreNames.contains(h)||c.createObjectStore(h,{keyPath:"id"}).createIndex("userId","userId",{unique:!1}),!c.objectStoreNames.contains(S)){const r=c.createObjectStore(S,{keyPath:"key"});r.createIndex("category","category",{unique:!1}),r.createIndex("timestamp","timestamp",{unique:!1})}}})}async ensureInitialized(){this.initPromise&&await this.initPromise}getFromLocalStorage(t,e){try{const s=localStorage.getItem(t);return s?JSON.parse(s):e}catch(s){return u.warn(`Failed to parse localStorage item ${t}:`,s),e}}setToLocalStorage(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(s){u.error(`Failed to set localStorage item ${t}:`,s)}}async getUserSettings(){const t=this.getFromLocalStorage("clca-user-settings",null);if(t)return{...f,...t};try{if(await this.ensureInitialized(),this.db){const e=await this.getFromIndexedDB(h,"default");if(e?.data){const s={...f,...e.data};return this.setToLocalStorage("clca-user-settings",s),s}}}catch(e){u.warn("Failed to load settings from IndexedDB:",e)}return f}async saveUserSettings(t){const s={...await this.getUserSettings(),...t};this.setToLocalStorage("clca-user-settings",s);try{if(await this.ensureInitialized(),this.db){const n=this.serializeForIndexedDB({id:"default",userId:"default",data:s,timestamp:Date.now()});await this.saveToIndexedDB(h,n)}}catch(n){u.error("Failed to save settings to IndexedDB:",n)}}async getTheme(){return(await this.getUserSettings()).theme}async setTheme(t){await this.saveUserSettings({theme:t})}async getNotificationSettings(){return(await this.getUserSettings()).notifications}async setNotificationSettings(t){const e=await this.getUserSettings();await this.saveUserSettings({notifications:{...e.notifications,...t}})}async getDisplaySettings(){return(await this.getUserSettings()).display}async setDisplaySettings(t){const e=await this.getUserSettings();await this.saveUserSettings({display:{...e.display,...t}})}async getPdfSettings(){return(await this.getUserSettings()).pdf}async setPdfSettings(t){const e=await this.getUserSettings();await this.saveUserSettings({pdf:{...e.pdf,...t}})}async getFromIndexedDB(t,e){if(await this.ensureInitialized(),!this.db)throw new Error("Database not initialized");return new Promise((s,n)=>{const d=this.db.transaction([t],"readonly").objectStore(t).get(e);d.onsuccess=()=>s(d.result),d.onerror=()=>n(new Error(d.error?.message||"IndexedDB get operation failed"))})}async saveToIndexedDB(t,e){if(await this.ensureInitialized(),!this.db)throw new Error("Database not initialized");return new Promise((s,n)=>{const d=this.db.transaction([t],"readwrite").objectStore(t).put(e);d.onsuccess=()=>s(),d.onerror=()=>n(new Error(d.error?.message||"IndexedDB put operation failed"))})}async cacheData(t,e,s="general",n){const c={key:t,data:e,category:s,timestamp:Date.now(),ttl:n?Date.now()+n:null};try{if(await this.ensureInitialized(),this.db){const r=this.serializeForIndexedDB(c);await this.saveToIndexedDB(S,r)}}catch(r){u.error("Failed to cache data:",r)}}async getCachedData(t){try{if(await this.ensureInitialized(),!this.db)return null;const e=await this.getFromIndexedDB(S,t);return e?e.ttl&&Date.now()>e.ttl?(await this.removeCachedData(t),null):e.data:null}catch(e){return u.error("Failed to get cached data:",e),null}}async removeCachedData(t){try{return await this.ensureInitialized(),this.db?new Promise((e,s)=>{const r=this.db.transaction([S],"readwrite").objectStore(S).delete(t);r.onsuccess=()=>e(),r.onerror=()=>s(new Error(r.error?.message||"IndexedDB delete operation failed"))}):void 0}catch(e){u.error("Failed to remove cached data:",e)}}async clearUserData(){localStorage.removeItem("clca-user-settings");try{if(await this.ensureInitialized(),this.db){const t=this.db.transaction([h,S],"readwrite");t.objectStore(h).clear(),t.objectStore(S).clear()}}catch(t){u.error("Failed to clear IndexedDB data:",t)}}async exportSettings(){const t=await this.getUserSettings();return JSON.stringify(t,null,2)}async importSettings(t){try{const e=JSON.parse(t);await this.saveUserSettings(e)}catch{throw new Error("Invalid settings format")}}}const o=new k;function M(l){return JSON.parse(JSON.stringify(l))}const i=v(f),y=v(!1),m=v(!1);let w=null;async function D(){return w||(w=(async()=>{try{m.value=!0;const l=await o.getUserSettings();i.value=l,y.value=!0}catch(l){console.error("Failed to load user settings:",l),i.value=f,y.value=!0}finally{m.value=!1}})(),w)}const J=()=>{const l=L();!y.value&&!m.value&&D();const t=g(()=>i.value.theme==="auto"?l.dark.isActive:i.value.theme==="dark"),e=g(()=>i.value.theme);O(()=>i.value.theme,a=>{a==="auto"?l.dark.set("auto"):l.dark.set(a==="dark")},{immediate:!0});async function s(a){i.value.theme=a,await o.setTheme(a)}async function n(){const p=t.value?"light":"dark";await s(p)}const c=g(()=>i.value.notifications);async function r(a){i.value.notifications={...i.value.notifications,...a},await o.setNotificationSettings(a)}const d=g(()=>i.value.display);async function I(a){i.value.display={...i.value.display,...a},await o.setDisplaySettings(a)}const b=g(()=>i.value.display.sideMenuCollapsed);async function x(a){i.value.display.sideMenuCollapsed=a,await o.setDisplaySettings({sideMenuCollapsed:a})}const U=g(()=>i.value.pdf);async function B(a){i.value.pdf={...i.value.pdf,...a},await o.setPdfSettings(a)}const z=g(()=>i.value.language);async function F(a){i.value.language=a,await o.saveUserSettings({language:a})}async function T(a){Object.assign(i.value,a),await o.saveUserSettings(a)}async function E(){i.value={...f};const a=M(i.value);await o.saveUserSettings(a)}async function N(){return o.exportSettings()}async function P(a){await o.importSettings(a);const p=await o.getUserSettings();i.value=p}return{userSettings:g(()=>i.value),isSettingsLoaded:g(()=>y.value),isSettingsLoading:g(()=>m.value),isDarkMode:t,currentTheme:e,setTheme:s,toggleDarkMode:n,notificationSettings:c,updateNotificationSettings:r,displaySettings:d,updateDisplaySettings:I,sideMenuCollapsed:b,setSideMenuCollapsed:x,pdfSettings:U,updatePdfSettings:B,currentLanguage:z,setLanguage:F,updateSettings:T,resetSettings:E,exportSettings:N,importSettings:P,initializeSettings:D}};export{J as u};
